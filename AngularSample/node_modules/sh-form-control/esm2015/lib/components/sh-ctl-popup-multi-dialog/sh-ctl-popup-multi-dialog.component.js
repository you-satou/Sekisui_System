/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Component } from '@angular/core';
import { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material';
import { SelectionModel } from '@angular/cdk/collections';
import { SHCtlCommon } from '../sh-ctl-common';
/**
 * @record
 */
function Data() { }
if (false) {
    /** @type {?} */
    Data.prototype.dataTitle;
    /** @type {?} */
    Data.prototype.value;
    /** @type {?} */
    Data.prototype.uniqueColumns;
    /** @type {?} */
    Data.prototype.hiddenColumns;
}
export class SHCtlPopupDialogMultiComponent {
    /**
     * @param {?} dialogRef
     * @param {?} data
     */
    constructor(dialogRef, data) {
        this.dialogRef = dialogRef;
        this.data = data;
        this.displayedColumns = [];
        this.name = "";
        this.uniqueStr = "";
        this.selection = new SelectionModel(true, []);
    }
    /**
     * 値がバインドされる時に呼ばれる
     * @return {?}
     */
    ngOnInit() {
        this.init();
    }
    /**
     * 値の初期化
     * @private
     * @return {?}
     */
    init() {
        this.dataTitle = this.data.dataTitle;
        if (this.data.value)
            this.data.value.forEach((/**
             * @param {?} row
             * @return {?}
             */
            row => this.selection.select(row)));
        /** @type {?} */
        let cols = ['select'];
        this.getHashKeys().forEach((/**
         * @param {?} name
         * @param {?} idx
         * @return {?}
         */
        (name, idx) => {
            if (!this.data.hiddenColumns.find((/**
             * @param {?} _
             * @return {?}
             */
            _ => _ == (idx + 1))))
                cols.push(name);
        }));
        this.displayedColumns = cols;
        this.uniqueStr = SHCtlCommon.getUniqueStr();
    }
    /**
     * テーブルのヘッダーを編集
     * @return {?}
     */
    ngAfterViewChecked() {
        /** @type {?} */
        let headerElement = document.getElementsByTagName('th');
        /** @type {?} */
        let countBlank = 0;
        if (!this.codesHeader)
            return;
        for (let i = 0; i < headerElement.length; i++) {
            if (this.codesHeader[i] != "") {
                for (let e = 1; e <= countBlank; e++) {
                    headerElement[i - e].style.display = 'none';
                }
                countBlank = 0;
            }
            else if (this.codesHeader[i] === "") {
                countBlank += 1;
                headerElement[i - countBlank].colSpan = countBlank + 1;
                headerElement[i - countBlank].style.textAlign = 'center';
                if (i === headerElement.length - 1) {
                    for (let j = 0; j < countBlank; j++) {
                        headerElement[i - j].style.display = 'none';
                    }
                }
            }
        }
    }
    /**
     * チェックボックス選択
     * @param {?} row
     * @return {?}
     */
    itemSelect(row) {
        if (!this.isItemSelected(row))
            this.selection.select(row);
    }
    /**
     * 行選択によるチェックボックス値の操作
     * @param {?} row
     * @return {?}
     */
    itemToggle(row) {
        if (!this.isItemSelected(row))
            this.selection.select(row);
        else {
            /** @type {?} */
            let keys = Object.keys(row);
            /** @type {?} */
            let item = this.selection.selected.find((/**
             * @param {?} _
             * @return {?}
             */
            _ => {
                /** @type {?} */
                let isSame = true;
                keys.forEach((/**
                 * @param {?} key
                 * @param {?} idx
                 * @return {?}
                 */
                (key, idx) => {
                    if (this.data.uniqueColumns.find((/**
                     * @param {?} __
                     * @return {?}
                     */
                    __ => __ == (idx + 1)))) {
                        if (_[key] != row[key]) {
                            isSame = false;
                            return;
                        }
                    }
                }));
                return isSame;
            }));
            this.selection.deselect(item);
        }
    }
    /**
     * 項目を選択しているかどうか
     * @param {?} row
     * @return {?}
     */
    isItemSelected(row) {
        if (!this.selection.selected)
            return false;
        /** @type {?} */
        let keys = Object.keys(row);
        /** @type {?} */
        let item = this.selection.selected.find((/**
         * @param {?} _
         * @return {?}
         */
        _ => {
            /** @type {?} */
            let isSame = true;
            keys.forEach((/**
             * @param {?} key
             * @param {?} idx
             * @return {?}
             */
            (key, idx) => {
                if (this.data.uniqueColumns.find((/**
                 * @param {?} __
                 * @return {?}
                 */
                __ => __ == (idx + 1)))) {
                    if (_[key] != row[key]) {
                        isSame = false;
                        return;
                    }
                }
            }));
            return isSame;
        }));
        return item ? true : false;
    }
    /**
     * ダイアログを閉じる
     * @return {?}
     */
    closeDialog() {
        //ダイアログを閉める時に抽入値を親に渡す
        this.dialogRef.close();
    }
    /**
     * ポップアップから選択されたデータを親に返す
     * @return {?}
     */
    returnDialog() {
        //ダイアログを閉める時に選択値を親に渡す
        this.dialogRef.close(this.selection.selected);
    }
    /**
     * 全ての項目を選択しているかどうか
     * @return {?}
     */
    isAllSelected() {
        /** @type {?} */
        const numSelected = this.selection.selected.length;
        /** @type {?} */
        const numRows = this.unchangeableCodes.length;
        return numSelected === numRows;
    }
    /**
     * 全選択・全解除処理
     * @return {?}
     */
    masterToggle() {
        this.isAllSelected() ?
            this.selection.clear() :
            this.unchangeableCodes.forEach((/**
             * @param {?} row
             * @return {?}
             */
            row => this.itemSelect(row)));
    }
    /**
     * チェックボックスラベル
     * @param {?=} row
     * @return {?}
     */
    checkboxLabel(row) {
        if (!row) {
            return `${this.isAllSelected() ? 'select' : 'deselect'} all`;
        }
        return `${this.selection.isSelected(row) ? 'deselect' : 'select'} row ${row.position + 1}`;
    }
    /**
     * データのkeyを返す
     * @return {?}
     */
    getHashKeys() {
        if (!this.unchangeableCodes || this.unchangeableCodes.length == 0) {
            return;
        }
        else {
            return Object.keys(this.unchangeableCodes[0]);
        }
    }
    /**
     * ポップアップ内での曖昧検索
     * スペース区切りで1キーワードとする
     * @param {?} event inputイベント
     * @return {?}
     */
    filter(event) {
        /** @type {?} */
        const filterString = event.target.value;
        /** @type {?} */
        let fileterStrArray = filterString.replace(/　/g, " ").split(" ");
        fileterStrArray = fileterStrArray.filter((/**
         * @param {?} value
         * @return {?}
         */
        (value) => {
            return value;
        }));
        /** @type {?} */
        let resultArray;
        resultArray = this.unchangeableCodes.concat();
        for (let i = 0; i < fileterStrArray.length; i++) {
            /** @type {?} */
            let obj = this;
            resultArray = resultArray.filter((/**
             * @param {?} value
             * @return {?}
             */
            function (value) {
                /** @type {?} */
                let values = Object.values(value);
                for (let j = 0; j < values.length; j++) {
                    if (obj.data.hiddenColumns.find((/**
                     * @param {?} _
                     * @return {?}
                     */
                    _ => _ == (j + 1))))
                        continue;
                    if (values[j] != null && values[j].toString().match(fileterStrArray[i])) {
                        return true;
                    }
                }
                return false;
            }));
        }
        this.codes = resultArray;
    }
}
SHCtlPopupDialogMultiComponent.decorators = [
    { type: Component, args: [{
                selector: 'sh-ctl-popup-multi-dialog',
                template: "<div *ngIf=\"!unchangeableCodes\" class=\"overlay\">\r\n  <mat-spinner></mat-spinner>\r\n  <span class=\"loader-text\">Loading...</span>\r\n</div> \r\n<div class=\"sh-container\" id={{uniqueStr}}>\r\n    <h1 mat-dialog-title class=\"sh-text-center\">{{dataTitle}}</h1>\r\n    <div mat-dialog-content class=\"sh-dialog-content\">\r\n      <mat-form-field class=\"sh-width-100\">\r\n        <input matInput placeholder=\"\u691C\u7D22\u6B04\" (input)=\"filter($event)\"/>\r\n      </mat-form-field>\r\n      <div class=\"sh-dialog-table-container mat-elevation-z8\">\r\n        <table mat-table [dataSource]=\"codes\" class=\"sh-width-100\">\r\n          <ng-container matColumnDef=\"select\">\r\n            <th mat-header-cell *matHeaderCellDef>\r\n              <mat-checkbox (change)=\"$event ? masterToggle() : null\"\r\n                            [checked]=\"selection.hasValue() && isAllSelected()\"\r\n                            [indeterminate]=\"selection.hasValue() && !isAllSelected()\"\r\n                            [aria-label]=\"checkboxLabel()\">\r\n              </mat-checkbox>\r\n            </th>\r\n            <td mat-cell *matCellDef=\"let row\">\r\n              <mat-checkbox (click)=\"$event.stopPropagation()\"\r\n                            (change)=\"$event ? itemToggle(row) : null\"\r\n                            [checked]=\"isItemSelected(row)\"\r\n                            [aria-label]=\"checkboxLabel(row)\">\r\n              </mat-checkbox>\r\n            </td>\r\n          </ng-container>\r\n          <span *ngFor=\"let key of getHashKeys(); let i = index\">\r\n            <ng-container matColumnDef=\"{{key}}\">\r\n              <th mat-header-cell *matHeaderCellDef>{{codesHeader[i]}}</th>\r\n              <td mat-cell *matCellDef=\"let element\">{{element[key]}}</td>\r\n            </ng-container>\r\n          </span>\r\n            <tr mat-header-row *matHeaderRowDef=\"displayedColumns; sticky: true\"></tr>\r\n            <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\" (click)=\"itemToggle(row)\"></tr>\r\n        </table>\r\n      </div>\r\n    </div>\r\n    <div mat-dialog-actions>\r\n      <div ShFlexRow style=\"width: 100%\">\r\n        <div ShFlex [colLg]=\"50\" [colMd]=\"50\">\r\n          <button mat-raised-button (click)=\"closeDialog()\">\u623B\u308B</button>\r\n        </div>\r\n        <div ShFlex [colLg]=\"50\" [colMd]=\"50\" style=\"text-align: right; padding-right: 0px;\">\r\n          <span style=\"margin-right: 1em;\">\u9078\u629E\u6570\u3000{{selection.selected ? selection.selected.length : \"-\"}} / {{unchangeableCodes ? unchangeableCodes.length : \"-\"}}</span>\r\n          <button mat-raised-button color=\"primary\" (click)=\"returnDialog()\">\u9078\u629E</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  ",
                styles: ["", ".sh-flex{width:100%;display:-webkit-inline-box;display:inline-flex}.sh-flex-center{-webkit-box-align:center;align-items:center}.sh-flex-between{-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.display-ctl-view{margin-top:20px}.overlay{position:fixed;display:-webkit-box;display:flex;top:0;left:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%;width:100%;color:gray;background-color:rgba(0,0,0,.5);z-index:9999}.loader-text{display:block;color:#f3f3f3;margin-top:1em}.mat-dialog-content{overflow:hidden;max-height:none}.sh-dialog-content{height:85%}.sh-kbn-dialog-table-container{height:92%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-dialog-table-container{display:-webkit-box;display:flex;height:83%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-text-center{text-align:center}.sh-width-100{width:100%}.sh-label{display:block}.custom-alert-message{top:-20px;position:relative;font-size:.75em;color:rgba(0,0,0,.54)}.result-input,.sh-label{color:rgba(0,0,0,.87)}::ng-deep .mat-form-field-label span{color:rgba(0,0,0,.87)}::ng-deep .result-container .mat-form-field-flex{background-color:#ccdcff}.sh-ctl-state-primary::ng-deep .mat-form-field-label{color:#3f51b5}.sh-ctl-state-primary::ng-deep .mat-form-field-underline{background-color:#3f51b5}.sh-ctl-state-primary-message{color:#3f51b5}.sh-ctl-state-secondary::ng-deep .mat-form-field-label{color:#ff4081}.sh-ctl-state-secondary::ng-deep .mat-form-field-underline{background-color:#ff4081}.sh-ctl-state-secondary-message{color:#ff4081}.sh-ctl-state-success::ng-deep .mat-form-field-label{color:#0dad17}.sh-ctl-state-success::ng-deep .mat-form-field-underline{background-color:#0dad17}.sh-ctl-state-success-message{color:#0dad17}.sh-ctl-state-danger::ng-deep .mat-form-field-label{color:#f44336}.sh-ctl-state-danger::ng-deep .mat-form-field-underline{background-color:#f44336}.sh-ctl-state-danger-message{color:#f44336}.sh-ctl-state-warning::ng-deep .mat-form-field-label{color:#e29f2b}.sh-ctl-state-warning::ng-deep .mat-form-field-underline{background-color:#e29f2b}.sh-ctl-state-warning-message{color:#e29f2b}.sh-container{position:relative;width:100%;height:100%}.only-field{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;width:100%;height:100%;min-height:28px}.only-field input,.only-field textarea{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.only-field-danger{background-color:#f44336}.only-field-warning{background-color:#e29f2b}.only-field-success{background-color:#0dad17}::ng-deep .only-field .material-icons{font-size:13px}::ng-deep .only-field .mat-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon{position:absolute;top:0;left:0}::ng-deep .only-field .mat-datepicker-toggle-default-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;margin-right:auto}::ng-deep .mat-datepicker-toggle span svg{width:16px;height:16px}.only-label{background-color:#ccdcff;position:relative}.only-label mat-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;font-size:16px}.bind-flg__input{opacity:0;height:0;width:0;position:absolute;z-index:-100}"]
            }] }
];
/** @nocollapse */
SHCtlPopupDialogMultiComponent.ctorParameters = () => [
    { type: MatDialogRef },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
if (false) {
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.displayedColumns;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.name;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.uniqueStr;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.dataTitle;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.codes;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.unchangeableCodes;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.codesHeader;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.selection;
    /**
     * @type {?}
     * @private
     */
    SHCtlPopupDialogMultiComponent.prototype.dialogRef;
    /** @type {?} */
    SHCtlPopupDialogMultiComponent.prototype.data;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY3RsLXBvcHVwLW11bHRpLWRpYWxvZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9zaC1mb3JtLWNvbnRyb2wvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9zaC1jdGwtcG9wdXAtbXVsdGktZGlhbG9nL3NoLWN0bC1wb3B1cC1tdWx0aS1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBNEIsTUFBTSxlQUFlLENBQUM7QUFDNUUsT0FBTyxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDMUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDOzs7O0FBRS9DLG1CQUtDOzs7SUFKRyx5QkFBaUI7O0lBQ2pCLHFCQUFXOztJQUNYLDZCQUFrQjs7SUFDbEIsNkJBQW1COztBQVF2QixNQUFNLE9BQU8sOEJBQThCOzs7OztJQVV2QyxZQUNZLFNBQTRCLEVBQ0osSUFBVTtRQURsQyxjQUFTLEdBQVQsU0FBUyxDQUFtQjtRQUNKLFNBQUksR0FBSixJQUFJLENBQU07UUFYdkMscUJBQWdCLEdBQWEsRUFBRSxDQUFDO1FBQ2hDLFNBQUksR0FBVyxFQUFFLENBQUM7UUFDbEIsY0FBUyxHQUFHLEVBQUUsQ0FBQztRQUtmLGNBQVMsR0FBRyxJQUFJLGNBQWMsQ0FBTSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFLakQsQ0FBQzs7Ozs7SUFLTCxRQUFRO1FBQ0osSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQ2YsQ0FBQzs7Ozs7O0lBS08sSUFBSTtRQUNSLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDckMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUs7WUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPOzs7O1lBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDOztZQUMzRCxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLE9BQU87Ozs7O1FBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUU7WUFDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUk7Ozs7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBQztnQkFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVFLENBQUMsRUFBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNoRCxDQUFDOzs7OztJQUtELGtCQUFrQjs7WUFDVixhQUFhLEdBQUcsUUFBUSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQzs7WUFDbkQsVUFBVSxHQUFHLENBQUM7UUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXO1lBQUUsT0FBTztRQUM5QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMzQyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO2dCQUMzQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUNsQyxhQUFhLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO2lCQUMvQztnQkFDRCxVQUFVLEdBQUcsQ0FBQyxDQUFDO2FBQ2xCO2lCQUFNLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7Z0JBQ25DLFVBQVUsSUFBSSxDQUFDLENBQUM7Z0JBQ2hCLGFBQWEsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsT0FBTyxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUM7Z0JBQ3ZELGFBQWEsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7Z0JBQ3pELElBQUksQ0FBQyxLQUFLLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO29CQUNoQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO3dCQUNqQyxhQUFhLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO3FCQUMvQztpQkFDSjthQUNKO1NBQ0o7SUFDTCxDQUFDOzs7Ozs7SUFLTSxVQUFVLENBQUMsR0FBTztRQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7WUFDekIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbkMsQ0FBQzs7Ozs7O0lBS00sVUFBVSxDQUFDLEdBQU87UUFDckIsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQzFCOztnQkFDRyxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7O2dCQUN2QixJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSTs7OztZQUFDLENBQUMsQ0FBQyxFQUFFOztvQkFDcEMsTUFBTSxHQUFHLElBQUk7Z0JBQ2pCLElBQUksQ0FBQyxPQUFPOzs7OztnQkFBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtvQkFDdEIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJOzs7O29CQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFDLEVBQUU7d0JBQ3JELElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTs0QkFDcEIsTUFBTSxHQUFHLEtBQUssQ0FBQzs0QkFBQyxPQUFPO3lCQUMxQjtxQkFDSjtnQkFDTCxDQUFDLEVBQUMsQ0FBQztnQkFDSCxPQUFPLE1BQU0sQ0FBQztZQUNsQixDQUFDLEVBQUM7WUFDRixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNqQztJQUNMLENBQUM7Ozs7OztJQUtNLGNBQWMsQ0FBQyxHQUFPO1FBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVE7WUFBRSxPQUFPLEtBQUssQ0FBQzs7WUFDdkMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDOztZQUN2QixJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsSUFBSTs7OztRQUFDLENBQUMsQ0FBQyxFQUFFOztnQkFDcEMsTUFBTSxHQUFHLElBQUk7WUFDakIsSUFBSSxDQUFDLE9BQU87Ozs7O1lBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7Z0JBQ3RCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSTs7OztnQkFBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsRUFBQyxFQUFFO29CQUNyRCxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7d0JBQ3BCLE1BQU0sR0FBRyxLQUFLLENBQUM7d0JBQUMsT0FBTztxQkFDMUI7aUJBQ0o7WUFDTCxDQUFDLEVBQUMsQ0FBQztZQUNILE9BQU8sTUFBTSxDQUFDO1FBQ2xCLENBQUMsRUFBQztRQUNGLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUMvQixDQUFDOzs7OztJQUtNLFdBQVc7UUFDZCxxQkFBcUI7UUFDckIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUMzQixDQUFDOzs7OztJQU1NLFlBQVk7UUFDZixxQkFBcUI7UUFDckIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNsRCxDQUFDOzs7OztJQUtNLGFBQWE7O2NBQ1YsV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU07O2NBQzVDLE9BQU8sR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTTtRQUM3QyxPQUFPLFdBQVcsS0FBSyxPQUFPLENBQUM7SUFDbkMsQ0FBQzs7Ozs7SUFLTSxZQUFZO1FBQ2YsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUM7WUFDbEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3hCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPOzs7O1lBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFDLENBQUM7SUFDcEUsQ0FBQzs7Ozs7O0lBS00sYUFBYSxDQUFDLEdBQVM7UUFDMUIsSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUNOLE9BQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsVUFBVSxNQUFNLENBQUM7U0FDaEU7UUFDRCxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsUUFBUSxRQUFRLEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxFQUFFLENBQUM7SUFDL0YsQ0FBQzs7Ozs7SUFLTSxXQUFXO1FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtZQUMvRCxPQUFPO1NBQ1Y7YUFBTTtZQUNILE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqRDtJQUNMLENBQUM7Ozs7Ozs7SUFPTSxNQUFNLENBQUMsS0FBSzs7Y0FDVCxZQUFZLEdBQVcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLOztZQUMzQyxlQUFlLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztRQUNoRSxlQUFlLEdBQUcsZUFBZSxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQy9DLE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUMsRUFBQyxDQUFDOztZQUNDLFdBQWtCO1FBQ3RCLFdBQVcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDOUMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGVBQWUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7O2dCQUN6QyxHQUFHLEdBQUcsSUFBSTtZQUNkLFdBQVcsR0FBRyxXQUFXLENBQUMsTUFBTTs7OztZQUFDLFVBQVUsS0FBVTs7b0JBQzdDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztnQkFDakMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQ3BDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSTs7OztvQkFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBQzt3QkFBRSxTQUFTO29CQUM3RCxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRTt3QkFDckUsT0FBTyxJQUFJLENBQUM7cUJBQ2Y7aUJBQ0o7Z0JBQ0QsT0FBTyxLQUFLLENBQUM7WUFDakIsQ0FBQyxFQUFDLENBQUM7U0FDTjtRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDO0lBQzdCLENBQUM7OztZQTFNSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLDJCQUEyQjtnQkFDckMseXhGQUF1RDs7YUFFMUQ7Ozs7WUFmUSxZQUFZOzRDQTRCWixNQUFNLFNBQUMsZUFBZTs7OztJQVgzQiwwREFBdUM7O0lBQ3ZDLDhDQUF5Qjs7SUFDekIsbURBQXNCOztJQUN0QixtREFBeUI7O0lBQ3pCLCtDQUFrQjs7SUFDbEIsMkRBQThCOztJQUM5QixxREFBd0I7O0lBQ3hCLG1EQUFxRDs7Ozs7SUFHakQsbURBQW9DOztJQUNwQyw4Q0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3QsIENvbXBvbmVudCwgT25Jbml0LCBBZnRlclZpZXdDaGVja2VkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE1hdERpYWxvZ1JlZiwgTUFUX0RJQUxPR19EQVRBIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xyXG5pbXBvcnQgeyBTZWxlY3Rpb25Nb2RlbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2xsZWN0aW9ucyc7XHJcbmltcG9ydCB7IFNIQ3RsQ29tbW9uIH0gZnJvbSAnLi4vc2gtY3RsLWNvbW1vbic7XHJcblxyXG5pbnRlcmZhY2UgRGF0YSB7XHJcbiAgICBkYXRhVGl0bGU6IHN0cmluZ1xyXG4gICAgdmFsdWU6IGFueSxcclxuICAgIHVuaXF1ZUNvbHVtbnM6IGFueVxyXG4gICAgaGlkZGVuQ29sdW1uczogYW55LFxyXG59XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAnc2gtY3RsLXBvcHVwLW11bHRpLWRpYWxvZycsXHJcbiAgICB0ZW1wbGF0ZVVybDogJ3NoLWN0bC1wb3B1cC1tdWx0aS1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJ3NoLWN0bC1wb3B1cC1tdWx0aS1kaWFsb2cuY29tcG9uZW50LmNzcycsICcuLi8uLi8uLi9zdHlsZS5jb21tb24uY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFNIQ3RsUG9wdXBEaWFsb2dNdWx0aUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgQWZ0ZXJWaWV3Q2hlY2tlZCB7XHJcbiAgICBwdWJsaWMgZGlzcGxheWVkQ29sdW1uczogc3RyaW5nW10gPSBbXTtcclxuICAgIHB1YmxpYyBuYW1lOiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgcHVibGljIHVuaXF1ZVN0ciA9IFwiXCI7XHJcbiAgICBwdWJsaWMgZGF0YVRpdGxlOiBzdHJpbmc7XHJcbiAgICBwdWJsaWMgY29kZXM6IGFueTtcclxuICAgIHB1YmxpYyB1bmNoYW5nZWFibGVDb2RlczogYW55O1xyXG4gICAgcHVibGljIGNvZGVzSGVhZGVyOiBhbnk7XHJcbiAgICBwdWJsaWMgc2VsZWN0aW9uID0gbmV3IFNlbGVjdGlvbk1vZGVsPGFueT4odHJ1ZSwgW10pO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHByaXZhdGUgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8YW55PixcclxuICAgICAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgcHVibGljIGRhdGE6IERhdGEsXHJcbiAgICApIHsgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5YCk44GM44OQ44Kk44Oz44OJ44GV44KM44KL5pmC44Gr5ZG844Gw44KM44KLXHJcbiAgICAgKi9cclxuICAgIG5nT25Jbml0KCkge1xyXG4gICAgICAgIHRoaXMuaW5pdCgpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIOWApOOBruWIneacn+WMllxyXG4gICAgKi9cclxuICAgIHByaXZhdGUgaW5pdCgpIHtcclxuICAgICAgICB0aGlzLmRhdGFUaXRsZSA9IHRoaXMuZGF0YS5kYXRhVGl0bGU7XHJcbiAgICAgICAgaWYgKHRoaXMuZGF0YS52YWx1ZSlcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnZhbHVlLmZvckVhY2gocm93ID0+IHRoaXMuc2VsZWN0aW9uLnNlbGVjdChyb3cpKTtcclxuICAgICAgICBsZXQgY29scyA9IFsnc2VsZWN0J107XHJcbiAgICAgICAgdGhpcy5nZXRIYXNoS2V5cygpLmZvckVhY2goKG5hbWUsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZGF0YS5oaWRkZW5Db2x1bW5zLmZpbmQoXyA9PiBfID09IChpZHggKyAxKSkpIGNvbHMucHVzaChuYW1lKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmRpc3BsYXllZENvbHVtbnMgPSBjb2xzO1xyXG4gICAgICAgIHRoaXMudW5pcXVlU3RyID0gU0hDdGxDb21tb24uZ2V0VW5pcXVlU3RyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIOODhuODvOODluODq+OBruODmOODg+ODgOODvOOCkue3qOmbhlxyXG4gICAgKi9cclxuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcclxuICAgICAgICBsZXQgaGVhZGVyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aCcpXHJcbiAgICAgICAgbGV0IGNvdW50QmxhbmsgPSAwO1xyXG4gICAgICAgIGlmICghdGhpcy5jb2Rlc0hlYWRlcikgcmV0dXJuO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGVhZGVyRWxlbWVudC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb2Rlc0hlYWRlcltpXSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBlID0gMTsgZSA8PSBjb3VudEJsYW5rOyBlKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJFbGVtZW50W2kgLSBlXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY291bnRCbGFuayA9IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2Rlc0hlYWRlcltpXSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgY291bnRCbGFuayArPSAxO1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyRWxlbWVudFtpIC0gY291bnRCbGFua10uY29sU3BhbiA9IGNvdW50QmxhbmsgKyAxO1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyRWxlbWVudFtpIC0gY291bnRCbGFua10uc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA9PT0gaGVhZGVyRWxlbWVudC5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb3VudEJsYW5rOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyRWxlbWVudFtpIC0gal0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDjg4Hjgqfjg4Pjgq/jg5zjg4Pjgq/jgrnpgbjmip5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGl0ZW1TZWxlY3Qocm93OmFueSkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0l0ZW1TZWxlY3RlZChyb3cpKVxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbi5zZWxlY3Qocm93KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOihjOmBuOaKnuOBq+OCiOOCi+ODgeOCp+ODg+OCr+ODnOODg+OCr+OCueWApOOBruaTjeS9nFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaXRlbVRvZ2dsZShyb3c6YW55KSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzSXRlbVNlbGVjdGVkKHJvdykpXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uLnNlbGVjdChyb3cpO1xyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKHJvdyk7ICBcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLnNlbGVjdGlvbi5zZWxlY3RlZC5maW5kKF8gPT4geyBcclxuICAgICAgICAgICAgICAgIGxldCBpc1NhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAga2V5cy5mb3JFYWNoKChrZXksIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGEudW5pcXVlQ29sdW1ucy5maW5kKF9fID0+IF9fID09IChpZHggKyAxKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9ba2V5XSAhPSByb3dba2V5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNTYW1lID0gZmFsc2U744CAcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaXNTYW1lO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24uZGVzZWxlY3QoaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6aCF55uu44KS6YG45oqe44GX44Gm44GE44KL44GL44Gp44GG44GLXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpc0l0ZW1TZWxlY3RlZChyb3c6YW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbi5zZWxlY3RlZCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMocm93KTsgIFxyXG4gICAgICAgIGxldCBpdGVtID0gdGhpcy5zZWxlY3Rpb24uc2VsZWN0ZWQuZmluZChfID0+IHsgXHJcbiAgICAgICAgICAgIGxldCBpc1NhbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICBrZXlzLmZvckVhY2goKGtleSwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhLnVuaXF1ZUNvbHVtbnMuZmluZChfXyA9PiBfXyA9PSAoaWR4ICsgMSkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9ba2V5XSAhPSByb3dba2V5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1NhbWUgPSBmYWxzZTsgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBpc1NhbWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGl0ZW0gPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDjg4DjgqTjgqLjg63jgrDjgpLplonjgZjjgotcclxuICAgICAqL1xyXG4gICAgcHVibGljIGNsb3NlRGlhbG9nKCkge1xyXG4gICAgICAgIC8v44OA44Kk44Ki44Ot44Kw44KS6ZaJ44KB44KL5pmC44Gr5oq95YWl5YCk44KS6Kaq44Gr5rih44GZXHJcbiAgICAgICAgdGhpcy5kaWFsb2dSZWYuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOODneODg+ODl+OCouODg+ODl+OBi+OCiemBuOaKnuOBleOCjOOBn+ODh+ODvOOCv+OCkuimquOBq+i/lOOBmVxyXG4gICAgICogQHBhcmFtIGl0ZW0gXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyByZXR1cm5EaWFsb2coKSB7XHJcbiAgICAgICAgLy/jg4DjgqTjgqLjg63jgrDjgpLplonjgoHjgovmmYLjgavpgbjmip7lgKTjgpLopqrjgavmuKHjgZlcclxuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSh0aGlzLnNlbGVjdGlvbi5zZWxlY3RlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlhajjgabjga7poIXnm67jgpLpgbjmip7jgZfjgabjgYTjgovjgYvjganjgYbjgYtcclxuICAgICAqL1xyXG4gICAgcHVibGljIGlzQWxsU2VsZWN0ZWQoKSB7XHJcbiAgICAgICAgY29uc3QgbnVtU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbi5zZWxlY3RlZC5sZW5ndGg7XHJcbiAgICAgICAgY29uc3QgbnVtUm93cyA9IHRoaXMudW5jaGFuZ2VhYmxlQ29kZXMubGVuZ3RoO1xyXG4gICAgICAgIHJldHVybiBudW1TZWxlY3RlZCA9PT0gbnVtUm93cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFqOmBuOaKnuODu+WFqOino+mZpOWHpueQhlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbWFzdGVyVG9nZ2xlKCkge1xyXG4gICAgICAgIHRoaXMuaXNBbGxTZWxlY3RlZCgpID9cclxuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb24uY2xlYXIoKSA6XHJcbiAgICAgICAgICAgIHRoaXMudW5jaGFuZ2VhYmxlQ29kZXMuZm9yRWFjaChyb3cgPT4gdGhpcy5pdGVtU2VsZWN0KHJvdykpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog44OB44Kn44OD44Kv44Oc44OD44Kv44K544Op44OZ44OrXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjaGVja2JveExhYmVsKHJvdz86IGFueSk6IHN0cmluZyB7XHJcbiAgICAgICAgaWYgKCFyb3cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuaXNBbGxTZWxlY3RlZCgpID8gJ3NlbGVjdCcgOiAnZGVzZWxlY3QnfSBhbGxgO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYCR7dGhpcy5zZWxlY3Rpb24uaXNTZWxlY3RlZChyb3cpID8gJ2Rlc2VsZWN0JyA6ICdzZWxlY3QnfSByb3cgJHtyb3cucG9zaXRpb24gKyAxfWA7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDjg4fjg7zjgr/jga5rZXnjgpLov5TjgZlcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldEhhc2hLZXlzKCkge1xyXG4gICAgICAgIGlmICghdGhpcy51bmNoYW5nZWFibGVDb2RlcyB8fCB0aGlzLnVuY2hhbmdlYWJsZUNvZGVzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjsgXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudW5jaGFuZ2VhYmxlQ29kZXNbMF0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOODneODg+ODl+OCouODg+ODl+WGheOBp+OBruabluaYp+aknOe0olxyXG4gICAgICog44K544Oa44O844K55Yy65YiH44KK44GnMeOCreODvOODr+ODvOODieOBqOOBmeOCi1xyXG4gICAgICogQHBhcmFtIGV2ZW50IGlucHV044Kk44OZ44Oz44OIXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBmaWx0ZXIoZXZlbnQpIHtcclxuICAgICAgICBjb25zdCBmaWx0ZXJTdHJpbmc6IHN0cmluZyA9IGV2ZW50LnRhcmdldC52YWx1ZTtcclxuICAgICAgICBsZXQgZmlsZXRlclN0ckFycmF5ID0gZmlsdGVyU3RyaW5nLnJlcGxhY2UoL+OAgC9nLCBcIiBcIikuc3BsaXQoXCIgXCIpO1xyXG4gICAgICAgIGZpbGV0ZXJTdHJBcnJheSA9IGZpbGV0ZXJTdHJBcnJheS5maWx0ZXIoKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgcmVzdWx0QXJyYXk6IGFueVtdO1xyXG4gICAgICAgIHJlc3VsdEFycmF5ID0gdGhpcy51bmNoYW5nZWFibGVDb2Rlcy5jb25jYXQoKTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGV0ZXJTdHJBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgb2JqID0gdGhpcztcclxuICAgICAgICAgICAgcmVzdWx0QXJyYXkgPSByZXN1bHRBcnJheS5maWx0ZXIoZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKHZhbHVlKVxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB2YWx1ZXMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmRhdGEuaGlkZGVuQ29sdW1ucy5maW5kKF8gPT4gXyA9PSAoaiArIDEpKSkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tqXSAhPSBudWxsICYmIHZhbHVlc1tqXS50b1N0cmluZygpLm1hdGNoKGZpbGV0ZXJTdHJBcnJheVtpXSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jb2RlcyA9IHJlc3VsdEFycmF5O1xyXG4gICAgfVxyXG59Il19