/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component } from "@angular/core";
import { SHFormControl } from "../../utilities/ShFormControl";
import * as moment_ from 'moment';
/** @type {?} */
const moment = moment_;
export class SHCtlDateComponent extends SHFormControl {
    constructor() {
        super();
        this.ctlName = "SHCtlDate";
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.onInit();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.value) {
            if (changes.value.currentValue) {
                /** @type {?} */
                const result = this.getfomatedDate(changes.value.currentValue.replace(/\-/g, '/'));
                this.value = result;
            }
        }
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        if (this.value != null && this.isDisabled) {
            this.stringValue = this.changeFormat(this.value);
        }
    }
    /**
     * onKeypress
     * @param {?} event keyPress
     * @return {?}
     */
    onKeypress(event) {
        this.setCurrentDate(event);
    }
    /**
     * onClick
     * @param {?} event click
     * @return {?}
     */
    onClick(event) {
        this.onBeforeClick(event);
        this.onAfterClick(event);
    }
    /**
     * onChange
     * @param {?} event change
     * @return {?}
     */
    onChange(event) {
        this.onBeforeChange(event);
        /** @type {?} */
        const o = event.target.value;
        this.valueChange.emit(this.getfomatedDate(event.target.value));
        event.target.value = o;
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.onAfterChange(event);
        }), 0);
    }
    /**
     * onFocus
     * @param {?} event focus
     * @return {?}
     */
    onFocus(event) {
        this.onBeforeFocus(event);
        event.target.select();
        setTimeout((/**
         * @return {?}
         */
        () => { this.onAfterFocus(event); }), 0);
    }
    /**
     * onBlur
     * @param {?} event blur
     * @return {?}
     */
    onBlur(event) {
        this.onBeforeBlur(event);
        setTimeout((/**
         * @return {?}
         */
        () => { this.onAfterBlur(event); }), 0);
        ;
    }
    /**
     * 本日日付の設定
     * @param {?} event
     * @return {?}
     */
    setCurrentDate(event) {
        if (event.key === "/") {
            /** @type {?} */
            const d = moment(new Date()).format('YYYY/MM/DD');
            this.value = d;
            event.target.value = d.replace(/\//g, '-');
            this.onChange(event);
        }
    }
    /**
     * 日付データのフォーマット変更を行う
     * @private
     * @param {?} date 日付データ
     * @return {?} 日付文字列
     */
    getfomatedDate(date) {
        if (!date)
            return "";
        /** @type {?} */
        const toString = Object.prototype.toString;
        if (toString.call(date) == "[object Date]") {
            const { year, month, day } = this.paddingDate(date.toLocaleDateString());
            return `${year}/${month}/${day}`;
        }
        else {
            const { year, month, day } = this.paddingDate(date);
            if (date.match(/-/))
                return `${year}/${month}/${day}`;
            else
                return `${year}-${month}-${day}`;
        }
    }
    /**
     * 日付文字列の年月日分割オブジェクトを返却する
     * @param {?} dateStr 日付文字列
     * @return {?} 分割オブジェクト(year, month, day)
     */
    paddingDate(dateStr) {
        if (!dateStr)
            return;
        /** @type {?} */
        const dateArr = dateStr.split(/[-/]/);
        /** @type {?} */
        let year = (Array(4).join("0") + dateArr[0]).slice(-4);
        /** @type {?} */
        const month = (Array(2).join('0') + dateArr[1]).slice(-2);
        /** @type {?} */
        const day = (Array(2).join('0') + dateArr[2]).slice(-2);
        return { year, month, day };
    }
    /**
     * フォーマット編集
     * @param {?} value
     * @return {?}
     */
    changeFormat(value) {
        if (!value) {
            this.stringValue = "";
            return;
        }
        /** @type {?} */
        const result = moment(new Date(value)).format('YYYY年MM月DD日');
        return result;
    }
}
SHCtlDateComponent.decorators = [
    { type: Component, args: [{
                selector: "sh-ctl-date",
                template: "<ng-container *ngIf=\"!onlyField; else onlyFieldControl\">\r\n  <div *ngIf=\"!isDisabled\" (focusin)=\"onFocusin($event)\" (focusout)=\"onFocusout($event)\">\r\n    <mat-form-field class=\"mat-validation {{strClass}}\" [floatLabel]=\"floatLabel\">\r\n      <input #inputElm [required]=\"required\" matInput type=\"date\" [placeholder]=\"title\" max=\"9999-12-31\"\r\n        attr.name=\"{{ctlName}}\" (click)=\"onClick($event)\" (change)=\"onChange($event)\" (focus)=\"onFocus($event)\"\r\n        [disabled]=\"disabled\" (keypress)=\"onKeypress($event)\" [(ngModel)]=\"value\"\r\n        maxlength=\"{{maxlength}}\" [ngStyle]=\"styles\" [ngClass]=\"objClass\" class=\"can-moved-with-the-enter-key\">\r\n      <button mat-button *ngIf=\"inputElm.value && !inputElm.readOnly && !inputElm.disabled\" matSuffix mat-icon-button\r\n        aria-label=\"Clear\" (mousedown)=\"clearValue()\" (keydown)=\"clickClearButton($event)\">\r\n        <mat-icon>close</mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n    <span class=\"custom-alert-message\">{{message.toString().split(',').join(' ')}}</span>\r\n  </div>\r\n</ng-container>\r\n\r\n<ng-template #onlyFieldControl>\r\n  <div class=\"only-field\" (focusin)=\"onFocusin($event)\" (focusout)=\"onFocusout($event)\">\r\n    <input #inputElm [required]=\"required\" matInput type=\"date\" max=\"9999-12-31\"\r\n      attr.name=\"{{ctlName}}\" (click)=\"onClick($event)\" (change)=\"onChange($event)\" (focus)=\"onFocus($event)\"\r\n      [disabled]=\"disabled\" (keypress)=\"onKeypress($event)\" [(ngModel)]=\"value\"\r\n      maxlength=\"{{maxlength}}\" [ngStyle]=\"styles\" [ngClass]=\"objClass\" class=\"can-moved-with-the-enter-key\">\r\n    <button mat-button *ngIf=\"inputElm.value && !inputElm.readOnly && !inputElm.disabled\" matSuffix mat-icon-button\r\n      aria-label=\"Clear\" (mousedown)=\"clearValue()\" (keydown)=\"clickClearButton($event)\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n</ng-template>\r\n\r\n<div *ngIf=\"isDisabled\" class=\"display-ctl-view\">\r\n  <div>\r\n    <div *ngIf=\"title\" class=\"display-ctl-view\">\r\n      <div class=\"display-result\" [ngStyle]=\"{'width.px': labelWidth}\" fxLayout=\"row wrap\" fxFlex>\r\n        <div fxFlex class=\"item-title\"><strong>{{title}}:</strong></div>\r\n      </div>\r\n      <div fxFlex class=\"valueOutput\">\r\n        {{stringValue}}\r\n      </div>\r\n    </div>\r\n\r\n    <div *ngIf=\"!title\" class=\"display-ctl-view notitle-value\">\r\n      <div fxFlex class=\"valueOutput\">\r\n        {{stringValue}}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                styles: [".input-group-text{background-color:#fff;border:none}.btn{border:none}.btn.btn-primary:disabled{background-color:#999}.btn-primary{background-color:#17a2b8}.btn-primary:hover{background-color:#1792b8}.fixed-bottom{top:708px;height:65px;max-width:1024px;margin-right:auto;margin-left:auto}.display-ctl-view{display:-webkit-box;display:flex}.display-result{margin-left:30px}.valueOutput{-webkit-box-flex:1;flex:1}.notitle-value{width:100%;margin-left:30px}", ".sh-flex{width:100%;display:-webkit-inline-box;display:inline-flex}.sh-flex-center{-webkit-box-align:center;align-items:center}.sh-flex-between{-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.display-ctl-view{margin-top:20px}.overlay{position:fixed;display:-webkit-box;display:flex;top:0;left:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%;width:100%;color:gray;background-color:rgba(0,0,0,.5);z-index:9999}.loader-text{display:block;color:#f3f3f3;margin-top:1em}.mat-dialog-content{overflow:hidden;max-height:none}.sh-dialog-content{height:85%}.sh-kbn-dialog-table-container{height:92%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-dialog-table-container{display:-webkit-box;display:flex;height:83%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-text-center{text-align:center}.sh-width-100{width:100%}.sh-label{display:block}.custom-alert-message{top:-20px;position:relative;font-size:.75em;color:rgba(0,0,0,.54)}.result-input,.sh-label{color:rgba(0,0,0,.87)}::ng-deep .mat-form-field-label span{color:rgba(0,0,0,.87)}::ng-deep .result-container .mat-form-field-flex{background-color:#ccdcff}.sh-ctl-state-primary::ng-deep .mat-form-field-label{color:#3f51b5}.sh-ctl-state-primary::ng-deep .mat-form-field-underline{background-color:#3f51b5}.sh-ctl-state-primary-message{color:#3f51b5}.sh-ctl-state-secondary::ng-deep .mat-form-field-label{color:#ff4081}.sh-ctl-state-secondary::ng-deep .mat-form-field-underline{background-color:#ff4081}.sh-ctl-state-secondary-message{color:#ff4081}.sh-ctl-state-success::ng-deep .mat-form-field-label{color:#0dad17}.sh-ctl-state-success::ng-deep .mat-form-field-underline{background-color:#0dad17}.sh-ctl-state-success-message{color:#0dad17}.sh-ctl-state-danger::ng-deep .mat-form-field-label{color:#f44336}.sh-ctl-state-danger::ng-deep .mat-form-field-underline{background-color:#f44336}.sh-ctl-state-danger-message{color:#f44336}.sh-ctl-state-warning::ng-deep .mat-form-field-label{color:#e29f2b}.sh-ctl-state-warning::ng-deep .mat-form-field-underline{background-color:#e29f2b}.sh-ctl-state-warning-message{color:#e29f2b}.sh-container{position:relative;width:100%;height:100%}.only-field{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;width:100%;height:100%;min-height:28px}.only-field input,.only-field textarea{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.only-field-danger{background-color:#f44336}.only-field-warning{background-color:#e29f2b}.only-field-success{background-color:#0dad17}::ng-deep .only-field .material-icons{font-size:13px}::ng-deep .only-field .mat-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon{position:absolute;top:0;left:0}::ng-deep .only-field .mat-datepicker-toggle-default-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;margin-right:auto}::ng-deep .mat-datepicker-toggle span svg{width:16px;height:16px}.only-label{background-color:#ccdcff;position:relative}.only-label mat-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;font-size:16px}.bind-flg__input{opacity:0;height:0;width:0;position:absolute;z-index:-100}"]
            }] }
];
/** @nocollapse */
SHCtlDateComponent.ctorParameters = () => [];
if (false) {
    /** @type {?} */
    SHCtlDateComponent.prototype.stringValue;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY3RsLWRhdGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vc2gtZm9ybS1jb250cm9sLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvc2gtY3RsLWRhdGUvc2gtY3RsLWRhdGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFvQyxNQUFNLGVBQWUsQ0FBQztBQUM1RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDOUQsT0FBTyxLQUFLLE9BQU8sTUFBTSxRQUFRLENBQUM7O01BQzVCLE1BQU0sR0FBRyxPQUFPO0FBT3RCLE1BQU0sT0FBTyxrQkFBbUIsU0FBUSxhQUFxQjtJQUczRDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxXQUFXLENBQUM7SUFDN0IsQ0FBQzs7OztJQUVNLFFBQVE7UUFDYixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEIsQ0FBQzs7Ozs7SUFFTSxXQUFXLENBQUMsT0FBc0I7UUFDdkMsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFO1lBQ2pCLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUU7O3NCQUN4QixNQUFNLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUNsRixJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQzthQUNyQjtTQUNGO0lBQ0gsQ0FBQzs7OztJQUVNLHFCQUFxQjtRQUMxQixJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDekMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNsRDtJQUNILENBQUM7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LCBPbkNoYW5nZXMsIFNpbXBsZUNoYW5nZXMsIE9uSW5pdCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFNIRm9ybUNvbnRyb2wgfSBmcm9tIFwiLi4vLi4vdXRpbGl0aWVzL1NoRm9ybUNvbnRyb2xcIjtcclxuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xyXG5jb25zdCBtb21lbnQgPSBtb21lbnRfO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6IFwic2gtY3RsLWRhdGVcIixcclxuICB0ZW1wbGF0ZVVybDogXCIuL3NoLWN0bC1kYXRlLmNvbXBvbmVudC5odG1sXCIsXHJcbiAgc3R5bGVVcmxzOiBbXCIuL3NoLWN0bC1kYXRlLmNvbXBvbmVudC5jc3NcIiwgXCIuLi8uLi8uLi9zdHlsZS5jb21tb24uY3NzXCJdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU0hDdGxEYXRlQ29tcG9uZW50IGV4dGVuZHMgU0hGb3JtQ29udHJvbDxzdHJpbmc+IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIHB1YmxpYyBzdHJpbmdWYWx1ZTogYW55O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLmN0bE5hbWUgPSBcIlNIQ3RsRGF0ZVwiO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5vbkluaXQoKTtcclxuICB9XHJcbiAgXHJcbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGlmIChjaGFuZ2VzLnZhbHVlKSB7XHJcbiAgICAgIGlmIChjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuZ2V0Zm9tYXRlZERhdGUoY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUucmVwbGFjZSgvXFwtL2csICcvJykpO1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSByZXN1bHQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ0FmdGVyQ29udGVudENoZWNrZWQoKSB7XHJcbiAgICBpZiAodGhpcy52YWx1ZSAhPSBudWxsICYmIHRoaXMuaXNEaXNhYmxlZCkge1xyXG4gICAgICB0aGlzLnN0cmluZ1ZhbHVlID0gdGhpcy5jaGFuZ2VGb3JtYXQodGhpcy52YWx1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogb25LZXlwcmVzc1xyXG4gICAqIEBwYXJhbSBldmVudCBrZXlQcmVzc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBvbktleXByZXNzKGV2ZW50KSB7XHJcbiAgICB0aGlzLnNldEN1cnJlbnREYXRlKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQ2xpY2tcclxuICAgKiBAcGFyYW0gZXZlbnQgY2xpY2tcclxuICAgKi9cclxuICBwdWJsaWMgb25DbGljayhldmVudCkge1xyXG4gICAgdGhpcy5vbkJlZm9yZUNsaWNrKGV2ZW50KTtcclxuXHJcbiAgICB0aGlzLm9uQWZ0ZXJDbGljayhldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBvbkNoYW5nZVxyXG4gICAqIEBwYXJhbSBldmVudCBjaGFuZ2VcclxuICAgKi9cclxuICBwdWJsaWMgb25DaGFuZ2UoZXZlbnQpIHtcclxuICAgIHRoaXMub25CZWZvcmVDaGFuZ2UoZXZlbnQpO1xyXG4gICAgY29uc3QgbyA9IGV2ZW50LnRhcmdldC52YWx1ZTtcclxuICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh0aGlzLmdldGZvbWF0ZWREYXRlKGV2ZW50LnRhcmdldC52YWx1ZSkpO1xyXG4gICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gbztcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5vbkFmdGVyQ2hhbmdlKGV2ZW50KTtcclxuICAgIH0sIDApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25Gb2N1c1xyXG4gICAqIEBwYXJhbSBldmVudCBmb2N1c1xyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkZvY3VzKGV2ZW50KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlRm9jdXMoZXZlbnQpO1xyXG5cclxuICAgIGV2ZW50LnRhcmdldC5zZWxlY3QoKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHt0aGlzLm9uQWZ0ZXJGb2N1cyhldmVudCl9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQmx1clxyXG4gICAqIEBwYXJhbSBldmVudCBibHVyXHJcbiAgICovXHJcbiAgcHVibGljIG9uQmx1cihldmVudCkge1xyXG4gICAgdGhpcy5vbkJlZm9yZUJsdXIoZXZlbnQpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge3RoaXMub25BZnRlckJsdXIoZXZlbnQpO30sIDApOztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOacrOaXpeaXpeS7mOOBruioreWumlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRDdXJyZW50RGF0ZShldmVudCkge1xyXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCIvXCIpIHtcclxuICAgICAgY29uc3QgZCAgPSBtb21lbnQobmV3IERhdGUoKSkuZm9ybWF0KCdZWVlZL01NL0REJyk7XHJcbiAgICAgIHRoaXMudmFsdWUgPSBkO1xyXG4gICAgICBldmVudC50YXJnZXQudmFsdWUgPSBkLnJlcGxhY2UoL1xcLy9nLCAnLScpO1xyXG4gICAgICB0aGlzLm9uQ2hhbmdlKGV2ZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOaXpeS7mOODh+ODvOOCv+OBruODleOCqeODvOODnuODg+ODiOWkieabtOOCkuihjOOBhlxyXG4gICAqIEBwYXJhbSBkYXRlIOaXpeS7mOODh+ODvOOCv1xyXG4gICAqIEByZXR1cm4g5pel5LuY5paH5a2X5YiXXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBnZXRmb21hdGVkRGF0ZShkYXRlKSB7XHJcbiAgICBpZiAoIWRhdGUpIHJldHVybiBcIlwiO1xyXG4gICAgY29uc3QgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO1xyXG4gICAgaWYgKHRvU3RyaW5nLmNhbGwoZGF0ZSkgPT0gXCJbb2JqZWN0IERhdGVdXCIpIHtcclxuICAgICAgY29uc3QgeyB5ZWFyLCBtb250aCwgZGF5IH0gPSB0aGlzLnBhZGRpbmdEYXRlKGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCkpO1xyXG4gICAgICByZXR1cm4gYCR7eWVhcn0vJHttb250aH0vJHtkYXl9YDtcclxuICAgIH0gXHJcbiAgICBlbHNlIHtcclxuICAgICAgY29uc3QgeyB5ZWFyLCBtb250aCwgZGF5IH0gPSB0aGlzLnBhZGRpbmdEYXRlKGRhdGUpO1xyXG4gICAgICBpZiAoZGF0ZS5tYXRjaCgvLS8pKVxyXG4gICAgICAgIHJldHVybiBgJHt5ZWFyfS8ke21vbnRofS8ke2RheX1gO1xyXG4gICAgICBlbHNlXHJcbiAgICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fWA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDml6Xku5jmloflrZfliJfjga7lubTmnIjml6XliIblibLjgqrjg5bjgrjjgqfjgq/jg4jjgpLov5TljbTjgZnjgotcclxuICAgKiBAcGFyYW0gZGF0ZVN0ciDml6Xku5jmloflrZfliJdcclxuICAgKiBAcmV0dXJuIOWIhuWJsuOCquODluOCuOOCp+OCr+ODiCh5ZWFyLCBtb250aCwgZGF5KVxyXG4gICAqL1xyXG4gIHB1YmxpYyBwYWRkaW5nRGF0ZShkYXRlU3RyOiBzdHJpbmcpIHtcclxuICAgIGlmICghZGF0ZVN0cikgcmV0dXJuO1xyXG4gICAgY29uc3QgZGF0ZUFyciA9IGRhdGVTdHIuc3BsaXQoL1stL10vKVxyXG4gICAgbGV0IHllYXIgPSAoQXJyYXkoNCkuam9pbihcIjBcIikgKyBkYXRlQXJyWzBdKS5zbGljZSgtNCk7XHJcbiAgICBjb25zdCBtb250aCA9IChBcnJheSgyKS5qb2luKCcwJykgKyBkYXRlQXJyWzFdKS5zbGljZSgtMik7XHJcbiAgICBjb25zdCBkYXkgPSAoQXJyYXkoMikuam9pbignMCcpICsgZGF0ZUFyclsyXSkuc2xpY2UoLTIpO1xyXG4gICAgcmV0dXJuIHsgeWVhciwgbW9udGgsIGRheSB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDjg5Xjgqnjg7zjg57jg4Pjg4jnt6jpm4ZcclxuICAgKiBAcGFyYW0gdmFsdWUgXHJcbiAgICovXHJcbiAgcHVibGljIGNoYW5nZUZvcm1hdCh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBcIlwiO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBjb25zdCByZXN1bHQgPSBtb21lbnQobmV3IERhdGUodmFsdWUpKS5mb3JtYXQoJ1lZWVnlubRNTeaciERE5pelJyk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxufVxyXG4iXX0=