/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input } from "@angular/core";
import { SmplPopupService } from "../../services/smpl-popup.service";
import { MatDialog } from "@angular/material";
import { SHFormControl } from '../../utilities/ShFormControl';
import { SHCtlPopupDialogMultiComponent } from '../sh-ctl-popup-multi-dialog/sh-ctl-popup-multi-dialog.component';
import { ShCtlConst } from '../../constShCtl';
export class ShCtlPopupMultiComponent extends SHFormControl {
    /**
     * @param {?} SmplPopupService
     * @param {?} dialog
     */
    constructor(SmplPopupService, dialog) {
        super();
        this.SmplPopupService = SmplPopupService;
        this.dialog = dialog;
        //データタイトル名
        this.dataTitle = "";
        //API URL
        this.apiUrl = "/api/";
        //データキャッシュON/OFF機能フラグ
        this.dataCache = false;
        //キーとなる列番号(起動時のチェックを入れるためのキー判定基準になります。)
        this.uniqueColumns = [1];
        //ポップアップ上非表示となる列番号
        this.hiddenColumns = [];
        this.extendWidth = ShCtlConst.DIALOG_WIDTH;
        //Dialogの結果を受け取る
        this.dialogRef = null;
        this.codes = [];
        this.codesHeader = [];
        this.ctlName = "SHCtlPopupMulti";
    }
    /**
     * ダイアログを開いて閉じる時に値を親に返す
     * @return {?}
     */
    openDialog() {
        if (this.codes) {
            if (!this.popupWidth && this.codes.length != 0 && Object.values(this.codes[0]).length >= 4) {
                this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
            }
            this.dialogRef = this.dialog.open(SHCtlPopupDialogMultiComponent, {
                height: ShCtlConst.DIALOG_HEIGHT,
                width: this.extendWidth,
                data: {
                    dataTitle: this.dataTitle,
                    value: this.value,
                    uniqueColumns: this.uniqueColumns,
                    hiddenColumns: this.hiddenColumns,
                }
            });
            this.dialogRef.afterClosed().subscribe((/**
             * @param {?} result
             * @return {?}
             */
            result => {
                if (result != undefined)
                    this.valueChange.emit(result);
            }));
        }
    }
    /**
     * プロパティの初期化
     * 通常サービスにキャッシュしているが、無ければ再度マスタより取得
     * @return {?}
     */
    ngOnInit() {
        this.onInit();
        if (this.popupWidth) {
            this.extendWidth = this.popupWidth;
        }
        // //ユニークな文字列
        if (this.SmplPopupService.getMasterData(this.apiUrl).length >= 0) {
            this.SmplPopupService.fetchAll(this.apiUrl).then((/**
             * @param {?} response
             * @return {?}
             */
            response => {
                this.codes = response.data;
                if (response.header == null) {
                    return;
                }
                this.codesHeader = Object.values(response.header);
                this.dataTitle = response.title;
            }));
        }
    }
    /**
     * マスタ情報よりコードを取得
     * @return {?}
     */
    getCodes() {
        this.openDialog();
        if (this.SmplPopupService.getMasterData(this.apiUrl).length == 0) {
            this.SmplPopupService.fetchAll(this.apiUrl).then((/**
             * @param {?} response
             * @return {?}
             */
            response => {
                this.codes = response.data;
                this.codesHeader = Object.values(response.header);
                this.dataTitle = response.title;
                if (this.dataCache) {
                    this.SmplPopupService.setMasterData(this.apiUrl, response);
                }
                if (this.dialogRef.componentInstance) {
                    this.dialogRef.componentInstance.codesHeader = this.codesHeader;
                    this.dialogRef.componentInstance.unchangeableCodes = this.codes;
                    this.dialogRef.componentInstance.codes = this.codes;
                    if (!this.popupWidth && Object.values(this.codes[0]).length >= 4) {
                        this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
                    }
                    /** @type {?} */
                    let cols = ['select'];
                    this.dialogRef.componentInstance.getHashKeys().forEach((/**
                     * @param {?} name
                     * @param {?} idx
                     * @return {?}
                     */
                    (name, idx) => {
                        if (!this.hiddenColumns.find((/**
                         * @param {?} _
                         * @return {?}
                         */
                        _ => _ == (idx + 1))))
                            cols.push(name);
                    }));
                    this.dialogRef.componentInstance.displayedColumns = cols;
                }
            }));
        }
        else {
            this.codes = Object(this.SmplPopupService.getMasterData(this.apiUrl)).data;
            this.codesHeader = Object.values(Object(this.SmplPopupService.getMasterData(this.apiUrl)).header);
            if (this.dialogRef.componentInstance) {
                this.dialogRef.componentInstance.codesHeader = this.codesHeader;
                this.dialogRef.componentInstance.unchangeableCodes = this.codes;
                this.dialogRef.componentInstance.codes = this.codes;
                if (!this.popupWidth && Object.values(this.codes[0]).length >= 4) {
                    this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
                }
                /** @type {?} */
                let cols = ['select'];
                this.dialogRef.componentInstance.getHashKeys().forEach((/**
                 * @param {?} name
                 * @param {?} idx
                 * @return {?}
                 */
                (name, idx) => {
                    if (!this.hiddenColumns.find((/**
                     * @param {?} _
                     * @return {?}
                     */
                    _ => _ == (idx + 1))))
                        cols.push(name);
                }));
                this.dialogRef.componentInstance.displayedColumns = cols;
            }
        }
    }
}
ShCtlPopupMultiComponent.decorators = [
    { type: Component, args: [{
                selector: 'sh-ctl-popup-multi',
                template: "<div *ngIf=\"!disabled\" style=\"margin-top: 17px;\">\r\n  <mat-icon mat-button matSuffix class=\"mat-search-btn\"\r\n  (click)=\"getCodes()\">search</mat-icon>\r\n</div>",
                styles: [".input-group-text{background-color:#fff;border:none}.btn{border:none}.btn.btn-primary:disabled{background-color:#999}.btn-primary{background-color:#17a2b8}.btn-primary:hover{background-color:#1792b8}.fixed-bottom{top:708px;height:65px;max-width:1024px;margin-right:auto;margin-left:auto}.mat-search-btn{color:#bababa;font-size:1.1rem}.mat-search-btn:hover{cursor:pointer}.mat-icon-container{margin-left:-17px}.mat-icon-container .mat-search-btn{color:#bababa;font-size:1.1rem;margin:17px 0 0 100%}.result-input{text-overflow:ellipsis}.display-ctl-view{display:-webkit-box;display:flex}.display-result{margin-left:30px}.valueOutput-container{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1}.notitle-value{width:100%;margin-left:30px}", ".sh-flex{width:100%;display:-webkit-inline-box;display:inline-flex}.sh-flex-center{-webkit-box-align:center;align-items:center}.sh-flex-between{-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.display-ctl-view{margin-top:20px}.overlay{position:fixed;display:-webkit-box;display:flex;top:0;left:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%;width:100%;color:gray;background-color:rgba(0,0,0,.5);z-index:9999}.loader-text{display:block;color:#f3f3f3;margin-top:1em}.mat-dialog-content{overflow:hidden;max-height:none}.sh-dialog-content{height:85%}.sh-kbn-dialog-table-container{height:92%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-dialog-table-container{display:-webkit-box;display:flex;height:83%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-text-center{text-align:center}.sh-width-100{width:100%}.sh-label{display:block}.custom-alert-message{top:-20px;position:relative;font-size:.75em;color:rgba(0,0,0,.54)}.result-input,.sh-label{color:rgba(0,0,0,.87)}::ng-deep .mat-form-field-label span{color:rgba(0,0,0,.87)}::ng-deep .result-container .mat-form-field-flex{background-color:#ccdcff}.sh-ctl-state-primary::ng-deep .mat-form-field-label{color:#3f51b5}.sh-ctl-state-primary::ng-deep .mat-form-field-underline{background-color:#3f51b5}.sh-ctl-state-primary-message{color:#3f51b5}.sh-ctl-state-secondary::ng-deep .mat-form-field-label{color:#ff4081}.sh-ctl-state-secondary::ng-deep .mat-form-field-underline{background-color:#ff4081}.sh-ctl-state-secondary-message{color:#ff4081}.sh-ctl-state-success::ng-deep .mat-form-field-label{color:#0dad17}.sh-ctl-state-success::ng-deep .mat-form-field-underline{background-color:#0dad17}.sh-ctl-state-success-message{color:#0dad17}.sh-ctl-state-danger::ng-deep .mat-form-field-label{color:#f44336}.sh-ctl-state-danger::ng-deep .mat-form-field-underline{background-color:#f44336}.sh-ctl-state-danger-message{color:#f44336}.sh-ctl-state-warning::ng-deep .mat-form-field-label{color:#e29f2b}.sh-ctl-state-warning::ng-deep .mat-form-field-underline{background-color:#e29f2b}.sh-ctl-state-warning-message{color:#e29f2b}.sh-container{position:relative;width:100%;height:100%}.only-field{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;width:100%;height:100%;min-height:28px}.only-field input,.only-field textarea{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.only-field-danger{background-color:#f44336}.only-field-warning{background-color:#e29f2b}.only-field-success{background-color:#0dad17}::ng-deep .only-field .material-icons{font-size:13px}::ng-deep .only-field .mat-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon{position:absolute;top:0;left:0}::ng-deep .only-field .mat-datepicker-toggle-default-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;margin-right:auto}::ng-deep .mat-datepicker-toggle span svg{width:16px;height:16px}.only-label{background-color:#ccdcff;position:relative}.only-label mat-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;font-size:16px}.bind-flg__input{opacity:0;height:0;width:0;position:absolute;z-index:-100}"]
            }] }
];
/** @nocollapse */
ShCtlPopupMultiComponent.ctorParameters = () => [
    { type: SmplPopupService },
    { type: MatDialog }
];
ShCtlPopupMultiComponent.propDecorators = {
    dataTitle: [{ type: Input }],
    apiUrl: [{ type: Input }],
    dataCache: [{ type: Input }],
    uniqueColumns: [{ type: Input }],
    hiddenColumns: [{ type: Input }],
    popupWidth: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.dataTitle;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.apiUrl;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.dataCache;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.uniqueColumns;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.hiddenColumns;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.popupWidth;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.extendWidth;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.dialogRef;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.codes;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.codesHeader;
    /**
     * @type {?}
     * @protected
     */
    ShCtlPopupMultiComponent.prototype.SmplPopupService;
    /**
     * @type {?}
     * @protected
     */
    ShCtlPopupMultiComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY3RsLXBvcHVwLW11bHRpLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NoLWZvcm0tY29udHJvbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3NoLWN0bC1wb3B1cC1tdWx0aS9zaC1jdGwtcG9wdXAtbXVsdGkuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUNyRSxPQUFPLEVBQUUsU0FBUyxFQUFnQixNQUFNLG1CQUFtQixDQUFDO0FBQzVELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxrRUFBa0UsQ0FBQztBQUNsSCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFPOUMsTUFBTSxPQUFPLHdCQUF5QixTQUFRLGFBQWtCOzs7OztJQW9CNUQsWUFDWSxnQkFBa0MsRUFDbEMsTUFBaUI7UUFFM0IsS0FBSyxFQUFFLENBQUM7UUFIRSxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQ2xDLFdBQU0sR0FBTixNQUFNLENBQVc7O1FBcEJiLGNBQVMsR0FBVyxFQUFFLENBQUM7O1FBRXZCLFdBQU0sR0FBVyxPQUFPLENBQUM7O1FBRXpCLGNBQVMsR0FBWSxLQUFLLENBQUM7O1FBRTNCLGtCQUFhLEdBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQzs7UUFFN0Isa0JBQWEsR0FBWSxFQUFFLENBQUM7UUFHcEMsZ0JBQVcsR0FBRyxVQUFVLENBQUMsWUFBWSxDQUFDOztRQUV2QyxjQUFTLEdBQXFELElBQUksQ0FBQztRQUVuRSxVQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFPdEIsSUFBSSxDQUFDLE9BQU8s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SUFBSSxDQUFDLENBQUM7Z0JBQ3ZFLENBQUMsRUFBQyxDQUFDO2dCQUNILElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO2FBQzFEO1NBQ0Y7SUFDSCxDQUFDOzs7WUEvSEosU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxvQkFBb0I7Z0JBQzlCLHNMQUFrRDs7YUFFbkQ7Ozs7WUFWUSxnQkFBZ0I7WUFDaEIsU0FBUzs7O3dCQVliLEtBQUs7cUJBRUwsS0FBSzt3QkFFTCxLQUFLOzRCQUVMLEtBQUs7NEJBRUwsS0FBSzt5QkFFSixLQUFLOzs7O0lBVlAsNkNBQXVDOztJQUV2QywwQ0FBeUM7O0lBRXpDLDZDQUEyQzs7SUFFM0MsaURBQTZDOztJQUU3QyxpREFBNEM7O0lBRTNDLDhDQUFtQzs7SUFDbkMsK0NBQTZDOztJQUU5Qyw2Q0FBMEU7O0lBRTFFLHlDQUFrQjs7SUFDbEIsK0NBQXdCOzs7OztJQUd0QixvREFBNEM7Ozs7O0lBQzVDLDBDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFNtcGxQb3B1cFNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvc21wbC1wb3B1cC5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IE1hdERpYWxvZywgTWF0RGlhbG9nUmVmIH0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsXCI7XHJcbmltcG9ydCB7IFNIRm9ybUNvbnRyb2wgfSBmcm9tICcuLi8uLi91dGlsaXRpZXMvU2hGb3JtQ29udHJvbCc7XHJcbmltcG9ydCB7IFNIQ3RsUG9wdXBEaWFsb2dNdWx0aUNvbXBvbmVudCB9IGZyb20gJy4uL3NoLWN0bC1wb3B1cC1tdWx0aS1kaWFsb2cvc2gtY3RsLXBvcHVwLW11bHRpLWRpYWxvZy5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBTaEN0bENvbnN0IH0gZnJvbSAnLi4vLi4vY29uc3RTaEN0bCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3NoLWN0bC1wb3B1cC1tdWx0aScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3NoLWN0bC1wb3B1cC1tdWx0aS5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vc2gtY3RsLXBvcHVwLW11bHRpLmNvbXBvbmVudC5jc3MnLCAnLi4vLi4vLi4vc3R5bGUuY29tbW9uLmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTaEN0bFBvcHVwTXVsdGlDb21wb25lbnQgZXh0ZW5kcyBTSEZvcm1Db250cm9sPGFueT4gaW1wbGVtZW50cyBPbkluaXQge1xyXG4gICAgLy/jg4fjg7zjgr/jgr/jgqTjg4jjg6vlkI1cclxuICAgIEBJbnB1dCgpIHB1YmxpYyBkYXRhVGl0bGU6IHN0cmluZyA9IFwiXCI7XHJcbiAgICAvL0FQSSBVUkxcclxuICAgIEBJbnB1dCgpIHB1YmxpYyBhcGlVcmw6IHN0cmluZyA9IFwiL2FwaS9cIjtcclxuICAgIC8v44OH44O844K/44Kt44Oj44OD44K344OlT04vT0ZG5qmf6IO944OV44Op44KwXHJcbiAgICBASW5wdXQoKSBwdWJsaWMgZGF0YUNhY2hlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICAvL+OCreODvOOBqOOBquOCi+WIl+eVquWPtyjotbfli5XmmYLjga7jg4Hjgqfjg4Pjgq/jgpLlhaXjgozjgovjgZ/jgoHjga7jgq3jg7zliKTlrprln7rmupbjgavjgarjgorjgb7jgZnjgIIpXHJcbiAgICBASW5wdXQoKSBwdWJsaWMgdW5pcXVlQ29sdW1uczpudW1iZXJbXSA9IFsxXTtcclxuICAgIC8v44Od44OD44OX44Ki44OD44OX5LiK6Z2e6KGo56S644Go44Gq44KL5YiX55Wq5Y+3XHJcbiAgICBASW5wdXQoKSBwdWJsaWMgaGlkZGVuQ29sdW1uczpudW1iZXJbXSA9IFtdO1xyXG4gICAgIC8vIOODgOOCpOOCouODreOCsOOBruW5heOCkuaMh+WumlxyXG4gICAgIEBJbnB1dCgpIHB1YmxpYyBwb3B1cFdpZHRoOiBzdHJpbmc7XHJcbiAgICAgcHVibGljIGV4dGVuZFdpZHRoID0gU2hDdGxDb25zdC5ESUFMT0dfV0lEVEg7XHJcbiAgICAvL0RpYWxvZ+OBrue1kOaenOOCkuWPl+OBkeWPluOCi1xyXG4gICAgcHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPFNIQ3RsUG9wdXBEaWFsb2dNdWx0aUNvbXBvbmVudCxhbnk+ID0gbnVsbDtcclxuXHJcbiAgICBwdWJsaWMgY29kZXMgPSBbXTtcclxuICAgIHB1YmxpYyBjb2Rlc0hlYWRlciA9IFtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICBwcm90ZWN0ZWQgU21wbFBvcHVwU2VydmljZTogU21wbFBvcHVwU2VydmljZSxcclxuICAgICAgcHJvdGVjdGVkIGRpYWxvZzogTWF0RGlhbG9nLFxyXG4gICAgKSB7XHJcbiAgICAgIHN1cGVyKCk7XHJcbiAgICAgIHRoaXMuY3RsTmFtZSA9IFwiU0hDdGxQb3B1cE11bHRpXCI7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDjg4DjgqTjgqLjg63jgrDjgpLplovjgYTjgabplonjgZjjgovmmYLjgavlgKTjgpLopqrjgavov5TjgZlcclxuICAgICAqL1xyXG4gICAgcHVibGljIG9wZW5EaWFsb2coKSB7XHJcbiAgICAgIGlmICh0aGlzLmNvZGVzKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLnBvcHVwV2lkdGggJiYgdGhpcy5jb2Rlcy5sZW5ndGggIT0gMCAmJiBPYmplY3QudmFsdWVzKHRoaXMuY29kZXNbMF0pLmxlbmd0aCA+PSA0KSB7XHJcbiAgICAgICAgICB0aGlzLmV4dGVuZFdpZHRoID0gU2hDdGxDb25zdC5ESUFMT0dfTUFYX1dJRFRIO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oU0hDdGxQb3B1cERpYWxvZ011bHRpQ29tcG9uZW50LCB7XHJcbiAgICAgICAgICBoZWlnaHQ6IFNoQ3RsQ29uc3QuRElBTE9HX0hFSUdIVCxcclxuICAgICAgICAgIHdpZHRoOiB0aGlzLmV4dGVuZFdpZHRoLFxyXG4gICAgICAgICAgZGF0YTogeyBcclxuICAgICAgICAgICAgICBkYXRhVGl0bGU6IHRoaXMuZGF0YVRpdGxlLFxyXG4gICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlLFxyXG4gICAgICAgICAgICAgIHVuaXF1ZUNvbHVtbnM6IHRoaXMudW5pcXVlQ29sdW1ucyxcclxuICAgICAgICAgICAgICBoaWRkZW5Db2x1bW5zOiB0aGlzLmhpZGRlbkNvbHVtbnMsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKS5zdWJzY3JpYmUocmVzdWx0ID0+IHtcclxuICAgICAgICAgIGlmIChyZXN1bHQgIT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQocmVzdWx0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICrjg5fjg63jg5Hjg4bjgqPjga7liJ3mnJ/ljJZcclxuICAgICAq6YCa5bi444K144O844OT44K544Gr44Kt44Oj44OD44K344Ol44GX44Gm44GE44KL44GM44CB54Sh44GR44KM44Gw5YaN5bqm44Oe44K544K/44KI44KK5Y+W5b6XXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBuZ09uSW5pdCgpIHtcclxuICAgICAgdGhpcy5vbkluaXQoKTtcclxuICAgICAgaWYodGhpcy5wb3B1cFdpZHRoKSB7XHJcbiAgICAgICAgdGhpcy5leHRlbmRXaWR0aCA9IHRoaXMucG9wdXBXaWR0aFxyXG4gICAgICB9ICBcclxuICAgICAgLy8gLy/jg6bjg4vjg7zjgq/jgarmloflrZfliJdcclxuICAgICAgaWYgKHRoaXMuU21wbFBvcHVwU2VydmljZS5nZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsKS5sZW5ndGggPj0gMCkge1xyXG4gICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5mZXRjaEFsbCh0aGlzLmFwaVVybCkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmNvZGVzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgIGlmIChyZXNwb25zZS5oZWFkZXIgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHRoaXMuY29kZXNIZWFkZXIgPSBPYmplY3QudmFsdWVzKHJlc3BvbnNlLmhlYWRlcik7XHJcbiAgICAgICAgICB0aGlzLmRhdGFUaXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgXHJcbiAgICAvKipcclxuICAgICAqIOODnuOCueOCv+aDheWgseOCiOOCiuOCs+ODvOODieOCkuWPluW+l1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0Q29kZXMoKSB7XHJcbiAgICAgIHRoaXMub3BlbkRpYWxvZygpO1xyXG4gICAgICBpZiAodGhpcy5TbXBsUG9wdXBTZXJ2aWNlLmdldE1hc3RlckRhdGEodGhpcy5hcGlVcmwpLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgdGhpcy5TbXBsUG9wdXBTZXJ2aWNlLmZldGNoQWxsKHRoaXMuYXBpVXJsKS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgIHRoaXMuY29kZXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgdGhpcy5jb2Rlc0hlYWRlciA9IE9iamVjdC52YWx1ZXMocmVzcG9uc2UuaGVhZGVyKTtcclxuICAgICAgICAgIHRoaXMuZGF0YVRpdGxlID0gcmVzcG9uc2UudGl0bGU7XHJcbiAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKHRoaXMuZGF0YUNhY2hlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5zZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsLCByZXNwb25zZSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29kZXNIZWFkZXIgPSB0aGlzLmNvZGVzSGVhZGVyO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLnVuY2hhbmdlYWJsZUNvZGVzID0gdGhpcy5jb2RlcztcclxuICAgICAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5jb2RlcyA9IHRoaXMuY29kZXM7XHJcbiAgICAgICAgICAgICAgaWYgKCF0aGlzLnBvcHVwV2lkdGggJiYgT2JqZWN0LnZhbHVlcyh0aGlzLmNvZGVzWzBdKS5sZW5ndGggPj0gNCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5leHRlbmRXaWR0aCA9IFNoQ3RsQ29uc3QuRElBTE9HX01BWF9XSURUSDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgbGV0IGNvbHMgPSBbJ3NlbGVjdCddO1xyXG4gICAgICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmdldEhhc2hLZXlzKCkuZm9yRWFjaCgobmFtZSwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5oaWRkZW5Db2x1bW5zLmZpbmQoXyA9PiBfID09IChpZHggKyAxKSkpIGNvbHMucHVzaChuYW1lKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5kaXNwbGF5ZWRDb2x1bW5zID0gY29scztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY29kZXMgPSBPYmplY3QodGhpcy5TbXBsUG9wdXBTZXJ2aWNlLmdldE1hc3RlckRhdGEodGhpcy5hcGlVcmwpKS5kYXRhO1xyXG4gICAgICAgIHRoaXMuY29kZXNIZWFkZXIgPSBPYmplY3QudmFsdWVzKE9iamVjdCh0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZ2V0TWFzdGVyRGF0YSh0aGlzLmFwaVVybCkpLmhlYWRlcik7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlKSB7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5jb2Rlc0hlYWRlciA9IHRoaXMuY29kZXNIZWFkZXI7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS51bmNoYW5nZWFibGVDb2RlcyA9IHRoaXMuY29kZXM7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5jb2RlcyA9IHRoaXMuY29kZXM7XHJcbiAgICAgICAgICBpZiAoIXRoaXMucG9wdXBXaWR0aCAmJiBPYmplY3QudmFsdWVzKHRoaXMuY29kZXNbMF0pLmxlbmd0aCA+PSA0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kV2lkdGggPSBTaEN0bENvbnN0LkRJQUxPR19NQVhfV0lEVEg7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBsZXQgY29scyA9IFsnc2VsZWN0J107XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5nZXRIYXNoS2V5cygpLmZvckVhY2goKG5hbWUsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICghdGhpcy5oaWRkZW5Db2x1bW5zLmZpbmQoXyA9PiBfID09IChpZHggKyAxKSkpIGNvbHMucHVzaChuYW1lKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuZGlzcGxheWVkQ29sdW1ucyA9IGNvbHM7ICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIFxyXG59XHJcbiJdfQ==