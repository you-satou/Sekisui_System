/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ElementRef } from "@angular/core";
import { SHCtlCommon } from "../sh-ctl-common";
import { SHFormControl } from "../../utilities/ShFormControl";
import { FormControl } from "@angular/forms";
import * as _moment from "moment";
/** @type {?} */
const moment = _moment;
export class SHCtlYearMonthComponent extends SHFormControl {
    /**
     * @param {?} el
     */
    constructor(el) {
        super();
        this.el = el;
        this.isValidateError = false;
        this.errorMessage = "日付に誤りがあります。";
        this.cache = { year: null, month: null };
        this.date = new FormControl(moment());
        this.max = "9999-12";
        this.min = "1000-12";
        this.ctlName = "SHCtlYearMonth";
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (!changes.value) {
            return;
        }
        if (!changes.value.currentValue) {
            this.value = "";
            return;
        }
        if (changes.value.currentValue.length >= 7) {
            this.value = "";
            return;
        }
        if (changes.value.currentValue) {
            this.value = this.toText(changes.value.currentValue);
        }
    }
    /**
     * @param {?} date
     * @return {?}
     */
    getYearAndManth(date) {
        if (!date)
            return;
        /** @type {?} */
        const val = new Date(date).toLocaleDateString().split('/');
        /** @type {?} */
        const year = val[0];
        /** @type {?} */
        const month = val[1];
        return `${year}${month}`;
    }
    /**
     * @return {?}
     */
    ngAfterContentChecked() {
        if (this.value != null && this.isDisabled) {
            this.changeFormat(this.value.replace("-", ""));
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.onInit();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        super.ngAfterViewInit();
        if (!this.isDisabled) {
            /** @type {?} */
            let element = (/** @type {?} */ (this.el.nativeElement.querySelector('input')));
            element.setAttribute("max", this.max);
            element.setAttribute("min", this.min);
        }
    }
    /**
     * onOpened
     * @return {?}
     */
    onOpened() {
        /** @type {?} */
        let el = document.querySelector("mat-datepicker-content");
        el.addEventListener("focusin", (/**
         * @return {?}
         */
        () => {
            this.isfocused = true;
        }));
    }
    /**
     * onClosed
     * @return {?}
     */
    onClosed() {
        /** @type {?} */
        let inputValue = (/** @type {?} */ (document.querySelector(`textarea[name=` + this.ctlName + `], input[name=` + this.ctlName + `]`)));
        setTimeout((/**
         * @return {?}
         */
        function () { inputValue.dispatchEvent(new Event('focus')); }), 0);
    }
    /**
     * onInput
     * @param {?} event input
     * @return {?}
     */
    onInput(event) {
        this.yearAndMonthCalculation(event);
    }
    /**
     * onKeypress
     * @param {?} event keypress
     * @return {?}
     */
    onKeypress(event) {
        this.yearAndMonthCalculation(event);
    }
    /**
     * onClick
     * @param {?} event click
     * @return {?}
     */
    onClick(event) {
        this.onBeforeClick(event);
        this.onAfterClick(event);
    }
    /**
     * onChange
     * @param {?} event change
     * @return {?}
     */
    onChange(event) {
        this.onBeforeChange(event);
        this.valueChange.emit(this.toValue(event.target.value));
        setTimeout((/**
         * @return {?}
         */
        () => { this.onAfterChange(event); }), 0);
    }
    /**
     * onFocus
     * @param {?} event focus
     * @return {?}
     */
    onFocus(event) {
        this.onBeforeFocus(event);
        this.value = this.toText(event.target.value);
        event.target.select();
        setTimeout((/**
         * @return {?}
         */
        () => { this.onAfterFocus(event); }), 0);
        return true;
    }
    /**
     * onBlur
     * @param {?} event blur
     * @return {?}
     */
    onBlur(event) {
        this.onBeforeBlur(event);
        setTimeout((/**
         * @return {?}
         */
        () => { this.onAfterBlur(event); }), 0);
        ;
    }
    /**
     * 年月計算
     * @private
     * @param {?} event
     * @return {?}
     */
    yearAndMonthCalculation(event) {
        /** @type {?} */
        let key = this.isKeysAllowedToMe(event);
        if (key === 0) {
            this.setCurrentDate(event);
            this.onChange(event);
        }
    }
    /**
     * 自タイプに許容されているキー
     * @private
     * @param {?} event keypress
     * @return {?}
     */
    isKeysAllowedToMe(event) {
        if (event.key === SHCtlCommon.Const.keyCodes.signs[191]) {
            return 0;
        }
        return null;
    }
    /**
     * 本日日付の設定
     * @param {?} event keypress
     * @return {?}
     */
    setCurrentDate(event) {
        /** @type {?} */
        let newDate = new Date();
        /** @type {?} */
        let nullFirstString = null;
        /** @type {?} */
        let nullLastString = null;
        nullFirstString = SHCtlCommon.padding(newDate.getFullYear(), 4); // YYYY
        nullLastString = SHCtlCommon.padding(newDate.getMonth() + 1, 2); // MM
        event.target.value = String(nullFirstString + "-" + nullLastString);
    }
    /**
     * 接頭語付与
     * @param {?} inputTargetValue num.substr(0, 2)
     * @return {?}
     */
    convYear(inputTargetValue) {
        if (inputTargetValue >= "00" && inputTargetValue <= 49) {
            return "20" + inputTargetValue;
        }
        else {
            return "19" + inputTargetValue;
        }
    }
    /**
     * YYYY/MM処理
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    toText(inputTargetValue) {
        /** @type {?} */
        let num = inputTargetValue.toString().replace(/\//g, "");
        if (num.trim().length === 0) {
            return "";
        }
        // 4桁西暦
        if (num.length === 3 || num.length === 4) {
            // // 接頭語取得
            return SHCtlCommon.padding(num, 4) + "-01";
        }
        else if (num.length === 5 || num.length === 6) {
            // 接頭語取得
            /** @type {?} */
            let year = num.substr(0, 4) + "-" + ("00" + num.substr(4)).slice(-2);
            return year;
        }
        else {
            return inputTargetValue;
        }
    }
    /**
     * 接続文字除去
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    toValue(inputTargetValue) {
        return new String(inputTargetValue).replace("-", "");
    }
    /**
     * フォーマット編集
     * @param {?} value this.value
     * @return {?}
     */
    changeFormat(value) {
        if (value != null && value != undefined && value.length === 6) {
            /** @type {?} */
            let nullFirstString = null;
            /** @type {?} */
            let nullLastString = null;
            nullFirstString = value.slice(0, 4);
            nullLastString = value.slice(4, 6);
            this.stringValue = String(nullFirstString + "年" + nullLastString + "月");
            return this.stringValue;
        }
        else {
            this.stringValue = '';
            return this.stringValue;
        }
    }
}
SHCtlYearMonthComponent.decorators = [
    { type: Component, args: [{
                selector: "sh-ctl-year-month",
                template: "<ng-container *ngIf=\"!onlyField; else onlyFieldControl\">\r\n  <div *ngIf=\"!isDisabled\" (focusin)=\"onFocusin($event)\" (focusout)=\"onFocusout($event)\">\r\n    <mat-form-field class=\"mat-validation\" [floatLabel]=\"floatLabel\">\r\n      <input #inputElm matInput type=\"month\" max=\"{{max}}\" min=\"{{min}}\" attr.name=\"{{ctlName}}\"\r\n        class=\"form-control ShCtlYearMonth can-moved-with-the-enter-key {{strClass}}\" [placeholder]=\"title\"\r\n        [required]=\"required\" [disabled]=\"disabled\" [class.isValidateError]=\"isValidateError\" [ngStyle]=\"styles\"\r\n        [ngClass]=\"objClass\" [(ngModel)]=\"value\" (keypress)=\"onKeypress($event)\" (click)=\"onClick($event)\"\r\n        (change)=\"onChange($event)\" (focus)=\"onFocus($event)\" (input)=\"onInput($event)\" />\r\n      <button mat-button *ngIf=\"inputElm.value && !inputElm.readOnly && !inputElm.disabled\" matSuffix mat-icon-button\r\n        aria-label=\"Clear\" (mousedown)=\"clearValue()\" (keydown)=\"clickClearButton($event)\">\r\n        <mat-icon>close</mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n    <span class=\"custom-alert-message\">{{message.toString().split(',').join(' ')}}</span>\r\n  </div>\r\n</ng-container>\r\n\r\n<ng-template #onlyFieldControl>\r\n  <div class=\"only-field\" (focusin)=\"onFocusin($event)\" (focusout)=\"onFocusout($event)\">\r\n    <input #inputElm matInput type=\"month\" max=\"{{max}}\" min=\"{{min}}\" attr.name=\"{{ctlName}}\"\r\n        class=\"form-control ShCtlYearMonth can-moved-with-the-enter-key {{strClass}}\" [placeholder]=\"title\"\r\n        [required]=\"required\" [disabled]=\"disabled\" [class.isValidateError]=\"isValidateError\" [ngStyle]=\"styles\"\r\n        [ngClass]=\"objClass\" [(ngModel)]=\"value\" (keypress)=\"onKeypress($event)\" (click)=\"onClick($event)\"\r\n        (change)=\"onChange($event)\" (focus)=\"onFocus($event)\" (input)=\"onInput($event)\" />\r\n    <button mat-button *ngIf=\"inputElm.value && !inputElm.readOnly && !inputElm.disabled\" matSuffix mat-icon-button\r\n      aria-label=\"Clear\" (mousedown)=\"clearValue()\" (keydown)=\"clickClearButton($event)\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n</ng-template>\r\n\r\n<div *ngIf=\"isDisabled\" class=\"display-ctl-view\">\r\n  <div>\r\n    <div *ngIf=\"title\" class=\"display-ctl-view\">\r\n      <div class=\"display-result\" [ngStyle]=\"{'width.px': labelWidth}\" fxLayout=\"row wrap\" fxFlex>\r\n        <div fxFlex class=\"item-title\"><strong>{{title}}:</strong></div>\r\n      </div>\r\n      <div fxFlex class=\"valueOutput\">\r\n        {{stringValue}}\r\n      </div>\r\n    </div>\r\n\r\n    <div *ngIf=\"!title\" class=\"display-ctl-view notitle-value\">\r\n      <div fxFlex class=\"valueOutput\">\r\n        {{stringValue}}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                styles: [".isValidateError{background-color:#ffd2ff}.display-ctl-view{display:-webkit-box;display:flex}.display-result{margin-left:30px}.valueOutput{-webkit-box-flex:1;flex:1}.notitle-value{width:100%;margin-left:30px}", ".sh-flex{width:100%;display:-webkit-inline-box;display:inline-flex}.sh-flex-center{-webkit-box-align:center;align-items:center}.sh-flex-between{-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.display-ctl-view{margin-top:20px}.overlay{position:fixed;display:-webkit-box;display:flex;top:0;left:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%;width:100%;color:gray;background-color:rgba(0,0,0,.5);z-index:9999}.loader-text{display:block;color:#f3f3f3;margin-top:1em}.mat-dialog-content{overflow:hidden;max-height:none}.sh-dialog-content{height:85%}.sh-kbn-dialog-table-container{height:92%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-dialog-table-container{display:-webkit-box;display:flex;height:83%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-text-center{text-align:center}.sh-width-100{width:100%}.sh-label{display:block}.custom-alert-message{top:-20px;position:relative;font-size:.75em;color:rgba(0,0,0,.54)}.result-input,.sh-label{color:rgba(0,0,0,.87)}::ng-deep .mat-form-field-label span{color:rgba(0,0,0,.87)}::ng-deep .result-container .mat-form-field-flex{background-color:#ccdcff}.sh-ctl-state-primary::ng-deep .mat-form-field-label{color:#3f51b5}.sh-ctl-state-primary::ng-deep .mat-form-field-underline{background-color:#3f51b5}.sh-ctl-state-primary-message{color:#3f51b5}.sh-ctl-state-secondary::ng-deep .mat-form-field-label{color:#ff4081}.sh-ctl-state-secondary::ng-deep .mat-form-field-underline{background-color:#ff4081}.sh-ctl-state-secondary-message{color:#ff4081}.sh-ctl-state-success::ng-deep .mat-form-field-label{color:#0dad17}.sh-ctl-state-success::ng-deep .mat-form-field-underline{background-color:#0dad17}.sh-ctl-state-success-message{color:#0dad17}.sh-ctl-state-danger::ng-deep .mat-form-field-label{color:#f44336}.sh-ctl-state-danger::ng-deep .mat-form-field-underline{background-color:#f44336}.sh-ctl-state-danger-message{color:#f44336}.sh-ctl-state-warning::ng-deep .mat-form-field-label{color:#e29f2b}.sh-ctl-state-warning::ng-deep .mat-form-field-underline{background-color:#e29f2b}.sh-ctl-state-warning-message{color:#e29f2b}.sh-container{position:relative;width:100%;height:100%}.only-field{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;width:100%;height:100%;min-height:28px}.only-field input,.only-field textarea{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.only-field-danger{background-color:#f44336}.only-field-warning{background-color:#e29f2b}.only-field-success{background-color:#0dad17}::ng-deep .only-field .material-icons{font-size:13px}::ng-deep .only-field .mat-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon{position:absolute;top:0;left:0}::ng-deep .only-field .mat-datepicker-toggle-default-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;margin-right:auto}::ng-deep .mat-datepicker-toggle span svg{width:16px;height:16px}.only-label{background-color:#ccdcff;position:relative}.only-label mat-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;font-size:16px}.bind-flg__input{opacity:0;height:0;width:0;position:absolute;z-index:-100}"]
            }] }
];
/** @nocollapse */
SHCtlYearMonthComponent.ctorParameters = () => [
    { type: ElementRef }
];
SHCtlYearMonthComponent.propDecorators = {
    max: [{ type: Input }],
    min: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.isValidateError;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.errorMessage;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.adjust;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.stringValue;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.cache;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.date;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.max;
    /** @type {?} */
    SHCtlYearMonthComponent.prototype.min;
    /**
     * @type {?}
     * @private
     */
    SHCtlYearMonthComponent.prototype.el;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY3RsLXllYXItbW9udGguY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vc2gtZm9ybS1jb250cm9sLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvc2gtY3RsLXllYXItbW9udGgvc2gtY3RsLXllYXItbW9udGguY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFHTCxVQUFVLEVBRVgsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFZN0MsT0FBTyxLQUFLLE9BQU8sTUFBTSxRQUFRLENBQUM7O01BRzVCLE1BQU0sR0FBRyxPQUFPO0FBWXRCLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxhQUFxQjs7OztJQVVoRSxZQUFvQixFQUFjO1FBQ2hDLEtBQUssRUFBRSxDQUFDO1FBRFUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQVIzQixvQkFBZSxHQUFZLEtBQUssQ0FBQztRQUNqQyxpQkFBWSxHQUFXLGFBQWEsQ0FBQztRQUdyQyxVQUFLLEdBQWlCLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDbEQsU0FBSSxHQUFHLElBQUksV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDeEIsUUFBRyxHQUFHLFNBQVMsQ0FBQztRQUNoQixRQUFHLEdBQUcsU0FBUyxDQUFDO1FBRzlCLElBQUksQ0FBQyxPQUFPLEdBQUcsZ0JBQWdCLENBQUM7SUFDbEMsQ0FBQzs7Ozs7SUFFTSxXQUFXLENBQUMsT0FBc0I7UUFDdkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDbEIsT0FBTztTQUNSO1FBQ0QsSUFB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QUM7WUFDcEMsY0FBYyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxXQUFXLEdBQUcsTUFBTSxDQUFDLGVBQWUsR0FBRyxHQUFHLEdBQUcsY0FBYyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztTQUN6QjthQUFNO1lBQ0wsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7WUFDdEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO1NBQ3pCO0lBRUgsQ0FBQzs7O1lBL09GLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsbUJBQW1CO2dCQUM3QiwrekZBQWlEOzthQUVsRDs7OztZQS9CQyxVQUFVOzs7a0JBd0NULEtBQUs7a0JBQ0wsS0FBSzs7OztJQVBOLGtEQUF3Qzs7SUFDeEMsK0NBQTRDOztJQUM1Qyx5Q0FBbUI7O0lBQ25CLDhDQUF3Qjs7SUFDeEIsd0NBQXlEOztJQUN6RCx1Q0FBd0M7O0lBQ3hDLHNDQUFnQzs7SUFDaEMsc0NBQWdDOzs7OztJQUNwQixxQ0FBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBPbkluaXQsXHJcbiAgSW5wdXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbiAgRWxlbWVudFJlZixcclxuICBBZnRlclZpZXdJbml0XHJcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgU0hDdGxDb21tb24gfSBmcm9tIFwiLi4vc2gtY3RsLWNvbW1vblwiO1xyXG5pbXBvcnQgeyBTSEZvcm1Db250cm9sIH0gZnJvbSBcIi4uLy4uL3V0aWxpdGllcy9TaEZvcm1Db250cm9sXCI7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCI7XHJcbmltcG9ydCB7XHJcbiAgTW9tZW50RGF0ZUFkYXB0ZXIsXHJcbiAgTUFUX01PTUVOVF9EQVRFX0FEQVBURVJfT1BUSU9OU1xyXG59IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC1tb21lbnQtYWRhcHRlclwiO1xyXG5pbXBvcnQge1xyXG4gIERhdGVBZGFwdGVyLFxyXG4gIE1BVF9EQVRFX0ZPUk1BVFMsXHJcbiAgTUFUX0RBVEVfTE9DQUxFLFxyXG4gIE5hdGl2ZURhdGVBZGFwdGVyXHJcbn0gZnJvbSBcIkBhbmd1bGFyL21hdGVyaWFsL2NvcmVcIjtcclxuaW1wb3J0IHsgTWF0RGF0ZXBpY2tlciB9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9kYXRlcGlja2VyXCI7XHJcbmltcG9ydCAqIGFzIF9tb21lbnQgZnJvbSBcIm1vbWVudFwiO1xyXG5pbXBvcnQgeyBNb21lbnQgfSBmcm9tIFwibW9tZW50XCI7XHJcblxyXG5jb25zdCBtb21lbnQgPSBfbW9tZW50O1xyXG5cclxudHlwZSB5ZWFyQW5kTW9udGggPSB7XHJcbiAgeWVhcjogbnVtYmVyO1xyXG4gIG1vbnRoOiBudW1iZXI7XHJcbn07XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogXCJzaC1jdGwteWVhci1tb250aFwiLFxyXG4gIHRlbXBsYXRlVXJsOiBcIi4vc2gtY3RsLXllYXItbW9udGguY29tcG9uZW50Lmh0bWxcIixcclxuICBzdHlsZVVybHM6IFtcIi4vc2gtY3RsLXllYXItbW9udGguY29tcG9uZW50LmNzc1wiLCBcIi4uLy4uLy4uL3N0eWxlLmNvbW1vbi5jc3NcIl0sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTSEN0bFllYXJNb250aENvbXBvbmVudCBleHRlbmRzIFNIRm9ybUNvbnRyb2w8c3RyaW5nPlxyXG4gIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQge1xyXG4gIHB1YmxpYyBpc1ZhbGlkYXRlRXJyb3I6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwdWJsaWMgZXJyb3JNZXNzYWdlOiBzdHJpbmcgPSBcIuaXpeS7mOOBq+iqpOOCiuOBjOOBguOCiuOBvuOBmeOAglwiO1xyXG4gIHB1YmxpYyBhZGp1c3Q6IGFueTtcclxuICBwdWJsaWMgc3RyaW5nVmFsdWU6IGFueTtcclxuICBwdWJsaWMgY2FjaGU6IHllYXJBbmRNb250aCA9IHsgeWVhcjogbnVsbCwgbW9udGg6IG51bGwgfTtcclxuICBwdWJsaWMgZGF0ZSA9IG5ldyBGb3JtQ29udHJvbChtb21lbnQoKSk7XHJcbiAgQElucHV0KCkgcHVibGljIG1heCA9IFwiOTk5OS0xMlwiO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBtaW4gPSBcIjEwMDAtMTJcIjtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmKSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgdGhpcy5jdGxOYW1lID0gXCJTSEN0bFllYXJNb250aFwiO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGlmICghY2hhbmdlcy52YWx1ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoIWNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlKSB7XHJcbiAgICAgIHRoaXMudmFsdWUgPSBcIlwiO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUubGVuZ3RoID49IDcpIHtcclxuICAgICAgdGhpcy52YWx1ZSA9IFwiXCI7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy50b1RleHQoY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFllYXJBbmRNYW50aChkYXRlOiBhbnkpIHtcclxuICAgIGlmICghZGF0ZSkgcmV0dXJuO1xyXG4gICAgY29uc3QgdmFsID0gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVEYXRlU3RyaW5nKCkuc3BsaXQoJy8nKVxyXG4gICAgY29uc3QgeWVhciA9IHZhbFswXTtcclxuICAgIGNvbnN0IG1vbnRoID0gdmFsWzFdO1xyXG4gICAgcmV0dXJuIGAke3llYXJ9JHttb250aH1gO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nQWZ0ZXJDb250ZW50Q2hlY2tlZCgpIHtcclxuICAgIGlmICh0aGlzLnZhbHVlICE9IG51bGwgJiYgdGhpcy5pc0Rpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMuY2hhbmdlRm9ybWF0KHRoaXMudmFsdWUucmVwbGFjZShcIi1cIiwgXCJcIikpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5vbkluaXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICBzdXBlci5uZ0FmdGVyVmlld0luaXQoKTtcclxuICAgIGlmKCF0aGlzLmlzRGlzYWJsZWQpIHtcclxuICAgICAgbGV0IGVsZW1lbnQgPSA8SFRNTEVsZW1lbnQ+dGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwibWF4XCIsIHRoaXMubWF4KTtcclxuICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJtaW5cIiwgdGhpcy5taW4pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25PcGVuZWRcclxuICAgKi9cclxuICBwdWJsaWMgb25PcGVuZWQoKSB7XHJcbiAgICBsZXQgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWF0LWRhdGVwaWNrZXItY29udGVudFwiKTtcclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c2luXCIsICgpID0+IHtcclxuICAgICAgdGhpcy5pc2ZvY3VzZWQgPSB0cnVlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBvbkNsb3NlZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkNsb3NlZCgpIHtcclxuICAgIGxldCBpbnB1dFZhbHVlID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgdGV4dGFyZWFbbmFtZT1gICsgdGhpcy5jdGxOYW1lICsgYF0sIGlucHV0W25hbWU9YCArIHRoaXMuY3RsTmFtZSArIGBdYCk7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7aW5wdXRWYWx1ZS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnZm9jdXMnKSk7fSwwKTsgIFxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25JbnB1dFxyXG4gICAqIEBwYXJhbSBldmVudCBpbnB1dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbklucHV0KGV2ZW50KSB7XHJcbiAgICB0aGlzLnllYXJBbmRNb250aENhbGN1bGF0aW9uKGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uS2V5cHJlc3NcclxuICAgKiBAcGFyYW0gZXZlbnQga2V5cHJlc3NcclxuICAgKi9cclxuICBwdWJsaWMgb25LZXlwcmVzcyhldmVudCkge1xyXG4gICAgdGhpcy55ZWFyQW5kTW9udGhDYWxjdWxhdGlvbihldmVudCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBvbkNsaWNrXHJcbiAgICogQHBhcmFtIGV2ZW50IGNsaWNrXHJcbiAgICovXHJcbiAgcHVibGljIG9uQ2xpY2soZXZlbnQpIHtcclxuICAgIHRoaXMub25CZWZvcmVDbGljayhldmVudCk7XHJcblxyXG4gICAgdGhpcy5vbkFmdGVyQ2xpY2soZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25DaGFuZ2VcclxuICAgKiBAcGFyYW0gZXZlbnQgY2hhbmdlXHJcbiAgICovXHJcbiAgcHVibGljIG9uQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlQ2hhbmdlKGV2ZW50KTtcclxuXHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQodGhpcy50b1ZhbHVlKGV2ZW50LnRhcmdldC52YWx1ZSkpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge3RoaXMub25BZnRlckNoYW5nZShldmVudCl9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uRm9jdXNcclxuICAgKiBAcGFyYW0gZXZlbnQgZm9jdXNcclxuICAgKi9cclxuICBwdWJsaWMgb25Gb2N1cyhldmVudCkge1xyXG4gICAgdGhpcy5vbkJlZm9yZUZvY3VzKGV2ZW50KTtcclxuICAgXHJcbiAgICB0aGlzLnZhbHVlID0gdGhpcy50b1RleHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgIGV2ZW50LnRhcmdldC5zZWxlY3QoKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHt0aGlzLm9uQWZ0ZXJGb2N1cyhldmVudCl9LCAwKTtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25CbHVyXHJcbiAgICogQHBhcmFtIGV2ZW50IGJsdXJcclxuICAgKi9cclxuICBwdWJsaWMgb25CbHVyKGV2ZW50KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlQmx1cihldmVudCk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7dGhpcy5vbkFmdGVyQmx1cihldmVudCk7fSwgMCk7O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5bm05pyI6KiI566XXHJcbiAgICogQHBhcmFtIGV2ZW50IFxyXG4gICAqL1xyXG4gIHByaXZhdGUgeWVhckFuZE1vbnRoQ2FsY3VsYXRpb24oZXZlbnQpIHtcclxuICAgIGxldCBrZXkgPSB0aGlzLmlzS2V5c0FsbG93ZWRUb01lKGV2ZW50KTtcclxuICAgIGlmIChrZXkgPT09IDApIHtcclxuICAgICAgdGhpcy5zZXRDdXJyZW50RGF0ZShldmVudCk7XHJcbiAgICAgIHRoaXMub25DaGFuZ2UoZXZlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6Ieq44K/44Kk44OX44Gr6Kix5a6544GV44KM44Gm44GE44KL44Kt44O8XHJcbiAgICogQHBhcmFtIGV2ZW50IGtleXByZXNzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc0tleXNBbGxvd2VkVG9NZShldmVudDogYW55KSB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSBTSEN0bENvbW1vbi5Db25zdC5rZXlDb2Rlcy5zaWduc1sxOTFdKSB7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmnKzml6Xml6Xku5jjga7oqK3lrppcclxuICAgKiBAcGFyYW0gZXZlbnQga2V5cHJlc3NcclxuICAgKi9cclxuICBwdWJsaWMgc2V0Q3VycmVudERhdGUoZXZlbnQpIHtcclxuICAgIGxldCBuZXdEYXRlID0gbmV3IERhdGUoKTtcclxuICAgIGxldCBudWxsRmlyc3RTdHJpbmcgPSBudWxsO1xyXG4gICAgbGV0IG51bGxMYXN0U3RyaW5nID0gbnVsbDtcclxuICAgIG51bGxGaXJzdFN0cmluZyA9IFNIQ3RsQ29tbW9uLnBhZGRpbmcobmV3RGF0ZS5nZXRGdWxsWWVhcigpLCA0KTsgLy8gWVlZWVxyXG4gICAgbnVsbExhc3RTdHJpbmcgPSBTSEN0bENvbW1vbi5wYWRkaW5nKG5ld0RhdGUuZ2V0TW9udGgoKSArIDEsIDIpOyAvLyBNTVxyXG4gICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gU3RyaW5nKG51bGxGaXJzdFN0cmluZyArIFwiLVwiICsgbnVsbExhc3RTdHJpbmcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5o6l6aCt6Kqe5LuY5LiOXHJcbiAgICogQHBhcmFtIGlucHV0VGFyZ2V0VmFsdWUgbnVtLnN1YnN0cigwLCAyKVxyXG4gICAqL1xyXG4gIHB1YmxpYyBjb252WWVhcihpbnB1dFRhcmdldFZhbHVlKSB7XHJcbiAgICBpZiAoaW5wdXRUYXJnZXRWYWx1ZSA+PSBcIjAwXCIgJiYgaW5wdXRUYXJnZXRWYWx1ZSA8PSA0OSkge1xyXG4gICAgICByZXR1cm4gXCIyMFwiICsgaW5wdXRUYXJnZXRWYWx1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBcIjE5XCIgKyBpbnB1dFRhcmdldFZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogWVlZWS9NTeWHpueQhlxyXG4gICAqIEBwYXJhbSBpbnB1dFRhcmdldFZhbHVlIGV2ZW50LnRhcmdldC52YWx1ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b1RleHQoaW5wdXRUYXJnZXRWYWx1ZSkge1xyXG4gICAgbGV0IG51bSA9IGlucHV0VGFyZ2V0VmFsdWUudG9TdHJpbmcoKS5yZXBsYWNlKC9cXC8vZywgXCJcIik7XHJcbiAgICBpZiAobnVtLnRyaW0oKS5sZW5ndGggPT09IDApIHtcclxuICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9XHJcbiAgICAvLyA05qGB6KW/5pqmXHJcbiAgICBpZiAobnVtLmxlbmd0aCA9PT0gMyB8fCBudW0ubGVuZ3RoID09PSA0KSB7XHJcbiAgICAgIC8vIC8vIOaOpemgreiqnuWPluW+l1xyXG4gICAgICByZXR1cm4gU0hDdGxDb21tb24ucGFkZGluZyhudW0sIDQpICsgXCItMDFcIjtcclxuICAgIH0gZWxzZSBpZiAobnVtLmxlbmd0aCA9PT0gNSB8fCBudW0ubGVuZ3RoID09PSA2KSB7XHJcbiAgICAgIC8vIOaOpemgreiqnuWPluW+l1xyXG4gICAgICBsZXQgeWVhciA9IG51bS5zdWJzdHIoMCwgNCkgKyBcIi1cIiArIChcIjAwXCIgKyBudW0uc3Vic3RyKDQpKS5zbGljZSgtMik7XHJcbiAgICAgIHJldHVybiB5ZWFyO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIGlucHV0VGFyZ2V0VmFsdWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDmjqXntprmloflrZfpmaTljrtcclxuICAgKiBAcGFyYW0gaW5wdXRUYXJnZXRWYWx1ZSBldmVudC50YXJnZXQudmFsdWVcclxuICAgKi9cclxuICBwdWJsaWMgdG9WYWx1ZShpbnB1dFRhcmdldFZhbHVlKSB7XHJcbiAgICByZXR1cm4gbmV3IFN0cmluZyhpbnB1dFRhcmdldFZhbHVlKS5yZXBsYWNlKFwiLVwiLCBcIlwiKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOODleOCqeODvOODnuODg+ODiOe3qOmbhlxyXG4gICAqIEBwYXJhbSB2YWx1ZSB0aGlzLnZhbHVlXHJcbiAgICovXHJcbiAgcHVibGljIGNoYW5nZUZvcm1hdCh2YWx1ZSkge1xyXG4gICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUgIT0gdW5kZWZpbmVkICYmIHZhbHVlLmxlbmd0aCA9PT0gNikge1xyXG4gICAgICBsZXQgbnVsbEZpcnN0U3RyaW5nID0gbnVsbDtcclxuICAgICAgbGV0IG51bGxMYXN0U3RyaW5nID0gbnVsbDtcclxuICAgICAgbnVsbEZpcnN0U3RyaW5nID0gdmFsdWUuc2xpY2UoMCwgNCk7XHJcbiAgICAgIG51bGxMYXN0U3RyaW5nID0gdmFsdWUuc2xpY2UoNCwgNik7XHJcbiAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBTdHJpbmcobnVsbEZpcnN0U3RyaW5nICsgXCLlubRcIiArIG51bGxMYXN0U3RyaW5nICsgXCLmnIhcIik7XHJcbiAgICAgIHJldHVybiB0aGlzLnN0cmluZ1ZhbHVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zdHJpbmdWYWx1ZSA9ICcnO1xyXG4gICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG59Il19