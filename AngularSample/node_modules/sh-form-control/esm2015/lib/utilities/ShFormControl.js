/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Input, Output, EventEmitter, ViewChild, ElementRef, } from "@angular/core";
import { SHCtlCommon } from '../components/sh-ctl-common';
import { MaxByteLengthHistory } from "./MaxByteLengthHistory";
/**
 * @template T
 */
export class SHFormControl {
    constructor() {
        //要素コントロール名
        this.ctlName = "SHFormControl";
        //表示レイアウト切り替えフラグ(true:閲覧専用/false:編集可能)
        this.isDisabled = false;
        //値バインド変数
        this.value = null;
        //タイトル名
        this.title = " ";
        //コントロール挙動(auto/always/nevwer)
        this.floatLabel = "auto";
        //閲覧専用画面でのラベル幅(px)
        this.labelWidth = "150";
        //input要素に対するstyleの指定(形式：{ color: "red" })
        this.styles = {};
        //input要素に対するclassの指定(形式：{ "className": true } or "className className2")
        this.classes = {};
        //input要素に対する必須入力フラグ
        this.required = false;
        //input要素に対する状態の指定
        this.state = "";
        //input要素に対する文言の指定
        this.message = [""];
        //input要素に対する必須入力フラグ
        this.disabled = false;
        //値バインド結果の返却を担う
        this.valueChange = new EventEmitter();
        //BeforeClickイベント返却
        this.beforeClick = new EventEmitter();
        //AfterClickイベント返却
        this.afterClick = new EventEmitter();
        //BeforeFocusイベント返却
        this.beforeFocus = new EventEmitter();
        //AfterFocusイベント返却
        this.afterFocus = new EventEmitter();
        //BeforeBlurイベント返却
        this.beforeBlur = new EventEmitter();
        //AfterBlurイベント返却
        this.afterBlur = new EventEmitter();
        //BeforeChangeイベント返却
        this.beforeChange = new EventEmitter();
        //AfterChangeイベント返却
        this.afterChange = new EventEmitter();
        this.objClass = {};
        this.strClass = "";
        this.isComp = false;
        this.array = [];
        //forcusの保持変数
        this.isfocused = false;
        this.onlyField = false;
    }
    /**
     * @return {?}
     */
    onInit() {
        //クラスの指定方法によって分岐する
        if (typeof this.classes === "string") {
            this.strClass = this.classes;
            this.objClass = null;
        }
        else {
            this.strClass = "";
            this.objClass = this.classes;
        }
    }
    /**
     * onInput
     * @param {?} event input
     * @return {?}
     */
    onInput(event) { }
    /**
     * onKeyDown
     * @param {?} event keydown
     * @return {?}
     */
    onKeyDown(event) { }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        if (!this.maxByteLength)
            return;
        if (this.selfInputElm) {
            this.selfInputElm.nativeElement.addEventListener("keydown", this.handleKeydown.bind(this));
            this.selfInputElm.nativeElement.addEventListener("input", this.handleInput.bind(this));
            this.selfInputElm.nativeElement.addEventListener("compositionstart", this.handleCompositionStart.bind(this));
            this.selfInputElm.nativeElement.addEventListener("compositionend", this.handleCompositionEnd.bind(this));
        }
    }
    /**
     * maxByteLengthの制御
     * @protected
     * @param {?} e
     * @return {?}
     */
    handleKeydown(e) {
        if (!this.maxByteLength)
            return;
        /** @type {?} */
        const value = e.target.value;
        if (value &&
            !this.maxByteLengthHistory &&
            !MaxByteLengthHistory.isAllowOperation(e)) {
            this.maxByteLengthHistory = new MaxByteLengthHistory(value, this.selfInputElm.nativeElement.selectionStart, this.maxByteLength);
        }
    }
    /**
     * \@ あと何byte許容できるかを更新
     * @protected
     * @param {?} e
     * @return {?}
     */
    handleInput(e) {
        if (!this.maxByteLength)
            return;
        this.maxlength = undefined;
        if (!this.maxByteLengthHistory && e.target.value) {
            this.maxByteLengthHistory = this.maxByteLengthHistory = new MaxByteLengthHistory(e.target.value, this.selfInputElm.nativeElement.selectionStart, this.maxByteLength);
        }
        if (this.maxByteLengthHistory) {
            this.maxByteLengthHistory.changeEnterableBytes(e.target.value);
            if (!this.maxByteLengthHistory.getEnterableBytes() && !this.isComp) {
                /** @type {?} */
                const maxLen = this.maxByteLengthHistory.getMaxLength(e.target.value);
                this.maxlength = maxLen;
                if (e.target.value.length > maxLen) {
                    e.target.value = e.target.value.substr(0, maxLen);
                    this.valueChange.emit(e.target.value);
                }
            }
        }
    }
    /**
     * @protected
     * @param {?} e
     * @return {?}
     */
    handleCompositionStart(e) {
        if (!this.maxByteLength)
            return;
        this.isComp = true;
        this.maxlength = undefined;
        if (e.target.value) {
            this.maxByteLengthHistory = this.maxByteLengthHistory = new MaxByteLengthHistory(e.target.value, this.selfInputElm.nativeElement.selectionStart, this.maxByteLength);
        }
        else {
            this.isComp = false;
        }
    }
    /**
     * @protected
     * @param {?} e
     * @return {?}
     */
    handleCompositionEnd(e) {
        if (!this.maxByteLength)
            return;
        /** @type {?} */
        const result = this.maxByteLengthHistory.getResult(e.data, e.target.value.replace(/\n/g, '##')).replace(/##/g, '\n');
        e.target.value = result;
        this.valueChange.emit(result);
        this.maxByteLengthHistory = null;
        this.isComp = false;
    }
    /**
     * onFocusin
     * @param {?} event focusin
     * @return {?}
     */
    onFocusin(event) {
        this.isfocused = true;
    }
    /**
     * onFocusout
     * @param {?} event focusout
     * @return {?}
     */
    onFocusout(event) {
        this.isfocused = false;
        setTimeout((/**
         * @return {?}
         */
        () => {
            if (!this.isfocused)
                this.onBlur(event);
        }), 0);
    }
    /**
     * clickClearButton
     * @param {?} event keydown
     * @return {?}
     */
    clickClearButton(event) {
        if (event.keyCode == SHCtlCommon.Const.keyCodes.enter ||
            event.keyCode == SHCtlCommon.Const.keyCodes.space) {
            //エンターキーで別コントロールにフォーカスが移動しないようにフォーカスを当て直す
            setTimeout((/**
             * @return {?}
             */
            () => {
                /** @type {?} */
                let inputValue = (/** @type {?} */ (document.querySelector(`textarea[name=` + this.ctlName + `], input[name=` + this.ctlName + `]`)));
                inputValue.dispatchEvent(new Event('focus'));
            }), 0);
            this.clearValue();
            return false;
        }
    }
    /**
     * onChange
     * @param {?} event change
     * @return {?}
     */
    onChange(event) {
        this.valueChange.emit(this.value);
    }
    /**
     * onFocus
     * @param {?} event focus
     * @return {?}
     */
    onFocus(event) {
        event.target.select();
    }
    /**
     * onBlur
     * @param {?} event blur
     * @return {?}
     */
    onBlur(event) { }
    /**
     * onBeforeClick
     * @param {?} event
     * @return {?}
     */
    onBeforeClick(event) {
        this.beforeClick.emit(event);
    }
    /**
     * onAfterClick
     * @param {?} event
     * @return {?}
     */
    onAfterClick(event) {
        this.afterClick.emit(event);
    }
    /**
     * onBeforeFocus
     * @param {?} event
     * @return {?}
     */
    onBeforeFocus(event) {
        this.beforeFocus.emit(event);
    }
    /**
     * onAfterFocus
     * @param {?} event
     * @return {?}
     */
    onAfterFocus(event) {
        this.afterFocus.emit(event);
    }
    /**
     * onBeforeBlur
     * @param {?} event
     * @return {?}
     */
    onBeforeBlur(event) {
        this.beforeBlur.emit(event);
    }
    /**
     * onAfterBlur
     * @param {?} event
     * @return {?}
     */
    onAfterBlur(event) {
        this.afterBlur.emit(event);
    }
    /**
     * onBeforeChange
     * @param {?} event
     * @return {?}
     */
    onBeforeChange(event) {
        this.beforeChange.emit(event);
    }
    /**
     * onAfterChange
     * @param {?} event
     * @return {?}
     */
    onAfterChange(event) {
        this.afterChange.emit(event);
    }
    /**
     * 値のクリア
     * @return {?}
     */
    clearValue() {
        this.value = null;
        /** @type {?} */
        let inputValue = (/** @type {?} */ ((document.querySelector(`textarea[name=` + this.ctlName + `], input[name=` + this.ctlName + `]`))));
        //タイミングを遅らせないとchangeイベント内のevent.target.valueが前の値になる
        setTimeout((/**
         * @return {?}
         */
        function () {
            inputValue.dispatchEvent(new Event('change'));
            inputValue.dispatchEvent(new Event('focus'));
        }), 10);
    }
}
SHFormControl.propDecorators = {
    ctlName: [{ type: Input }],
    isDisabled: [{ type: Input }],
    value: [{ type: Input }],
    title: [{ type: Input }],
    floatLabel: [{ type: Input }],
    labelWidth: [{ type: Input }],
    maxlength: [{ type: Input }],
    maxByteLength: [{ type: Input }],
    styles: [{ type: Input }],
    classes: [{ type: Input }],
    required: [{ type: Input }],
    state: [{ type: Input }],
    message: [{ type: Input }],
    items: [{ type: Input }],
    disabled: [{ type: Input }],
    valueChange: [{ type: Output }],
    beforeClick: [{ type: Output }],
    afterClick: [{ type: Output }],
    beforeFocus: [{ type: Output }],
    afterFocus: [{ type: Output }],
    beforeBlur: [{ type: Output }],
    afterBlur: [{ type: Output }],
    beforeChange: [{ type: Output }],
    afterChange: [{ type: Output }],
    selfInputElm: [{ type: ViewChild, args: [`inputElm`, { static: false },] }],
    onlyField: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    SHFormControl.prototype.ctlName;
    /** @type {?} */
    SHFormControl.prototype.isDisabled;
    /** @type {?} */
    SHFormControl.prototype.value;
    /** @type {?} */
    SHFormControl.prototype.title;
    /** @type {?} */
    SHFormControl.prototype.floatLabel;
    /** @type {?} */
    SHFormControl.prototype.labelWidth;
    /** @type {?} */
    SHFormControl.prototype.maxlength;
    /** @type {?} */
    SHFormControl.prototype.maxByteLength;
    /** @type {?} */
    SHFormControl.prototype.styles;
    /** @type {?} */
    SHFormControl.prototype.classes;
    /** @type {?} */
    SHFormControl.prototype.required;
    /** @type {?} */
    SHFormControl.prototype.state;
    /** @type {?} */
    SHFormControl.prototype.message;
    /** @type {?} */
    SHFormControl.prototype.items;
    /** @type {?} */
    SHFormControl.prototype.disabled;
    /** @type {?} */
    SHFormControl.prototype.valueChange;
    /** @type {?} */
    SHFormControl.prototype.beforeClick;
    /** @type {?} */
    SHFormControl.prototype.afterClick;
    /** @type {?} */
    SHFormControl.prototype.beforeFocus;
    /** @type {?} */
    SHFormControl.prototype.afterFocus;
    /** @type {?} */
    SHFormControl.prototype.beforeBlur;
    /** @type {?} */
    SHFormControl.prototype.afterBlur;
    /** @type {?} */
    SHFormControl.prototype.beforeChange;
    /** @type {?} */
    SHFormControl.prototype.afterChange;
    /** @type {?} */
    SHFormControl.prototype.selfInputElm;
    /** @type {?} */
    SHFormControl.prototype.objClass;
    /** @type {?} */
    SHFormControl.prototype.strClass;
    /** @type {?} */
    SHFormControl.prototype.isComp;
    /** @type {?} */
    SHFormControl.prototype.array;
    /** @type {?} */
    SHFormControl.prototype.maxByteLengthHistory;
    /** @type {?} */
    SHFormControl.prototype.isfocused;
    /** @type {?} */
    SHFormControl.prototype.onlyField;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hGb3JtQ29udHJvbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NoLWZvcm0tY29udHJvbC8iLCJzb3VyY2VzIjpbImxpYi91dGlsaXRpZXMvU2hGb3JtQ29udHJvbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUNaLFNBQVMsRUFDVCxVQUFVLEdBQ1gsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDOzs7O0FBRTlELE1BQU0sT0FBTyxhQUFhO0lBZ0V4Qjs7UUE5RGdCLFlBQU8sR0FBVyxlQUFlLENBQUM7O1FBRWxDLGVBQVUsR0FBWSxLQUFLLENBQUM7O1FBRTVCLFVBQUssR0FBTSxJQUFJLENBQUM7O1FBRWhCLFVBQUssR0FBRyxHQUFHLENBQUM7O1FBRVosZUFBVSxHQUFHLE1BQU0sQ0FBQzs7UUFFcEIsZUFBVSxHQUFHLEtBQUssQ0FBQzs7UUFNbkIsV0FBTSxHQUFRLEVBQUUsQ0FBQzs7UUFFakIsWUFBTyxHQUFRLEVBQUUsQ0FBQzs7UUFFbEIsYUFBUSxHQUFZLEtBQUssQ0FBQzs7UUFFMUIsVUFBSyxHQUFXLEVBQUUsQ0FBQzs7UUFFbkIsWUFBTyxHQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7O1FBSXpCLGFBQVEsR0FBWSxLQUFLLENBQUM7O1FBR3pCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFHakMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUVqQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFFaEMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztRQUVqQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQzs7UUFFaEMsZUFBVSxHQUFHLElBQUksWUFBWSxFQUFF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SztvQkFFTCxLQUFLO3NCQUVMLEtBQUs7b0JBRUwsS0FBSzt1QkFFTCxLQUFLOzBCQUdMLE1BQU07MEJBR04sTUFBTTt5QkFFTixNQUFNOzBCQUVOLE1BQU07eUJBRU4sTUFBTTt5QkFFTixNQUFNO3dCQUVOLE1BQU07MkJBRU4sTUFBTTswQkFFTixNQUFNOzJCQUNOLFNBQVMsU0FBQyxVQUFVLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO3dCQVd2QyxLQUFLOzs7O0lBNUROLGdDQUFrRDs7SUFFbEQsbUNBQTRDOztJQUU1Qyw4QkFBZ0M7O0lBRWhDLDhCQUE0Qjs7SUFFNUIsbUNBQW9DOztJQUVwQyxtQ0FBbUM7O0lBRW5DLGtDQUFrQzs7SUFFbEMsc0NBQXNDOztJQUV0QywrQkFBaUM7O0lBRWpDLGdDQUFrQzs7SUFFbEMsaUNBQTBDOztJQUUxQyw4QkFBbUM7O0lBRW5DLGdDQUF5Qzs7SUFFekMsOEJBQTZCOztJQUU3QixpQ0FBMEM7O0lBRzFDLG9DQUFrRDs7SUFHbEQsb0NBQWtEOztJQUVsRCxtQ0FBaUQ7O0lBRWpELG9DQUFrRDs7SUFFbEQsbUNBQWlEOztJQUVqRCxtQ0FBaUQ7O0lBRWpELGtDQUFnRDs7SUFFaEQscUNBQW1EOztJQUVuRCxvQ0FBa0Q7O0lBQ2xELHFDQUFxRjs7SUFFckYsaUNBQTZCOztJQUM3QixpQ0FBNkI7O0lBQzdCLCtCQUFzQjs7SUFDdEIsOEJBQXlCOztJQUN6Qiw2Q0FBa0Q7O0lBR2xELGtDQUFrQzs7SUFFbEMsa0NBQTJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBJbnB1dCxcclxuICBPdXRwdXQsXHJcbiAgRXZlbnRFbWl0dGVyLFxyXG4gIFZpZXdDaGlsZCxcclxuICBFbGVtZW50UmVmLFxyXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFNIQ3RsQ29tbW9uIH0gZnJvbSAnLi4vY29tcG9uZW50cy9zaC1jdGwtY29tbW9uJztcclxuaW1wb3J0IHsgTWF4Qnl0ZUxlbmd0aEhpc3RvcnkgfSBmcm9tIFwiLi9NYXhCeXRlTGVuZ3RoSGlzdG9yeVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNIRm9ybUNvbnRyb2w8VD4ge1xyXG4gIC8v6KaB57Sg44Kz44Oz44OI44Ot44O844Or5ZCNXHJcbiAgQElucHV0KCkgcHVibGljIGN0bE5hbWU6IHN0cmluZyA9IFwiU0hGb3JtQ29udHJvbFwiO1xyXG4gIC8v6KGo56S644Os44Kk44Ki44Km44OI5YiH44KK5pu/44GI44OV44Op44KwKHRydWU66Zay6Kan5bCC55SoL2ZhbHNlOue3qOmbhuWPr+iDvSlcclxuICBASW5wdXQoKSBwdWJsaWMgaXNEaXNhYmxlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIC8v5YCk44OQ44Kk44Oz44OJ5aSJ5pWwXHJcbiAgQElucHV0KCkgcHVibGljIHZhbHVlOiBUID0gbnVsbDtcclxuICAvL+OCv+OCpOODiOODq+WQjVxyXG4gIEBJbnB1dCgpIHB1YmxpYyB0aXRsZSA9IFwiIFwiO1xyXG4gIC8v44Kz44Oz44OI44Ot44O844Or5oyZ5YuVKGF1dG8vYWx3YXlzL25ldndlcilcclxuICBASW5wdXQoKSBwdWJsaWMgZmxvYXRMYWJlbCA9IFwiYXV0b1wiO1xyXG4gIC8v6Zay6Kan5bCC55So55S76Z2i44Gn44Gu44Op44OZ44Or5bmFKHB4KVxyXG4gIEBJbnB1dCgpIHB1YmxpYyBsYWJlbFdpZHRoID0gXCIxNTBcIjtcclxuICAvL2lucHV06KaB57Sg44Gr5a++44GZ44KL5pyA5aSn5YWl5Yqb5paH5a2X5pWwKOioreWumuWPr+iDveOBquOCs+ODs+ODiOODreODvOODq+OBruOBv+mBqeeUqClcclxuICBASW5wdXQoKSBwdWJsaWMgbWF4bGVuZ3RoOiBudW1iZXI7XHJcbiAgLy9pbnB1dOimgee0oOOBq+WvvuOBmeOCi+acgOWkp+WFpeWKm2J5dGXmlbAo6Kit5a6a5Y+v6IO944Gq44Kz44Oz44OI44Ot44O844Or44Gu44G/6YGp55SoKVxyXG4gIEBJbnB1dCgpIHB1YmxpYyBtYXhCeXRlTGVuZ3RoOiBudW1iZXI7XHJcbiAgLy9pbnB1dOimgee0oOOBq+WvvuOBmeOCi3N0eWxl44Gu5oyH5a6aKOW9ouW8j++8mnsgY29sb3I6IFwicmVkXCIgfSlcclxuICBASW5wdXQoKSBwdWJsaWMgc3R5bGVzOiBhbnkgPSB7fTtcclxuICAvL2lucHV06KaB57Sg44Gr5a++44GZ44KLY2xhc3Pjga7mjIflrpoo5b2i5byP77yaeyBcImNsYXNzTmFtZVwiOiB0cnVlIH0gb3IgXCJjbGFzc05hbWUgY2xhc3NOYW1lMlwiKVxyXG4gIEBJbnB1dCgpIHB1YmxpYyBjbGFzc2VzOiBhbnkgPSB7fTtcclxuICAvL2lucHV06KaB57Sg44Gr5a++44GZ44KL5b+F6aCI5YWl5Yqb44OV44Op44KwXHJcbiAgQElucHV0KCkgcHVibGljIHJlcXVpcmVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgLy9pbnB1dOimgee0oOOBq+WvvuOBmeOCi+eKtuaFi+OBruaMh+WumlxyXG4gIEBJbnB1dCgpIHB1YmxpYyBzdGF0ZTogc3RyaW5nID0gXCJcIjtcclxuICAvL2lucHV06KaB57Sg44Gr5a++44GZ44KL5paH6KiA44Gu5oyH5a6aXHJcbiAgQElucHV0KCkgcHVibGljIG1lc3NhZ2U6IHN0cmluZ1tdID0gW1wiXCJdO1xyXG4gIC8vcmFkaW8sc2VsZWN044Gr5a++44GZ44KL6Z2e6YCa5L+h55So44OH44O844K/44Gu5Y+X44GR5rih44GXXHJcbiAgQElucHV0KCkgcHVibGljIGl0ZW1zOiBhbnlbXTtcclxuICAvL2lucHV06KaB57Sg44Gr5a++44GZ44KL5b+F6aCI5YWl5Yqb44OV44Op44KwXHJcbiAgQElucHV0KCkgcHVibGljIGRpc2FibGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIC8v5YCk44OQ44Kk44Oz44OJ57WQ5p6c44Gu6L+U5Y2044KS5ouF44GGXHJcbiAgQE91dHB1dCgpIHB1YmxpYyB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgLy9CZWZvcmVDbGlja+OCpOODmeODs+ODiOi/lOWNtFxyXG4gIEBPdXRwdXQoKSBwdWJsaWMgYmVmb3JlQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgLy9BZnRlckNsaWNr44Kk44OZ44Oz44OI6L+U5Y20XHJcbiAgQE91dHB1dCgpIHB1YmxpYyBhZnRlckNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIC8vQmVmb3JlRm9jdXPjgqTjg5njg7Pjg4jov5TljbRcclxuICBAT3V0cHV0KCkgcHVibGljIGJlZm9yZUZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIC8vQWZ0ZXJGb2N1c+OCpOODmeODs+ODiOi/lOWNtFxyXG4gIEBPdXRwdXQoKSBwdWJsaWMgYWZ0ZXJGb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAvL0JlZm9yZUJsdXLjgqTjg5njg7Pjg4jov5TljbRcclxuICBAT3V0cHV0KCkgcHVibGljIGJlZm9yZUJsdXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgLy9BZnRlckJsdXLjgqTjg5njg7Pjg4jov5TljbRcclxuICBAT3V0cHV0KCkgcHVibGljIGFmdGVyQmx1ciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICAvL0JlZm9yZUNoYW5nZeOCpOODmeODs+ODiOi/lOWNtFxyXG4gIEBPdXRwdXQoKSBwdWJsaWMgYmVmb3JlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIC8vQWZ0ZXJDaGFuZ2XjgqTjg5njg7Pjg4jov5TljbRcclxuICBAT3V0cHV0KCkgcHVibGljIGFmdGVyQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBWaWV3Q2hpbGQoYGlucHV0RWxtYCwgeyBzdGF0aWM6IGZhbHNlIH0pIHNlbGZJbnB1dEVsbTogRWxlbWVudFJlZjxIVE1MSW5wdXRFbGVtZW50PjtcclxuXHJcbiAgcHVibGljIG9iakNsYXNzOiBvYmplY3QgPSB7fTtcclxuICBwdWJsaWMgc3RyQ2xhc3M6IHN0cmluZyA9IFwiXCI7XHJcbiAgcHVibGljIGlzQ29tcCA9IGZhbHNlO1xyXG4gIHB1YmxpYyBhcnJheTogYW55W10gPSBbXTtcclxuICBwdWJsaWMgbWF4Qnl0ZUxlbmd0aEhpc3Rvcnk6IE1heEJ5dGVMZW5ndGhIaXN0b3J5O1xyXG4gIFxyXG4gIC8vZm9yY3Vz44Gu5L+d5oyB5aSJ5pWwXHJcbiAgcHVibGljIGlzZm9jdXNlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBASW5wdXQoKSBwdWJsaWMgb25seUZpZWxkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgcHVibGljIG9uSW5pdCgpIHtcclxuICAgIC8v44Kv44Op44K544Gu5oyH5a6a5pa55rOV44Gr44KI44Gj44Gm5YiG5bKQ44GZ44KLXHJcbiAgICBpZiAodHlwZW9mIHRoaXMuY2xhc3NlcyA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICB0aGlzLnN0ckNsYXNzID0gdGhpcy5jbGFzc2VzO1xyXG4gICAgICB0aGlzLm9iakNsYXNzID0gbnVsbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc3RyQ2xhc3MgPSBcIlwiO1xyXG4gICAgICB0aGlzLm9iakNsYXNzID0gdGhpcy5jbGFzc2VzO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25JbnB1dFxyXG4gICAqIEBwYXJhbSBldmVudCBpbnB1dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbklucHV0KGV2ZW50KSB7fVxyXG5cclxuICAvKipcclxuICAgKiBvbktleURvd25cclxuICAgKiBAcGFyYW0gZXZlbnQga2V5ZG93blxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbktleURvd24oZXZlbnQpIHt9XHJcblxyXG4gIFxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIGlmICghdGhpcy5tYXhCeXRlTGVuZ3RoKSByZXR1cm47XHJcbiAgICBpZiAodGhpcy5zZWxmSW5wdXRFbG0pIHtcclxuICAgICAgdGhpcy5zZWxmSW5wdXRFbG0ubmF0aXZlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICAgIFwia2V5ZG93blwiLFxyXG4gICAgICAgIHRoaXMuaGFuZGxlS2V5ZG93bi5iaW5kKHRoaXMpXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuc2VsZklucHV0RWxtLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICBcImlucHV0XCIsXHJcbiAgICAgICAgdGhpcy5oYW5kbGVJbnB1dC5iaW5kKHRoaXMpXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuc2VsZklucHV0RWxtLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICBcImNvbXBvc2l0aW9uc3RhcnRcIixcclxuICAgICAgICB0aGlzLmhhbmRsZUNvbXBvc2l0aW9uU3RhcnQuYmluZCh0aGlzKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLnNlbGZJbnB1dEVsbS5uYXRpdmVFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgXCJjb21wb3NpdGlvbmVuZFwiLFxyXG4gICAgICAgIHRoaXMuaGFuZGxlQ29tcG9zaXRpb25FbmQuYmluZCh0aGlzKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICptYXhCeXRlTGVuZ3Ro44Gu5Yi25b6hXHJcbiAgICovXHJcbiAgcHJvdGVjdGVkIGhhbmRsZUtleWRvd24oZSkge1xyXG4gICAgaWYgKCF0aGlzLm1heEJ5dGVMZW5ndGgpIHJldHVybjtcclxuICAgIGNvbnN0IHZhbHVlID0gZS50YXJnZXQudmFsdWU7XHJcbiAgICBpZiAoXHJcbiAgICAgIHZhbHVlICYmXHJcbiAgICAgICF0aGlzLm1heEJ5dGVMZW5ndGhIaXN0b3J5ICYmXHJcbiAgICAgICFNYXhCeXRlTGVuZ3RoSGlzdG9yeS5pc0FsbG93T3BlcmF0aW9uKGUpXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5tYXhCeXRlTGVuZ3RoSGlzdG9yeSA9IG5ldyBNYXhCeXRlTGVuZ3RoSGlzdG9yeShcclxuICAgICAgICB2YWx1ZSxcclxuICAgICAgICB0aGlzLnNlbGZJbnB1dEVsbS5uYXRpdmVFbGVtZW50LnNlbGVjdGlvblN0YXJ0LFxyXG4gICAgICAgIHRoaXMubWF4Qnl0ZUxlbmd0aFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKkAg44GC44Go5L2VYnl0ZeioseWuueOBp+OBjeOCi+OBi+OCkuabtOaWsFxyXG4gICAqL1xyXG4gIHByb3RlY3RlZCBoYW5kbGVJbnB1dChlKSB7XHJcbiAgICBpZiAoIXRoaXMubWF4Qnl0ZUxlbmd0aCkgcmV0dXJuO1xyXG4gICAgdGhpcy5tYXhsZW5ndGggPSB1bmRlZmluZWQ7XHJcbiAgICBpZighdGhpcy5tYXhCeXRlTGVuZ3RoSGlzdG9yeSAmJiBlLnRhcmdldC52YWx1ZSkge1xyXG4gICAgICB0aGlzLm1heEJ5dGVMZW5ndGhIaXN0b3J5ID0gdGhpcy5tYXhCeXRlTGVuZ3RoSGlzdG9yeSA9IG5ldyBNYXhCeXRlTGVuZ3RoSGlzdG9yeShcclxuICAgICAgICBlLnRhcmdldC52YWx1ZSxcclxuICAgICAgICB0aGlzLnNlbGZJbnB1dEVsbS5uYXRpdmVFbGVtZW50LnNlbGVjdGlvblN0YXJ0LFxyXG4gICAgICAgIHRoaXMubWF4Qnl0ZUxlbmd0aFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubWF4Qnl0ZUxlbmd0aEhpc3RvcnkpIHtcclxuICAgICAgdGhpcy5tYXhCeXRlTGVuZ3RoSGlzdG9yeS5jaGFuZ2VFbnRlcmFibGVCeXRlcyhlLnRhcmdldC52YWx1ZSk7XHJcbiAgICAgIGlmICghdGhpcy5tYXhCeXRlTGVuZ3RoSGlzdG9yeS5nZXRFbnRlcmFibGVCeXRlcygpICYmICF0aGlzLmlzQ29tcCkge1xyXG4gICAgICAgIGNvbnN0IG1heExlbiA9IHRoaXMubWF4Qnl0ZUxlbmd0aEhpc3RvcnkuZ2V0TWF4TGVuZ3RoKGUudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICB0aGlzLm1heGxlbmd0aCA9IG1heExlbjtcclxuICAgICAgICBpZihlLnRhcmdldC52YWx1ZS5sZW5ndGggPiBtYXhMZW4pIHtcclxuICAgICAgICAgIGUudGFyZ2V0LnZhbHVlID0gZS50YXJnZXQudmFsdWUuc3Vic3RyKDAsIG1heExlbilcclxuICAgICAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdChlLnRhcmdldC52YWx1ZSlcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBoYW5kbGVDb21wb3NpdGlvblN0YXJ0KGUpIHtcclxuICAgIGlmICghdGhpcy5tYXhCeXRlTGVuZ3RoKSByZXR1cm47XHJcbiAgICB0aGlzLmlzQ29tcCA9IHRydWU7XHJcbiAgICB0aGlzLm1heGxlbmd0aCA9IHVuZGVmaW5lZDtcclxuICAgIGlmKGUudGFyZ2V0LnZhbHVlKSB7XHJcbiAgICAgIHRoaXMubWF4Qnl0ZUxlbmd0aEhpc3RvcnkgPSB0aGlzLm1heEJ5dGVMZW5ndGhIaXN0b3J5ID0gbmV3IE1heEJ5dGVMZW5ndGhIaXN0b3J5KFxyXG4gICAgICAgIGUudGFyZ2V0LnZhbHVlLFxyXG4gICAgICAgIHRoaXMuc2VsZklucHV0RWxtLm5hdGl2ZUVsZW1lbnQuc2VsZWN0aW9uU3RhcnQsXHJcbiAgICAgICAgdGhpcy5tYXhCeXRlTGVuZ3RoXHJcbiAgICAgICk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgIHRoaXMuaXNDb21wID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByb3RlY3RlZCBoYW5kbGVDb21wb3NpdGlvbkVuZChlKSB7XHJcbiAgICBpZiAoIXRoaXMubWF4Qnl0ZUxlbmd0aCkgcmV0dXJuO1xyXG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5tYXhCeXRlTGVuZ3RoSGlzdG9yeS5nZXRSZXN1bHQoXHJcbiAgICAgIGUuZGF0YSxcclxuICAgICAgZS50YXJnZXQudmFsdWUucmVwbGFjZSgvXFxuL2csICcjIycpXHJcbiAgICApLnJlcGxhY2UoLyMjL2csICdcXG4nKTtcclxuICAgIGUudGFyZ2V0LnZhbHVlID0gcmVzdWx0O1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHJlc3VsdCk7XHJcbiAgICB0aGlzLm1heEJ5dGVMZW5ndGhIaXN0b3J5ID0gbnVsbDtcclxuICAgIHRoaXMuaXNDb21wID0gZmFsc2U7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIG9uRm9jdXNpblxyXG4gICAqIEBwYXJhbSBldmVudCBmb2N1c2luXHJcbiAgICovXHJcbiAgcHVibGljIG9uRm9jdXNpbihldmVudCkge1xyXG4gICAgdGhpcy5pc2ZvY3VzZWQgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25Gb2N1c291dFxyXG4gICAqIEBwYXJhbSBldmVudCBmb2N1c291dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkZvY3Vzb3V0KGV2ZW50KSB7XHJcbiAgICB0aGlzLmlzZm9jdXNlZCA9IGZhbHNlO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGlmICghdGhpcy5pc2ZvY3VzZWQpIHRoaXMub25CbHVyKGV2ZW50KTtcclxuICAgIH0sIDApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogY2xpY2tDbGVhckJ1dHRvblxyXG4gICAqIEBwYXJhbSBldmVudCBrZXlkb3duXHJcbiAgICovXHJcbiAgcHVibGljIGNsaWNrQ2xlYXJCdXR0b24oZXZlbnQpIHtcclxuICAgIGlmIChldmVudC5rZXlDb2RlID09IFNIQ3RsQ29tbW9uLkNvbnN0LmtleUNvZGVzLmVudGVyIHx8XHJcbiAgICAgIGV2ZW50LmtleUNvZGUgPT0gU0hDdGxDb21tb24uQ29uc3Qua2V5Q29kZXMuc3BhY2UgKVxyXG4gICAge1xyXG4gICAgICAvL+OCqOODs+OCv+ODvOOCreODvOOBp+WIpeOCs+ODs+ODiOODreODvOODq+OBq+ODleOCqeODvOOCq+OCueOBjOenu+WLleOBl+OBquOBhOOCiOOBhuOBq+ODleOCqeODvOOCq+OCueOCkuW9k+OBpuebtOOBmVxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBsZXQgaW5wdXRWYWx1ZSA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHRleHRhcmVhW25hbWU9YCArIHRoaXMuY3RsTmFtZSArIGBdLCBpbnB1dFtuYW1lPWAgKyB0aGlzLmN0bE5hbWUgKyBgXWApO1xyXG4gICAgICAgIGlucHV0VmFsdWUuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2ZvY3VzJykpOyAgICAgICAgICBcclxuICAgICAgfSwgMCk7XHJcbiAgICAgIHRoaXMuY2xlYXJWYWx1ZSgpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIG9uQ2hhbmdlXHJcbiAgICogQHBhcmFtIGV2ZW50IGNoYW5nZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkNoYW5nZShldmVudCkge1xyXG4gICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHRoaXMudmFsdWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25Gb2N1c1xyXG4gICAqIEBwYXJhbSBldmVudCBmb2N1c1xyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkZvY3VzKGV2ZW50KSB7XHJcbiAgICBldmVudC50YXJnZXQuc2VsZWN0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBvbkJsdXJcclxuICAgKiBAcGFyYW0gZXZlbnQgYmx1clxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkJsdXIoZXZlbnQpIHt9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQmVmb3JlQ2xpY2tcclxuICAgKiBAcGFyYW0gZXZlbnRcclxuICAgKi9cclxuICBwdWJsaWMgb25CZWZvcmVDbGljayhldmVudCkge1xyXG4gICAgdGhpcy5iZWZvcmVDbGljay5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQWZ0ZXJDbGlja1xyXG4gICAqIEBwYXJhbSBldmVudFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkFmdGVyQ2xpY2soZXZlbnQpIHtcclxuICAgIHRoaXMuYWZ0ZXJDbGljay5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQmVmb3JlRm9jdXNcclxuICAgKiBAcGFyYW0gZXZlbnRcclxuICAgKi9cclxuICBwdWJsaWMgb25CZWZvcmVGb2N1cyhldmVudCkge1xyXG4gICAgdGhpcy5iZWZvcmVGb2N1cy5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQWZ0ZXJGb2N1c1xyXG4gICAqIEBwYXJhbSBldmVudFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkFmdGVyRm9jdXMoZXZlbnQpIHtcclxuICAgIHRoaXMuYWZ0ZXJGb2N1cy5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQmVmb3JlQmx1clxyXG4gICAqIEBwYXJhbSBldmVudFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkJlZm9yZUJsdXIoZXZlbnQpIHtcclxuICAgIHRoaXMuYmVmb3JlQmx1ci5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQWZ0ZXJCbHVyXHJcbiAgICogQHBhcmFtIGV2ZW50XHJcbiAgICovXHJcbiAgcHVibGljIG9uQWZ0ZXJCbHVyKGV2ZW50KSB7XHJcbiAgICB0aGlzLmFmdGVyQmx1ci5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQmVmb3JlQ2hhbmdlXHJcbiAgICogQHBhcmFtIGV2ZW50XHJcbiAgICovXHJcbiAgcHVibGljIG9uQmVmb3JlQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICB0aGlzLmJlZm9yZUNoYW5nZS5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQWZ0ZXJDaGFuZ2VcclxuICAgKiBAcGFyYW0gZXZlbnRcclxuICAgKi9cclxuICBwdWJsaWMgb25BZnRlckNoYW5nZShldmVudCkge1xyXG4gICAgdGhpcy5hZnRlckNoYW5nZS5lbWl0KGV2ZW50KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWApOOBruOCr+ODquOColxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhclZhbHVlKCkge1xyXG4gICAgdGhpcy52YWx1ZSA9IG51bGw7XHJcbiAgICBsZXQgaW5wdXRWYWx1ZSA9IDxIVE1MSW5wdXRFbGVtZW50PihcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICBgdGV4dGFyZWFbbmFtZT1gICsgdGhpcy5jdGxOYW1lICsgYF0sIGlucHV0W25hbWU9YCArIHRoaXMuY3RsTmFtZSArIGBdYFxyXG4gICAgICApXHJcbiAgICApO1xyXG4gICAgLy/jgr/jgqTjg5/jg7PjgrDjgpLpgYXjgonjgZvjgarjgYTjgahjaGFuZ2XjgqTjg5njg7Pjg4jlhoXjga5ldmVudC50YXJnZXQudmFsdWXjgYzliY3jga7lgKTjgavjgarjgotcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuICAgICAgaW5wdXRWYWx1ZS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpO1xyXG4gICAgICBpbnB1dFZhbHVlLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdmb2N1cycpKTtcclxuICAgIH0sMTApOyAgIFxyXG5cclxuICB9XHJcbn1cclxuIl19