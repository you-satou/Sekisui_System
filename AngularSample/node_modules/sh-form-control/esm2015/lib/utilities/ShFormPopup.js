/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Input } from "@angular/core";
import { SHCtlCommon } from "../components/sh-ctl-common";
import { ShCtlConst } from "../constShCtl";
import { SHFormControl } from "./ShFormControl";
import { SHCtlPopupDialogComponent } from "../components/sh-ctl-popup-dialog/sh-ctl-popup-dialog.component";
export class SHFormPopup extends SHFormControl {
    /**
     * @param {?} SmplPopupService
     * @param {?} dialog
     * @param {?} bindCtlService
     * @param {?} lockScreenService
     */
    constructor(SmplPopupService, dialog, bindCtlService, lockScreenService) {
        super();
        this.SmplPopupService = SmplPopupService;
        this.dialog = dialog;
        this.bindCtlService = bindCtlService;
        this.lockScreenService = lockScreenService;
        //データタイトル名
        this.dataTitle = "";
        //データ区分名
        this.dataKbnName = "";
        //API URL
        this.apiUrl = "/api/";
        //入力コントロールに紐づく列番号
        this.bindColumnKey = 1;
        //ラベルコントロールに紐づく列番号
        this.bindColumnValue = 2;
        //入力コントロールを非表示にするモードフラグ
        this.hiddenInput = false;
        //ラベルを非表示にするモードフラグ
        this.hiddenLabel = false;
        //虫眼鏡アイコンを非表示にするモードフラグ
        this.hiddenPopupButton = false;
        //データキャッシュON/OFF機能フラグ
        this.dataCache = false;
        //ポップアップ上非表示となる列番号
        this.hiddenColumns = [];
        this.name = "";
        this.codes = [];
        this.codesHeader = [];
        this.extendWidth = ShCtlConst.DIALOG_WIDTH;
        //Dialogの結果を受け取る
        this.dialogRef = null;
        // 初回通信用フラグ
        this.initFetchFlg = false;
        // bindColumnArrayを利用し値が設定された場合にチェンジを止める
        this.noChangeFlg = `OFF`;
        // 通信中かどうか
        this.isBusy = false;
        this.ctlName = "SHCtlPopup";
    }
    // bindColumnArrayを利用し値が設定された場合にチェンジを止める
    /**
     * @return {?}
     */
    get noChangeFlgCtlName() {
        return `${this.ctlName}_${ShCtlConst.NO_CHANGE.FLG_SUFFIX}`;
    }
    // inputの参照
    /**
     * @return {?}
     */
    get ownValueInputElm() {
        return ((/** @type {?} */ ((document.querySelector(`textarea[name=${this.ctlName}], input[name=${this.ctlName}]`)))) || null);
    }
    /**
     * @return {?}
     */
    get ownLabelInputElm() {
        return (/** @type {?} */ (((document.querySelector(`textarea[name=${this.popupLabelName}], input[name=${this.popupLabelName}]`) || null))));
    }
    /**
     *
     * @param {?} event
     * @return {?}
     */
    noChangeFlgChange(event) {
        this.noChangeFlg = event.target.value;
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.noChangeFlg = `OFF`;
        }), 1000);
    }
    /**
     * 入力コントロールの幅を指定
     * @return {?}
     */
    setInputWidth() {
        return this.hiddenLabel ? { width: "100%" } : { width: "33.3%" };
    }
    /**
     * ラベルコントロールの幅を指定
     * @return {?}
     */
    setLabelWidth() {
        return this.hiddenInput ? { width: "100%" } : { width: "66.6%" };
    }
    /**
     * データバインドされた値を再設定する際に値を検証し
     * 親コンポーネントに渡す
     * @param {?} changes 現在の値と直前の値を取得出来る
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.value && !changes.value.currentValue) {
            this.name = "";
            this.value = "";
            return;
        }
        if (this.noChangeFlg == "OFF") {
            if (changes.value && changes.value.currentValue) {
                if (changes.value.currentValue != changes.value.previousValue) {
                    this.fetchCodes(this.apiUrl);
                    return;
                }
            }
            if (changes.value && changes.value.firstChange) {
                this.initFetchFlg = true;
            }
            if (this.initFetchFlg) {
                if (!this.value || !changes.value.currentValue)
                    return;
                this.fetchCodes(this.apiUrl);
                this.initFetchFlg = false;
            }
            if (changes.apiUrl &&
                changes.apiUrl.previousValue != changes.apiUrl.currentValue &&
                !this.isBindInputNull(this.bindColumnArray)) {
                if (this.SmplPopupService.getMasterData(changes.apiUrl.currentValue)
                    .length == 0) {
                    if (changes.value &&
                        changes.value.currentValue == changes.value.previousValue)
                        return;
                    this.fetchCodes(changes.apiUrl.currentValue);
                }
                else {
                    this.codes = Object(this.SmplPopupService.getMasterData(changes.apiUrl.currentValue)).data;
                    this.value = this.setName(this.value);
                }
            }
        }
        setTimeout((/**
         * @return {?}
         */
        () => {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.noChangeFlg = `OFF`;
            }), 1000);
        }), 0);
    }
    /**
     * プロパティの初期化
     * 通常サービスにキャッシュしているが、無ければ再度マスタより取得
     * @return {?}
     */
    ngOnInit() {
        this.onInit();
        if (this.popupWidth) {
            this.extendWidth = this.popupWidth;
        }
        // //ユニークな文字列
        if (this.isDisabled) {
            if (this.SmplPopupService.getMasterData(this.apiUrl).length <= 0) {
                this.SmplPopupService.fetchAll(this.apiUrl).then((/**
                 * @param {?} response
                 * @return {?}
                 */
                (response) => {
                    this.codes = response.data;
                    this.codesHeader = Object.values(response.header);
                }));
            }
        }
    }
    /**
     * api 通信 マスタから取得
     * @param {?} url
     * @param {?=} value
     * @return {?}
     */
    fetchCodes(url, value) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (this.isBusy)
                return;
            this.isBusy = true;
            this.lockScreenService.lockScreen();
            ((/** @type {?} */ (document.activeElement))).blur();
            return Promise.resolve(this.SmplPopupService.fetchAll(url)).catch((/**
             * @param {?} _
             * @return {?}
             */
            _ => { this.lockScreenService.unlock(); })).then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => {
                this.codes = response.data;
                this.codesHeader = Object.values(response.header);
                this.dataTitle = response.title;
                /** @type {?} */
                const ok = this.checkValue(value || this.value);
                /** @type {?} */
                let result = "";
                if (ok) {
                    if (value || this.value) {
                        result = this.setName(value || this.value);
                    }
                    if (this.dataCache) {
                        this.SmplPopupService.setMasterData(url, response);
                    }
                }
                this.isBusy = false;
                return new Promise((/**
                 * @param {?} resolve
                 * @return {?}
                 */
                (resolve) => {
                    resolve(result);
                    this.lockScreenService.unlock();
                }));
            }));
        });
    }
    /**
     * onInput
     * @param {?} event input
     * @return {?}
     */
    onInput(event) {
        SHCtlCommon.replaceSpace(event);
        SHCtlCommon.replaceFullWidth(event);
        SHCtlCommon.replaceSign(event);
    }
    /**
     * ダイアログを開いて閉じる時に値を親に返す
     * @return {?}
     */
    openDialog() {
        // valueの値を一時対比　ダイアログを閉じる際に比較します
        /** @type {?} */
        const tmp = this.value;
        if (!this.popupWidth &&
            this.codes.length != 0 &&
            Object.values(this.codes[0]).length >= 4) {
            this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
        }
        this.dialogRef = this.dialog.open(SHCtlPopupDialogComponent, {
            height: ShCtlConst.DIALOG_HEIGHT,
            width: this.extendWidth,
            data: {
                dataTitle: this.dataTitle,
                codes: this.codes,
                codesHeader: this.codesHeader,
                hiddenColumns: this.hiddenColumns,
            },
        });
        this.dialogRef.afterClosed().subscribe((/**
         * @param {?} result
         * @return {?}
         */
        (result) => {
            if (result) {
                this.setValueName(result);
                //this.allocateToInputValue(result);
                this.bindCtlService.setNoChangeFlg({
                    bindColumnArray: this.bindColumnArray,
                    record: result,
                });
                this.bindCtlService.setBindValue({
                    bindColumnArray: this.bindColumnArray,
                    record: result,
                });
                this.noChangeFlg = `ON`;
                //changeイベント経由でemitすると無条件でafterChangeイベントが呼ばれるので
                //値を比較し変更がなければこのタイミングでemitする
                /** @type {?} */
                const resultValues = Object.values(result);
                if (resultValues && resultValues.includes(tmp)) {
                    this.valueChange.emit(this.value);
                    return;
                }
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.dispatchOwnValueInputChangeEvent();
                }), 0);
            }
        }));
    }
    /**
     * \@ 自身のvalueに紐づくinputのチェンジイベントを発火
     * @private
     * @return {?}
     */
    dispatchOwnValueInputChangeEvent() {
        if (this.ownValueInputElm) {
            this.ownValueInputElm.dispatchEvent(new Event("change"));
        }
    }
    /**
     * \@ bind先のinputがnullかどうか
     * @param {?} bindColumnArray
     * @return {?}
     */
    isBindInputNull(bindColumnArray) {
        if (!bindColumnArray || bindColumnArray.length == 0)
            return true;
        return bindColumnArray
            .map((/**
         * @param {?} bindColumnData
         * @return {?}
         */
        (bindColumnData) => {
            return (/** @type {?} */ (document.querySelector(`input[name=${Object.keys(bindColumnData)[0]}]`)));
        }))
            .map((/**
         * @param {?} bindInput
         * @return {?}
         */
        (bindInput) => {
            if (!bindInput)
                return false;
            return !!bindInput.value;
        }))
            .includes(false);
    }
    /**
     * onClick
     * @param {?} event click
     * @return {?}
     */
    onClick(event) {
        this.onBeforeClick(event);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.onAfterClick(event);
        }), 0);
    }
    /**
     * onFocus
     * @param {?} event focus
     * @return {?}
     */
    onFocus(event) {
        this.onBeforeFocus(event);
        event.target.select();
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.onAfterFocus(event);
        }), 0);
    }
    /**
     * @return {?}
     */
    clearAll() {
        this.value = "";
        this.name = "";
        if (this.ownLabelInputElm) {
            this.ownLabelInputElm.value = "";
        }
        this.valueChange.emit("");
    }
    /**
     * onChange
     * @param {?} event change
     * @return {?}
     */
    onChange(event) {
        this.onBeforeChange(event);
        if (!event.target.value) {
            this.clearAll();
        }
        /** @type {?} */
        let flg = false;
        if (this.noChangeFlg == "OFF") {
            flg = true;
            if (this.SmplPopupService.getMasterData(this.apiUrl).length == 0 &&
                event.target.value) {
                this.noChangeFlg = "ON";
                this.fetchCodes(this.apiUrl, this.toText(event.target.value)).then((/**
                 * @param {?} value
                 * @return {?}
                 */
                (value) => {
                    this.valueChange.emit(value);
                    event.target.value = this.toText(event.target.value);
                    setTimeout((/**
                     * @return {?}
                     */
                    () => {
                        this.onAfterChange(event);
                    }), 0);
                }));
            }
            else {
                event.target.value = this.setName(event.target.value);
                this.valueChange.emit(event.target.value);
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.onAfterChange(event);
                }), 0);
            }
        }
        if (!flg) {
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.valueChange.emit(event.target.value);
                this.onAfterChange(event);
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.noChangeFlg = `OFF`;
                }), 1000);
            }), 0);
        }
    }
    /**
     * onBlur
     * @param {?} event blur
     * @return {?}
     */
    onBlur(event) {
        this.onBeforeBlur(event);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.onAfterBlur(event);
        }), 0);
    }
    /**
     * 手入力の値からの検索結果が複数あった場合はアラートを出す
     * @param {?} value
     * @return {?}
     */
    checkValue(value) {
        if (!value)
            return false;
        //let matchedArray = [];
        if (this.codes[0]) {
            /** @type {?} */
            const filterResult = this.codes.filter((/**
             * @param {?} element
             * @return {?}
             */
            (element) => 
            //this.hasMatchRecords(element, value)
            Object.values(element)[this.bindColumnKey - 1] == value));
            if (filterResult.length == 0) {
                this.clearValue();
                this.valueChange.emit("");
                return false;
            }
            if (filterResult.length >= 2) {
                alert(value + "に複数の候補が検出されました");
                this.clearValue();
                this.valueChange.emit("");
                return false;
            }
        }
        return true;
    }
    /**
     * マスタ情報よりコードを取得
     * @return {?}
     */
    getCodes() {
        this.openDialog();
        if (this.SmplPopupService.getMasterData(this.apiUrl).length == 0) {
            this.SmplPopupService.fetchAll(this.apiUrl).then((/**
             * @param {?} response
             * @return {?}
             */
            (response) => {
                this.codes = response.data;
                this.codesHeader = Object.values(response.header);
                this.dataTitle = response.title;
                if (this.dataCache)
                    this.SmplPopupService.setMasterData(this.apiUrl, response);
                if (!this.dialogRef)
                    return;
                if (this.dialogRef.componentInstance) {
                    this.dialogRef.componentInstance.codesHeader = this.codesHeader;
                    this.dialogRef.componentInstance.unchangeableCodes = this.codes;
                    this.dialogRef.componentInstance.codes = this.codes;
                    this.dialogRef.componentInstance.dataTitle = this.dataTitle;
                    if (!this.popupWidth && Object.values(this.codes[0]).length >= 4) {
                        this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
                    }
                    this.dialogRef.updateSize(this.extendWidth, ShCtlConst.DIALOG_HEIGHT);
                    /** @type {?} */
                    let cols = [];
                    this.dialogRef.componentInstance
                        .getHashKeys()
                        .forEach((/**
                     * @param {?} name
                     * @param {?} idx
                     * @return {?}
                     */
                    (name, idx) => {
                        if (!this.hiddenColumns.find((/**
                         * @param {?} _
                         * @return {?}
                         */
                        (_) => _ == idx + 1)))
                            cols.push(name);
                    }));
                    this.dialogRef.componentInstance.displayedColumns = cols;
                }
            }));
        }
        else {
            this.codes = Object(this.SmplPopupService.getMasterData(this.apiUrl)).data;
            this.codesHeader = Object.values(Object(this.SmplPopupService.getMasterData(this.apiUrl)).header);
            if (this.dialogRef.componentInstance) {
                this.dialogRef.componentInstance.codesHeader = this.codesHeader;
                this.dialogRef.componentInstance.unchangeableCodes = this.codes;
                this.dialogRef.componentInstance.codes = this.codes;
                this.dialogRef.componentInstance.dataTitle = this.dataTitle;
                if (!this.popupWidth && Object.values(this.codes[0]).length >= 4) {
                    this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
                }
                this.dialogRef.updateSize(this.extendWidth, ShCtlConst.DIALOG_HEIGHT);
                /** @type {?} */
                let cols = [];
                this.dialogRef.componentInstance.getHashKeys().forEach((/**
                 * @param {?} name
                 * @param {?} idx
                 * @return {?}
                 */
                (name, idx) => {
                    if (!this.hiddenColumns.find((/**
                     * @param {?} _
                     * @return {?}
                     */
                    (_) => _ == idx + 1)))
                        cols.push(name);
                }));
                this.dialogRef.componentInstance.displayedColumns = cols;
            }
        }
    }
    /**
     * 自コントロールのinput value に値を渡す
     * @param {?} matchedArray
     * @return {?}
     */
    setValueName(matchedArray) {
        if (Object.values(matchedArray)[this.bindColumnKey - 1]) {
            /** @type {?} */
            const val = Object.values(matchedArray)[this.bindColumnKey - 1].toString();
            this.value = val;
        }
        else {
            this.value = "";
        }
        if (Object.values(matchedArray)[this.bindColumnValue - 1]) {
            this.name = Object.values(matchedArray)[this.bindColumnValue - 1].toString();
        }
        else {
            this.name = "";
        }
    }
    /**
     * 親子関係になっているinputがある場合に検索対象を親まで広げる
     * @private
     * @param {?} element
     * @param {?} val
     * @return {?}
     */
    hasMatchRecords(element, val) {
        // 検索結果一行分の比較すべき列の値
        /** @type {?} */
        let searchs = [];
        // 現在の比較すべき値
        /** @type {?} */
        let values = [val];
        searchs.push(Object.values(element)[this.bindColumnKey - 1]);
        if (this.bindColumnArray && this.bindColumnArray.length != 0) {
            this.bindColumnArray.forEach((/**
             * @param {?} data
             * @return {?}
             */
            (data) => {
                /** @type {?} */
                let bindIndex = ((/** @type {?} */ (Object.values(data)[0]))) - 1;
                searchs.push(Object.values(element)[bindIndex]);
                /** @type {?} */
                let targetInput = (/** @type {?} */ (document.querySelector(`input[name=${Object.keys(data)[0]}]`)));
                if (targetInput) {
                    if (targetInput.value) {
                        values.push(targetInput.value);
                    }
                    else {
                        searchs = searchs.filter((/**
                         * @param {?} val
                         * @return {?}
                         */
                        (val) => val != Object.values(element)[bindIndex]));
                    }
                }
            }));
        }
        /** @type {?} */
        const result = searchs.map((/**
         * @param {?} val
         * @return {?}
         */
        (val) => values.includes(val)));
        return !result.includes(false);
    }
    /**
     * 選択された区分コードに紐づく区分名を設定
     * @param {?} val
     * @return {?}
     */
    setName(val) {
        /** @type {?} */
        const record = this.codes
            ? this.codes.find((/**
             * @param {?} element
             * @return {?}
             */
            (element) => Object.values(element)[this.bindColumnKey - 1] == val))
            : null;
        if (record) {
            /** @type {?} */
            let kbnValue = Object.values(record)[this.bindColumnValue - 1];
            this.name = kbnValue ? kbnValue.toString() : "";
            this.bindCtlService.setBindValue({
                bindColumnArray: this.bindColumnArray,
                record,
            });
        }
        else {
            val = "";
            this.clearAll();
        }
        return val;
    }
    /**
     * 入力のクリア
     * @return {?}
     */
    clearValue() {
        this.value = "";
        this.name = "";
        if (this.ctlName) {
            this.ownValueInputElm.value = "";
            //タイミングを遅らせないとchangeイベント内のevent.target.valueが前の値になる
            setTimeout((/**
             * @return {?}
             */
            () => {
                this.ownValueInputElm.dispatchEvent(new Event("change"));
                this.ownValueInputElm.dispatchEvent(new Event("focus"));
            }), 0);
        }
        if (this.popupLabelName) {
            this.ownLabelInputElm.value = "";
        }
    }
    /**
     * サブクラスでオーバーライドして使うので消さない
     * @param {?} s
     * @return {?}
     */
    toText(s) {
        return s;
    }
    /**
     * @param {?} result
     * @return {?}
     */
    extractBindValue(result) {
        if (!result)
            return;
        return Object.values(result)[this.bindColumnKey - 1];
    }
}
SHFormPopup.propDecorators = {
    dataTitle: [{ type: Input }],
    dataKbnName: [{ type: Input }],
    apiUrl: [{ type: Input }],
    bindColumnKey: [{ type: Input }],
    bindColumnValue: [{ type: Input }],
    ctlName: [{ type: Input }],
    popupLabelName: [{ type: Input }],
    bindColumnArray: [{ type: Input }],
    hiddenInput: [{ type: Input }],
    hiddenLabel: [{ type: Input }],
    hiddenPopupButton: [{ type: Input }],
    dataCache: [{ type: Input }],
    hiddenColumns: [{ type: Input }],
    popupWidth: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    SHFormPopup.prototype.dataTitle;
    /** @type {?} */
    SHFormPopup.prototype.dataKbnName;
    /** @type {?} */
    SHFormPopup.prototype.apiUrl;
    /** @type {?} */
    SHFormPopup.prototype.bindColumnKey;
    /** @type {?} */
    SHFormPopup.prototype.bindColumnValue;
    /** @type {?} */
    SHFormPopup.prototype.ctlName;
    /** @type {?} */
    SHFormPopup.prototype.popupLabelName;
    /** @type {?} */
    SHFormPopup.prototype.bindColumnArray;
    /** @type {?} */
    SHFormPopup.prototype.hiddenInput;
    /** @type {?} */
    SHFormPopup.prototype.hiddenLabel;
    /** @type {?} */
    SHFormPopup.prototype.hiddenPopupButton;
    /** @type {?} */
    SHFormPopup.prototype.dataCache;
    /** @type {?} */
    SHFormPopup.prototype.hiddenColumns;
    /** @type {?} */
    SHFormPopup.prototype.popupWidth;
    /** @type {?} */
    SHFormPopup.prototype.name;
    /** @type {?} */
    SHFormPopup.prototype.event;
    /** @type {?} */
    SHFormPopup.prototype.codes;
    /** @type {?} */
    SHFormPopup.prototype.codesHeader;
    /** @type {?} */
    SHFormPopup.prototype.extendWidth;
    /** @type {?} */
    SHFormPopup.prototype.dialogRef;
    /** @type {?} */
    SHFormPopup.prototype.initFetchFlg;
    /** @type {?} */
    SHFormPopup.prototype.noChangeFlg;
    /** @type {?} */
    SHFormPopup.prototype.isBusy;
    /**
     * @type {?}
     * @protected
     */
    SHFormPopup.prototype.SmplPopupService;
    /**
     * @type {?}
     * @protected
     */
    SHFormPopup.prototype.dialog;
    /**
     * @type {?}
     * @protected
     */
    SHFormPopup.prototype.bindCtlService;
    /**
     * @type {?}
     * @protected
     */
    SHFormPopup.prototype.lockScreenService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hGb3JtUG9wdXAuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9zaC1mb3JtLWNvbnRyb2wvIiwic291cmNlcyI6WyJsaWIvdXRpbGl0aWVzL1NoRm9ybVBvcHVwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDckQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQzFELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2hELE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGlFQUFpRSxDQUFDO0FBTTVHLE1BQU0sT0FBTyxXQUFZLFNBQVEsYUFBa0I7Ozs7Ozs7SUFtRWpELFlBQ1ksZ0JBQWtDLEVBQ2xDLE1BQWlCLEVBQ2pCLGNBQThCLEVBQzlCLGlCQUFvQztRQUU5QyxLQUFLLEVBQUUsQ0FBQztRQUxFLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNqQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjs7UUFyRWhDLGNBQVMsR0FBVyxFQUFFLENBQUM7O1FBRXZCLGdCQUFXLEdBQVcsRUFBRSxDQUFDOztRQUV6QixXQUFNLEdBQVcsT0FBTyxDQUFDOztRQUV6QixrQkFBYSxHQUFXLENBQUMsQ0FBQzs7UUFFMUIsb0JBQWUsR0FBVyxDQUFDLENBQUM7O1FBUTVCLGdCQUFXLEdBQVksS0FBSyxDQUFDOztRQUU3QixnQkFBVyxHQUFZLEtBQUssQ0FBQzs7UUFFN0Isc0JBQWlCLEdBQVksS0FBSyxDQUFDOztRQUVuQyxjQUFTLEdBQVksS0FBSyxDQUFDOztRQUUzQixrQkFBYSxHQUFhLEVBQUUsQ0FBQztRQUl0QyxTQUFJLEdBQVcsRUFBRSxDQUFDO1FBRWxC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OztJQUVwQix1Q0FBNEM7Ozs7O0lBQzVDLDZCQUEyQjs7Ozs7SUFDM0IscUNBQXdDOzs7OztJQUN4Qyx3Q0FBOEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbnB1dCwgU2ltcGxlQ2hhbmdlcyB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IFNIQ3RsQ29tbW9uIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2gtY3RsLWNvbW1vblwiO1xyXG5pbXBvcnQgeyBTaEN0bENvbnN0IH0gZnJvbSBcIi4uL2NvbnN0U2hDdGxcIjtcclxuaW1wb3J0IHsgU21wbFBvcHVwU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9zbXBsLXBvcHVwLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgTWF0RGlhbG9nLCBNYXREaWFsb2dSZWYgfSBmcm9tIFwiQGFuZ3VsYXIvbWF0ZXJpYWxcIjtcclxuaW1wb3J0IHsgU0hGb3JtQ29udHJvbCB9IGZyb20gXCIuL1NoRm9ybUNvbnRyb2xcIjtcclxuaW1wb3J0IHsgU0hDdGxQb3B1cERpYWxvZ0NvbXBvbmVudCB9IGZyb20gXCIuLi9jb21wb25lbnRzL3NoLWN0bC1wb3B1cC1kaWFsb2cvc2gtY3RsLXBvcHVwLWRpYWxvZy5jb21wb25lbnRcIjtcclxuaW1wb3J0IHsgQmluZEN0bFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvYmluZC1jdGwuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBMb2NrU2NyZWVuU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9sb2NrLXNjcmVlbi5zZXJ2aWNlXCI7XHJcbmltcG9ydCB7IE5vQ2hhbmdlRmxnIH0gZnJvbSBcIi4uL3R5cGVzL05vQ2hhbmdlRmxnXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFNIRm9ybVBvcHVwIGV4dGVuZHMgU0hGb3JtQ29udHJvbDxhbnk+IHtcclxuICAvL+ODh+ODvOOCv+OCv+OCpOODiOODq+WQjVxyXG4gIEBJbnB1dCgpIHB1YmxpYyBkYXRhVGl0bGU6IHN0cmluZyA9IFwiXCI7XHJcbiAgLy/jg4fjg7zjgr/ljLrliIblkI1cclxuICBASW5wdXQoKSBwdWJsaWMgZGF0YUtibk5hbWU6IHN0cmluZyA9IFwiXCI7XHJcbiAgLy9BUEkgVVJMXHJcbiAgQElucHV0KCkgcHVibGljIGFwaVVybDogc3RyaW5nID0gXCIvYXBpL1wiO1xyXG4gIC8v5YWl5Yqb44Kz44Oz44OI44Ot44O844Or44Gr57SQ44Gl44GP5YiX55Wq5Y+3XHJcbiAgQElucHV0KCkgcHVibGljIGJpbmRDb2x1bW5LZXk6IG51bWJlciA9IDE7XHJcbiAgLy/jg6njg5njg6vjgrPjg7Pjg4jjg63jg7zjg6vjgavntJDjgaXjgY/liJfnlarlj7dcclxuICBASW5wdXQoKSBwdWJsaWMgYmluZENvbHVtblZhbHVlOiBudW1iZXIgPSAyO1xyXG4gIC8v5YWl5Yqb44Kz44Oz44OI44Ot44O844Or5ZCNXHJcbiAgQElucHV0KCkgcHVibGljIGN0bE5hbWU7XHJcbiAgLy/jg6njg5njg6vjgrPjg7Pjg4jjg63jg7zjg6vlkI1cclxuICBASW5wdXQoKSBwdWJsaWMgcG9wdXBMYWJlbE5hbWU7XHJcbiAgLy/ku5bjga7jgrPjg7Pjg4jjg63jg7zjg6vjgajjga7lgKTpgKPmkLrjgpLoqK3lrprjgZnjgotcclxuICBASW5wdXQoKSBwdWJsaWMgYmluZENvbHVtbkFycmF5OiBhbnk7XHJcbiAgLy/lhaXlipvjgrPjg7Pjg4jjg63jg7zjg6vjgpLpnZ7ooajnpLrjgavjgZnjgovjg6Ljg7zjg4njg5Xjg6njgrBcclxuICBASW5wdXQoKSBwdWJsaWMgaGlkZGVuSW5wdXQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAvL+ODqeODmeODq+OCkumdnuihqOekuuOBq+OBmeOCi+ODouODvOODieODleODqeOCsFxyXG4gIEBJbnB1dCgpIHB1YmxpYyBoaWRkZW5MYWJlbDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIC8v6Jmr55y86Y+h44Ki44Kk44Kz44Oz44KS6Z2e6KGo56S644Gr44GZ44KL44Oi44O844OJ44OV44Op44KwXHJcbiAgQElucHV0KCkgcHVibGljIGhpZGRlblBvcHVwQnV0dG9uOiBib29sZWFuID0gZmFsc2U7XHJcbiAgLy/jg4fjg7zjgr/jgq3jg6Pjg4Pjgrfjg6VPTi9PRkbmqZ/og73jg5Xjg6njgrBcclxuICBASW5wdXQoKSBwdWJsaWMgZGF0YUNhY2hlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgLy/jg53jg4Pjg5fjgqLjg4Pjg5fkuIrpnZ7ooajnpLrjgajjgarjgovliJfnlarlj7dcclxuICBASW5wdXQoKSBwdWJsaWMgaGlkZGVuQ29sdW1uczogbnVtYmVyW10gPSBbXTtcclxuICAvLyDjg4DjgqTjgqLjg63jgrDjga7luYXjgpLmjIflrppcclxuICBASW5wdXQoKSBwdWJsaWMgcG9wdXBXaWR0aDogc3RyaW5nO1xyXG5cclxuICBwdWJsaWMgbmFtZTogc3RyaW5nID0gXCJcIjtcclxuICBwdWJsaWMgZXZlbnQ6IGFueTtcclxuICBwdWJsaWMgY29kZXMgPSBbXTtcclxuICBwdWJsaWMgY29kZXNIZWFkZXIgPSBbXTtcclxuXHJcbiAgcHVibGljIGV4dGVuZFdpZHRoID0gU2hDdGxDb25zdC5ESUFMT0dfV0lEVEg7XHJcblxyXG4gIC8vRGlhbG9n44Gu57WQ5p6c44KS5Y+X44GR5Y+W44KLXHJcbiAgcHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPFNIQ3RsUG9wdXBEaWFsb2dDb21wb25lbnQsIGFueT4gPSBudWxsO1xyXG4gIC8vIOWIneWbnumAmuS/oeeUqOODleODqeOCsFxyXG4gIHB1YmxpYyBpbml0RmV0Y2hGbGc6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAvLyBiaW5kQ29sdW1uQXJyYXnjgpLliKnnlKjjgZflgKTjgYzoqK3lrprjgZXjgozjgZ/loLTlkIjjgavjg4Hjgqfjg7PjgrjjgpLmraLjgoHjgotcclxuICBnZXQgbm9DaGFuZ2VGbGdDdGxOYW1lKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYCR7dGhpcy5jdGxOYW1lfV8ke1NoQ3RsQ29uc3QuTk9fQ0hBTkdFLkZMR19TVUZGSVh9YDtcclxuICB9XHJcbiAgLy8gaW5wdXTjga7lj4LnhadcclxuICBnZXQgb3duVmFsdWVJbnB1dEVsbSgpOiBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICA8SFRNTElucHV0RWxlbWVudD4oXHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgIGB0ZXh0YXJlYVtuYW1lPSR7dGhpcy5jdGxOYW1lfV0sIGlucHV0W25hbWU9JHt0aGlzLmN0bE5hbWV9XWBcclxuICAgICAgICApXHJcbiAgICAgICkgfHwgbnVsbFxyXG4gICAgKTtcclxuICB9XHJcbiAgZ2V0IG93bkxhYmVsSW5wdXRFbG0oKTogSFRNTElucHV0RWxlbWVudCB8IG51bGwge1xyXG4gICAgcmV0dXJuIDxIVE1MSW5wdXRFbGVtZW50PihcclxuICAgICAgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgYHRleHRhcmVhW25hbWU9JHt0aGlzLnBvcHVwTGFiZWxOYW1lfV0sIGlucHV0W25hbWU9JHt0aGlzLnBvcHVwTGFiZWxOYW1lfV1gXHJcbiAgICAgICkgfHwgbnVsbClcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBiaW5kQ29sdW1uQXJyYXnjgpLliKnnlKjjgZflgKTjgYzoqK3lrprjgZXjgozjgZ/loLTlkIjjgavjg4Hjgqfjg7PjgrjjgpLmraLjgoHjgotcclxuICBwdWJsaWMgbm9DaGFuZ2VGbGc6IE5vQ2hhbmdlRmxnID0gYE9GRmA7XHJcbiAgLy8g6YCa5L+h5Lit44GL44Gp44GG44GLXHJcbiAgcHVibGljIGlzQnVzeSA9IGZhbHNlO1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJvdGVjdGVkIFNtcGxQb3B1cFNlcnZpY2U6IFNtcGxQb3B1cFNlcnZpY2UsXHJcbiAgICBwcm90ZWN0ZWQgZGlhbG9nOiBNYXREaWFsb2csXHJcbiAgICBwcm90ZWN0ZWQgYmluZEN0bFNlcnZpY2U6IEJpbmRDdGxTZXJ2aWNlLFxyXG4gICAgcHJvdGVjdGVkIGxvY2tTY3JlZW5TZXJ2aWNlOiBMb2NrU2NyZWVuU2VydmljZVxyXG4gICkge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuY3RsTmFtZSA9IFwiU0hDdGxQb3B1cFwiO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICpcclxuICAgKi9cclxuICBwdWJsaWMgbm9DaGFuZ2VGbGdDaGFuZ2UoZXZlbnQpIHtcclxuICAgIHRoaXMubm9DaGFuZ2VGbGcgPSBldmVudC50YXJnZXQudmFsdWU7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5ub0NoYW5nZUZsZyA9IGBPRkZgO1xyXG4gICAgfSwgMTAwMCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOWFpeWKm+OCs+ODs+ODiOODreODvOODq+OBruW5heOCkuaMh+WumlxyXG4gICAqL1xyXG4gIHB1YmxpYyBzZXRJbnB1dFdpZHRoKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaGlkZGVuTGFiZWwgPyB7IHdpZHRoOiBcIjEwMCVcIiB9IDogeyB3aWR0aDogXCIzMy4zJVwiIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDjg6njg5njg6vjgrPjg7Pjg4jjg63jg7zjg6vjga7luYXjgpLmjIflrppcclxuICAgKi9cclxuICBwdWJsaWMgc2V0TGFiZWxXaWR0aCgpIHtcclxuICAgIHJldHVybiB0aGlzLmhpZGRlbklucHV0ID8geyB3aWR0aDogXCIxMDAlXCIgfSA6IHsgd2lkdGg6IFwiNjYuNiVcIiB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog44OH44O844K/44OQ44Kk44Oz44OJ44GV44KM44Gf5YCk44KS5YaN6Kit5a6a44GZ44KL6Zqb44Gr5YCk44KS5qSc6Ki844GXXHJcbiAgICog6Kaq44Kz44Oz44Od44O844ON44Oz44OI44Gr5rih44GZXHJcbiAgICogQHBhcmFtIGNoYW5nZXMg54++5Zyo44Gu5YCk44Go55u05YmN44Gu5YCk44KS5Y+W5b6X5Ye65p2l44KLXHJcbiAgICovXHJcbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgIGlmIChjaGFuZ2VzLnZhbHVlICYmICFjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICB0aGlzLm5hbWUgPSBcIlwiO1xyXG4gICAgICB0aGlzLnZhbHVlID0gXCJcIjtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMubm9DaGFuZ2VGbGcgPT0gXCJPRkZcIikge1xyXG4gICAgICBpZiAoY2hhbmdlcy52YWx1ZSAmJiBjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSAhPSBjaGFuZ2VzLnZhbHVlLnByZXZpb3VzVmFsdWUpIHtcclxuICAgICAgICAgIHRoaXMuZmV0Y2hDb2Rlcyh0aGlzLmFwaVVybCk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChjaGFuZ2VzLnZhbHVlICYmIGNoYW5nZXMudmFsdWUuZmlyc3RDaGFuZ2UpIHtcclxuICAgICAgICB0aGlzLmluaXRGZXRjaEZsZyA9IHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLmluaXRGZXRjaEZsZykge1xyXG4gICAgICAgIGlmICghdGhpcy52YWx1ZSB8fCAhY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUpIHJldHVybjtcclxuICAgICAgICB0aGlzLmZldGNoQ29kZXModGhpcy5hcGlVcmwpO1xyXG4gICAgICAgIHRoaXMuaW5pdEZldGNoRmxnID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKFxyXG4gICAgICAgIGNoYW5nZXMuYXBpVXJsICYmXHJcbiAgICAgICAgY2hhbmdlcy5hcGlVcmwucHJldmlvdXNWYWx1ZSAhPSBjaGFuZ2VzLmFwaVVybC5jdXJyZW50VmFsdWUgJiZcclxuICAgICAgICAhdGhpcy5pc0JpbmRJbnB1dE51bGwodGhpcy5iaW5kQ29sdW1uQXJyYXkpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5nZXRNYXN0ZXJEYXRhKGNoYW5nZXMuYXBpVXJsLmN1cnJlbnRWYWx1ZSlcclxuICAgICAgICAgICAgLmxlbmd0aCA9PSAwXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIGNoYW5nZXMudmFsdWUgJiZcclxuICAgICAgICAgICAgY2hhbmdlcy52YWx1ZS5jdXJyZW50VmFsdWUgPT0gY2hhbmdlcy52YWx1ZS5wcmV2aW91c1ZhbHVlXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIHRoaXMuZmV0Y2hDb2RlcyhjaGFuZ2VzLmFwaVVybC5jdXJyZW50VmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLmNvZGVzID0gT2JqZWN0KFxyXG4gICAgICAgICAgICB0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZ2V0TWFzdGVyRGF0YShjaGFuZ2VzLmFwaVVybC5jdXJyZW50VmFsdWUpXHJcbiAgICAgICAgICApLmRhdGE7XHJcbiAgICAgICAgICB0aGlzLnZhbHVlID0gdGhpcy5zZXROYW1lKHRoaXMudmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubm9DaGFuZ2VGbGcgPSBgT0ZGYDtcclxuICAgICAgfSwgMTAwMCk7XHJcbiAgICB9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAq44OX44Ot44OR44OG44Kj44Gu5Yid5pyf5YyWXHJcbiAgICrpgJrluLjjgrXjg7zjg5Pjgrnjgavjgq3jg6Pjg4Pjgrfjg6XjgZfjgabjgYTjgovjgYzjgIHnhKHjgZHjgozjgbDlho3luqbjg57jgrnjgr/jgojjgorlj5blvpdcclxuICAgKi9cclxuICBwdWJsaWMgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLm9uSW5pdCgpO1xyXG4gICAgaWYgKHRoaXMucG9wdXBXaWR0aCkge1xyXG4gICAgICB0aGlzLmV4dGVuZFdpZHRoID0gdGhpcy5wb3B1cFdpZHRoO1xyXG4gICAgfVxyXG4gICAgLy8gLy/jg6bjg4vjg7zjgq/jgarmloflrZfliJdcclxuICAgIGlmICh0aGlzLmlzRGlzYWJsZWQpIHtcclxuICAgICAgaWYgKHRoaXMuU21wbFBvcHVwU2VydmljZS5nZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsKS5sZW5ndGggPD0gMCkge1xyXG4gICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5mZXRjaEFsbCh0aGlzLmFwaVVybCkudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgIHRoaXMuY29kZXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgdGhpcy5jb2Rlc0hlYWRlciA9IE9iamVjdC52YWx1ZXMocmVzcG9uc2UuaGVhZGVyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICphcGkg6YCa5L+hIOODnuOCueOCv+OBi+OCieWPluW+l1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBmZXRjaENvZGVzKHVybDogc3RyaW5nLCB2YWx1ZT86IHN0cmluZykge1xyXG4gICAgaWYgKHRoaXMuaXNCdXN5KSByZXR1cm47XHJcbiAgICB0aGlzLmlzQnVzeSA9IHRydWU7XHJcbiAgICB0aGlzLmxvY2tTY3JlZW5TZXJ2aWNlLmxvY2tTY3JlZW4oKTtcclxuICAgIChkb2N1bWVudC5hY3RpdmVFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5ibHVyKCk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuU21wbFBvcHVwU2VydmljZS5mZXRjaEFsbCh1cmwpKS5jYXRjaChfID0+IHt0aGlzLmxvY2tTY3JlZW5TZXJ2aWNlLnVubG9jaygpfSkudGhlbihcclxuICAgICAgKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jb2RlcyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgdGhpcy5jb2Rlc0hlYWRlciA9IE9iamVjdC52YWx1ZXMocmVzcG9uc2UuaGVhZGVyKTtcclxuICAgICAgICB0aGlzLmRhdGFUaXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xyXG4gICAgICAgIGNvbnN0IG9rID0gdGhpcy5jaGVja1ZhbHVlKHZhbHVlIHx8IHRoaXMudmFsdWUpO1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBcIlwiO1xyXG4gICAgICAgIGlmIChvaykge1xyXG4gICAgICAgICAgaWYgKHZhbHVlIHx8IHRoaXMudmFsdWUpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5zZXROYW1lKHZhbHVlIHx8IHRoaXMudmFsdWUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKHRoaXMuZGF0YUNhY2hlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5zZXRNYXN0ZXJEYXRhKHVybCwgcmVzcG9uc2UpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQnVzeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgIHRoaXMubG9ja1NjcmVlblNlcnZpY2UudW5sb2NrKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIClcclxuXHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIG9uSW5wdXRcclxuICAgKiBAcGFyYW0gZXZlbnQgaW5wdXRcclxuICAgKi9cclxuICBwdWJsaWMgb25JbnB1dChldmVudCkge1xyXG4gICAgU0hDdGxDb21tb24ucmVwbGFjZVNwYWNlKGV2ZW50KTtcclxuICAgIFNIQ3RsQ29tbW9uLnJlcGxhY2VGdWxsV2lkdGgoZXZlbnQpO1xyXG4gICAgU0hDdGxDb21tb24ucmVwbGFjZVNpZ24oZXZlbnQpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiDjg4DjgqTjgqLjg63jgrDjgpLplovjgYTjgabplonjgZjjgovmmYLjgavlgKTjgpLopqrjgavov5TjgZlcclxuICAgKi9cclxuICBwdWJsaWMgb3BlbkRpYWxvZygpIHtcclxuICAgIC8vIHZhbHVl44Gu5YCk44KS5LiA5pmC5a++5q+U44CA44OA44Kk44Ki44Ot44Kw44KS6ZaJ44GY44KL6Zqb44Gr5q+U6LyD44GX44G+44GZXHJcbiAgICBjb25zdCB0bXAgPSB0aGlzLnZhbHVlO1xyXG4gICAgaWYgKFxyXG4gICAgICAhdGhpcy5wb3B1cFdpZHRoICYmXHJcbiAgICAgIHRoaXMuY29kZXMubGVuZ3RoICE9IDAgJiZcclxuICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLmNvZGVzWzBdKS5sZW5ndGggPj0gNFxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXMuZXh0ZW5kV2lkdGggPSBTaEN0bENvbnN0LkRJQUxPR19NQVhfV0lEVEg7XHJcbiAgICB9XHJcbiAgICB0aGlzLmRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oU0hDdGxQb3B1cERpYWxvZ0NvbXBvbmVudCwge1xyXG4gICAgICBoZWlnaHQ6IFNoQ3RsQ29uc3QuRElBTE9HX0hFSUdIVCxcclxuICAgICAgd2lkdGg6IHRoaXMuZXh0ZW5kV2lkdGgsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBkYXRhVGl0bGU6IHRoaXMuZGF0YVRpdGxlLFxyXG4gICAgICAgIGNvZGVzOiB0aGlzLmNvZGVzLFxyXG4gICAgICAgIGNvZGVzSGVhZGVyOiB0aGlzLmNvZGVzSGVhZGVyLFxyXG4gICAgICAgIGhpZGRlbkNvbHVtbnM6IHRoaXMuaGlkZGVuQ29sdW1ucyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gICAgdGhpcy5kaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKS5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xyXG4gICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZU5hbWUocmVzdWx0KTtcclxuICAgICAgICAvL3RoaXMuYWxsb2NhdGVUb0lucHV0VmFsdWUocmVzdWx0KTtcclxuICAgICAgICB0aGlzLmJpbmRDdGxTZXJ2aWNlLnNldE5vQ2hhbmdlRmxnKHtcclxuICAgICAgICAgIGJpbmRDb2x1bW5BcnJheTogdGhpcy5iaW5kQ29sdW1uQXJyYXksXHJcbiAgICAgICAgICByZWNvcmQ6IHJlc3VsdCxcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmJpbmRDdGxTZXJ2aWNlLnNldEJpbmRWYWx1ZSh7XHJcbiAgICAgICAgICBiaW5kQ29sdW1uQXJyYXk6IHRoaXMuYmluZENvbHVtbkFycmF5LFxyXG4gICAgICAgICAgcmVjb3JkOiByZXN1bHQsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5ub0NoYW5nZUZsZyA9IGBPTmA7XHJcbiAgICAgICAgLy9jaGFuZ2XjgqTjg5njg7Pjg4jntYznlLHjgadlbWl044GZ44KL44Go54Sh5p2h5Lu244GnYWZ0ZXJDaGFuZ2XjgqTjg5njg7Pjg4jjgYzlkbzjgbDjgozjgovjga7jgadcclxuICAgICAgICAvL+WApOOCkuavlOi8g+OBl+WkieabtOOBjOOBquOBkeOCjOOBsOOBk+OBruOCv+OCpOODn+ODs+OCsOOBp2VtaXTjgZnjgotcclxuICAgICAgICBjb25zdCByZXN1bHRWYWx1ZXMgPSBPYmplY3QudmFsdWVzKHJlc3VsdCk7XHJcbiAgICAgICAgaWYgKHJlc3VsdFZhbHVlcyAmJiByZXN1bHRWYWx1ZXMuaW5jbHVkZXModG1wKSkge1xyXG4gICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHRoaXMudmFsdWUpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuZGlzcGF0Y2hPd25WYWx1ZUlucHV0Q2hhbmdlRXZlbnQoKTtcclxuICAgICAgICB9LCAwKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqQCDoh6rouqvjga52YWx1ZeOBq+e0kOOBpeOBj2lucHV044Gu44OB44Kn44Oz44K444Kk44OZ44Oz44OI44KS55m654GrXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBkaXNwYXRjaE93blZhbHVlSW5wdXRDaGFuZ2VFdmVudCgpIHtcclxuICAgIGlmICh0aGlzLm93blZhbHVlSW5wdXRFbG0pIHtcclxuICAgICAgdGhpcy5vd25WYWx1ZUlucHV0RWxtLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiY2hhbmdlXCIpKTtcclxuICAgIH1cclxuICB9XHJcbiAgLyoqXHJcbiAgICpAIGJpbmTlhYjjga5pbnB1dOOBjG51bGzjgYvjganjgYbjgYtcclxuICAgKi9cclxuICBwdWJsaWMgaXNCaW5kSW5wdXROdWxsKGJpbmRDb2x1bW5BcnJheTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfVtdKSB7XHJcbiAgICBpZiAoIWJpbmRDb2x1bW5BcnJheSB8fCBiaW5kQ29sdW1uQXJyYXkubGVuZ3RoID09IDApIHJldHVybiB0cnVlO1xyXG4gICAgcmV0dXJuIGJpbmRDb2x1bW5BcnJheVxyXG4gICAgICAubWFwKChiaW5kQ29sdW1uRGF0YSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgYGlucHV0W25hbWU9JHtPYmplY3Qua2V5cyhiaW5kQ29sdW1uRGF0YSlbMF19XWBcclxuICAgICAgICApIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5tYXAoKGJpbmRJbnB1dCkgPT4ge1xyXG4gICAgICAgIGlmICghYmluZElucHV0KSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuICEhYmluZElucHV0LnZhbHVlO1xyXG4gICAgICB9KVxyXG4gICAgICAuaW5jbHVkZXMoZmFsc2UpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25DbGlja1xyXG4gICAqIEBwYXJhbSBldmVudCBjbGlja1xyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkNsaWNrKGV2ZW50KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlQ2xpY2soZXZlbnQpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLm9uQWZ0ZXJDbGljayhldmVudCk7XHJcbiAgICB9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uRm9jdXNcclxuICAgKiBAcGFyYW0gZXZlbnQgZm9jdXNcclxuICAgKi9cclxuICBwdWJsaWMgb25Gb2N1cyhldmVudCkge1xyXG4gICAgdGhpcy5vbkJlZm9yZUZvY3VzKGV2ZW50KTtcclxuXHJcbiAgICBldmVudC50YXJnZXQuc2VsZWN0KCk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMub25BZnRlckZvY3VzKGV2ZW50KTtcclxuICAgIH0sIDApO1xyXG4gIH1cclxuICBwdWJsaWMgY2xlYXJBbGwoKSB7XHJcbiAgICB0aGlzLnZhbHVlID0gXCJcIjtcclxuICAgIHRoaXMubmFtZSA9IFwiXCI7XHJcbiAgICBpZiAodGhpcy5vd25MYWJlbElucHV0RWxtKSB7XHJcbiAgICAgIHRoaXMub3duTGFiZWxJbnB1dEVsbS52YWx1ZSA9IFwiXCI7XHJcbiAgICB9XHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoXCJcIik7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIG9uQ2hhbmdlXHJcbiAgICogQHBhcmFtIGV2ZW50IGNoYW5nZVxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbkNoYW5nZShldmVudCkge1xyXG4gICAgdGhpcy5vbkJlZm9yZUNoYW5nZShldmVudCk7XHJcbiAgICBpZiAoIWV2ZW50LnRhcmdldC52YWx1ZSkge1xyXG4gICAgICB0aGlzLmNsZWFyQWxsKCk7XHJcbiAgICB9XHJcbiAgICBsZXQgZmxnID0gZmFsc2U7XHJcbiAgICBpZiAodGhpcy5ub0NoYW5nZUZsZyA9PSBcIk9GRlwiKSB7XHJcbiAgICAgIGZsZyA9IHRydWU7XHJcbiAgICAgIGlmIChcclxuICAgICAgICB0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZ2V0TWFzdGVyRGF0YSh0aGlzLmFwaVVybCkubGVuZ3RoID09IDAgJiZcclxuICAgICAgICBldmVudC50YXJnZXQudmFsdWVcclxuICAgICAgKSB7XHJcbiAgICAgICAgdGhpcy5ub0NoYW5nZUZsZyA9IFwiT05cIjtcclxuICAgICAgICB0aGlzLmZldGNoQ29kZXModGhpcy5hcGlVcmwsIHRoaXMudG9UZXh0KGV2ZW50LnRhcmdldC52YWx1ZSkpLnRoZW4oXHJcbiAgICAgICAgICAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHZhbHVlKTtcclxuICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gdGhpcy50b1RleHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgdGhpcy5vbkFmdGVyQ2hhbmdlKGV2ZW50KTtcclxuICAgICAgICAgICAgfSwgMCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSB0aGlzLnNldE5hbWUoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMub25BZnRlckNoYW5nZShldmVudCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICghZmxnKSB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdChldmVudC50YXJnZXQudmFsdWUpO1xyXG4gICAgICAgIHRoaXMub25BZnRlckNoYW5nZShldmVudCk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLm5vQ2hhbmdlRmxnID0gYE9GRmA7XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgIH0sIDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25CbHVyXHJcbiAgICogQHBhcmFtIGV2ZW50IGJsdXJcclxuICAgKi9cclxuICBwdWJsaWMgb25CbHVyKGV2ZW50KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlQmx1cihldmVudCk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMub25BZnRlckJsdXIoZXZlbnQpO1xyXG4gICAgfSwgMCk7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAq5omL5YWl5Yqb44Gu5YCk44GL44KJ44Gu5qSc57Si57WQ5p6c44GM6KSH5pWw44GC44Gj44Gf5aC05ZCI44Gv44Ki44Op44O844OI44KS5Ye644GZXHJcbiAgICovXHJcbiAgcHVibGljIGNoZWNrVmFsdWUodmFsdWUpIHtcclxuICAgIGlmICghdmFsdWUpIHJldHVybiBmYWxzZTtcclxuICAgIC8vbGV0IG1hdGNoZWRBcnJheSA9IFtdO1xyXG4gICAgaWYgKHRoaXMuY29kZXNbMF0pIHtcclxuICAgICAgY29uc3QgZmlsdGVyUmVzdWx0ID0gdGhpcy5jb2Rlcy5maWx0ZXIoXHJcbiAgICAgICAgKGVsZW1lbnQpID0+XHJcbiAgICAgICAgICAvL3RoaXMuaGFzTWF0Y2hSZWNvcmRzKGVsZW1lbnQsIHZhbHVlKVxyXG4gICAgICAgICAgT2JqZWN0LnZhbHVlcyhlbGVtZW50KVt0aGlzLmJpbmRDb2x1bW5LZXkgLSAxXSA9PSB2YWx1ZVxyXG4gICAgICApO1xyXG4gICAgICBpZiAoZmlsdGVyUmVzdWx0Lmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgdGhpcy5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KFwiXCIpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGZpbHRlclJlc3VsdC5sZW5ndGggPj0gMikge1xyXG4gICAgICAgIGFsZXJ0KHZhbHVlICsgXCLjgavopIfmlbDjga7lgJnoo5zjgYzmpJzlh7rjgZXjgozjgb7jgZfjgZ9cIik7XHJcbiAgICAgICAgdGhpcy5jbGVhclZhbHVlKCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KFwiXCIpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOODnuOCueOCv+aDheWgseOCiOOCiuOCs+ODvOODieOCkuWPluW+l1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDb2RlcygpIHtcclxuICAgIHRoaXMub3BlbkRpYWxvZygpO1xyXG4gICAgaWYgKHRoaXMuU21wbFBvcHVwU2VydmljZS5nZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsKS5sZW5ndGggPT0gMCkge1xyXG4gICAgICB0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZmV0Y2hBbGwodGhpcy5hcGlVcmwpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jb2RlcyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgdGhpcy5jb2Rlc0hlYWRlciA9IE9iamVjdC52YWx1ZXMocmVzcG9uc2UuaGVhZGVyKTtcclxuICAgICAgICB0aGlzLmRhdGFUaXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xyXG4gICAgICAgIGlmICh0aGlzLmRhdGFDYWNoZSlcclxuICAgICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5zZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsLCByZXNwb25zZSk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmRpYWxvZ1JlZikgcmV0dXJuO1xyXG4gICAgICAgIGlmICh0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29kZXNIZWFkZXIgPSB0aGlzLmNvZGVzSGVhZGVyO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UudW5jaGFuZ2VhYmxlQ29kZXMgPSB0aGlzLmNvZGVzO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29kZXMgPSB0aGlzLmNvZGVzO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuZGF0YVRpdGxlID0gdGhpcy5kYXRhVGl0bGU7XHJcbiAgICAgICAgICBpZiAoIXRoaXMucG9wdXBXaWR0aCAmJiBPYmplY3QudmFsdWVzKHRoaXMuY29kZXNbMF0pLmxlbmd0aCA+PSA0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kV2lkdGggPSBTaEN0bENvbnN0LkRJQUxPR19NQVhfV0lEVEg7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi51cGRhdGVTaXplKHRoaXMuZXh0ZW5kV2lkdGgsIFNoQ3RsQ29uc3QuRElBTE9HX0hFSUdIVCk7XHJcbiAgICAgICAgICBsZXQgY29scyA9IFtdO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2VcclxuICAgICAgICAgICAgLmdldEhhc2hLZXlzKClcclxuICAgICAgICAgICAgLmZvckVhY2goKG5hbWUsIGlkeCkgPT4ge1xyXG4gICAgICAgICAgICAgIGlmICghdGhpcy5oaWRkZW5Db2x1bW5zLmZpbmQoKF8pID0+IF8gPT0gaWR4ICsgMSkpXHJcbiAgICAgICAgICAgICAgICBjb2xzLnB1c2gobmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuZGlzcGxheWVkQ29sdW1ucyA9IGNvbHM7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuY29kZXMgPSBPYmplY3QoXHJcbiAgICAgICAgdGhpcy5TbXBsUG9wdXBTZXJ2aWNlLmdldE1hc3RlckRhdGEodGhpcy5hcGlVcmwpXHJcbiAgICAgICkuZGF0YTtcclxuICAgICAgdGhpcy5jb2Rlc0hlYWRlciA9IE9iamVjdC52YWx1ZXMoXHJcbiAgICAgICAgT2JqZWN0KHRoaXMuU21wbFBvcHVwU2VydmljZS5nZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsKSkuaGVhZGVyXHJcbiAgICAgICk7XHJcbiAgICAgIGlmICh0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZSkge1xyXG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmNvZGVzSGVhZGVyID0gdGhpcy5jb2Rlc0hlYWRlcjtcclxuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS51bmNoYW5nZWFibGVDb2RlcyA9IHRoaXMuY29kZXM7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29kZXMgPSB0aGlzLmNvZGVzO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmRhdGFUaXRsZSA9IHRoaXMuZGF0YVRpdGxlO1xyXG4gICAgICAgIGlmICghdGhpcy5wb3B1cFdpZHRoICYmIE9iamVjdC52YWx1ZXModGhpcy5jb2Rlc1swXSkubGVuZ3RoID49IDQpIHtcclxuICAgICAgICAgIHRoaXMuZXh0ZW5kV2lkdGggPSBTaEN0bENvbnN0LkRJQUxPR19NQVhfV0lEVEg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLnVwZGF0ZVNpemUodGhpcy5leHRlbmRXaWR0aCwgU2hDdGxDb25zdC5ESUFMT0dfSEVJR0hUKTtcclxuICAgICAgICBsZXQgY29scyA9IFtdO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmdldEhhc2hLZXlzKCkuZm9yRWFjaCgobmFtZSwgaWR4KSA9PiB7XHJcbiAgICAgICAgICBpZiAoIXRoaXMuaGlkZGVuQ29sdW1ucy5maW5kKChfKSA9PiBfID09IGlkeCArIDEpKSBjb2xzLnB1c2gobmFtZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuZGlzcGxheWVkQ29sdW1ucyA9IGNvbHM7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiHquOCs+ODs+ODiOODreODvOODq+OBrmlucHV0IHZhbHVlIOOBq+WApOOCkua4oeOBmVxyXG4gICAqIEBwYXJhbSBtYXRjaGVkQXJyYXlcclxuICAgKi9cclxuICBwdWJsaWMgc2V0VmFsdWVOYW1lKG1hdGNoZWRBcnJheSkge1xyXG4gICAgaWYgKE9iamVjdC52YWx1ZXMobWF0Y2hlZEFycmF5KVt0aGlzLmJpbmRDb2x1bW5LZXkgLSAxXSkge1xyXG4gICAgICBjb25zdCB2YWwgPSBPYmplY3QudmFsdWVzKG1hdGNoZWRBcnJheSlbXHJcbiAgICAgICAgdGhpcy5iaW5kQ29sdW1uS2V5IC0gMVxyXG4gICAgICBdLnRvU3RyaW5nKCk7XHJcbiAgICAgIHRoaXMudmFsdWUgPSB2YWw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnZhbHVlID0gXCJcIjtcclxuICAgIH1cclxuICAgIGlmIChPYmplY3QudmFsdWVzKG1hdGNoZWRBcnJheSlbdGhpcy5iaW5kQ29sdW1uVmFsdWUgLSAxXSkge1xyXG4gICAgICB0aGlzLm5hbWUgPSBPYmplY3QudmFsdWVzKG1hdGNoZWRBcnJheSlbXHJcbiAgICAgICAgdGhpcy5iaW5kQ29sdW1uVmFsdWUgLSAxXHJcbiAgICAgIF0udG9TdHJpbmcoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubmFtZSA9IFwiXCI7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAq6Kaq5a2Q6Zai5L+C44Gr44Gq44Gj44Gm44GE44KLaW5wdXTjgYzjgYLjgovloLTlkIjjgavmpJzntKLlr77osaHjgpLopqrjgb7jgafluoPjgZLjgotcclxuICAgKi9cclxuICBwcml2YXRlIGhhc01hdGNoUmVjb3JkcyhlbGVtZW50OiBhbnksIHZhbDogYW55KTogYm9vbGVhbiB7XHJcbiAgICAvLyDmpJzntKLntZDmnpzkuIDooYzliIbjga7mr5TovIPjgZnjgbnjgY3liJfjga7lgKRcclxuICAgIGxldCBzZWFyY2hzID0gW107XHJcbiAgICAvLyDnj77lnKjjga7mr5TovIPjgZnjgbnjgY3lgKRcclxuICAgIGxldCB2YWx1ZXMgPSBbdmFsXTtcclxuICAgIHNlYXJjaHMucHVzaChPYmplY3QudmFsdWVzKGVsZW1lbnQpW3RoaXMuYmluZENvbHVtbktleSAtIDFdKTtcclxuICAgIGlmICh0aGlzLmJpbmRDb2x1bW5BcnJheSAmJiB0aGlzLmJpbmRDb2x1bW5BcnJheS5sZW5ndGggIT0gMCkge1xyXG4gICAgICB0aGlzLmJpbmRDb2x1bW5BcnJheS5mb3JFYWNoKChkYXRhKSA9PiB7XHJcbiAgICAgICAgbGV0IGJpbmRJbmRleCA9IChPYmplY3QudmFsdWVzKGRhdGEpWzBdIGFzIG51bWJlcikgLSAxO1xyXG4gICAgICAgIHNlYXJjaHMucHVzaChPYmplY3QudmFsdWVzKGVsZW1lbnQpW2JpbmRJbmRleF0pO1xyXG4gICAgICAgIGxldCB0YXJnZXRJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICBgaW5wdXRbbmFtZT0ke09iamVjdC5rZXlzKGRhdGEpWzBdfV1gXHJcbiAgICAgICAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgICAgIGlmICh0YXJnZXRJbnB1dCkge1xyXG4gICAgICAgICAgaWYgKHRhcmdldElucHV0LnZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhbHVlcy5wdXNoKHRhcmdldElucHV0LnZhbHVlKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlYXJjaHMgPSBzZWFyY2hzLmZpbHRlcihcclxuICAgICAgICAgICAgICAodmFsKSA9PiB2YWwgIT0gT2JqZWN0LnZhbHVlcyhlbGVtZW50KVtiaW5kSW5kZXhdXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlc3VsdCA9IHNlYXJjaHMubWFwKCh2YWwpID0+IHZhbHVlcy5pbmNsdWRlcyh2YWwpKTtcclxuICAgIHJldHVybiAhcmVzdWx0LmluY2x1ZGVzKGZhbHNlKTtcclxuICB9XHJcbiAgLyoqXHJcbiAgICog6YG45oqe44GV44KM44Gf5Yy65YiG44Kz44O844OJ44Gr57SQ44Gl44GP5Yy65YiG5ZCN44KS6Kit5a6aXHJcbiAgICovXHJcbiAgcHVibGljIHNldE5hbWUodmFsKSB7XHJcbiAgICBjb25zdCByZWNvcmQgPSB0aGlzLmNvZGVzXHJcbiAgICAgID8gdGhpcy5jb2Rlcy5maW5kKFxyXG4gICAgICAgICAgKGVsZW1lbnQpID0+IE9iamVjdC52YWx1ZXMoZWxlbWVudClbdGhpcy5iaW5kQ29sdW1uS2V5IC0gMV0gPT0gdmFsXHJcbiAgICAgICAgKVxyXG4gICAgICA6IG51bGw7XHJcbiAgICBpZiAocmVjb3JkKSB7XHJcbiAgICAgIGxldCBrYm5WYWx1ZSA9IE9iamVjdC52YWx1ZXMocmVjb3JkKVt0aGlzLmJpbmRDb2x1bW5WYWx1ZSAtIDFdO1xyXG4gICAgICB0aGlzLm5hbWUgPSBrYm5WYWx1ZSA/IGtiblZhbHVlLnRvU3RyaW5nKCkgOiBcIlwiO1xyXG4gICAgICB0aGlzLmJpbmRDdGxTZXJ2aWNlLnNldEJpbmRWYWx1ZSh7XHJcbiAgICAgICAgYmluZENvbHVtbkFycmF5OiB0aGlzLmJpbmRDb2x1bW5BcnJheSxcclxuICAgICAgICByZWNvcmQsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFsID0gXCJcIjtcclxuICAgICAgdGhpcy5jbGVhckFsbCgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOWFpeWKm+OBruOCr+ODquOColxyXG4gICAqL1xyXG4gIHB1YmxpYyBjbGVhclZhbHVlKCkge1xyXG4gICAgdGhpcy52YWx1ZSA9IFwiXCI7XHJcbiAgICB0aGlzLm5hbWUgPSBcIlwiO1xyXG4gICAgaWYgKHRoaXMuY3RsTmFtZSkge1xyXG4gICAgICB0aGlzLm93blZhbHVlSW5wdXRFbG0udmFsdWUgPSBcIlwiO1xyXG4gICAgICAvL+OCv+OCpOODn+ODs+OCsOOCkumBheOCieOBm+OBquOBhOOBqGNoYW5nZeOCpOODmeODs+ODiOWGheOBrmV2ZW50LnRhcmdldC52YWx1ZeOBjOWJjeOBruWApOOBq+OBquOCi1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLm93blZhbHVlSW5wdXRFbG0uZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJjaGFuZ2VcIikpO1xyXG4gICAgICAgIHRoaXMub3duVmFsdWVJbnB1dEVsbS5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudChcImZvY3VzXCIpKTtcclxuICAgICAgfSwgMCk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5wb3B1cExhYmVsTmFtZSkge1xyXG4gICAgICB0aGlzLm93bkxhYmVsSW5wdXRFbG0udmFsdWUgPSBcIlwiO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKiDjgrXjg5bjgq/jg6njgrnjgafjgqrjg7zjg5Djg7zjg6njgqTjg4njgZfjgabkvb/jgYbjga7jgafmtojjgZXjgarjgYRcclxuICAgKi9cclxuICBwdWJsaWMgdG9UZXh0KHM6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHM7XHJcbiAgfVxyXG4gIHB1YmxpYyBleHRyYWN0QmluZFZhbHVlKHJlc3VsdDogYW55KSB7XHJcbiAgICBpZiAoIXJlc3VsdCkgcmV0dXJuO1xyXG4gICAgcmV0dXJuIE9iamVjdC52YWx1ZXMocmVzdWx0KVt0aGlzLmJpbmRDb2x1bW5LZXkgLSAxXTtcclxuICB9XHJcbn1cclxuIl19