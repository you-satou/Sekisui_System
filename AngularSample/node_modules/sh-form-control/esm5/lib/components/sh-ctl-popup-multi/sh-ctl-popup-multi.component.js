/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from "@angular/core";
import { SmplPopupService } from "../../services/smpl-popup.service";
import { MatDialog } from "@angular/material";
import { SHFormControl } from '../../utilities/ShFormControl';
import { SHCtlPopupDialogMultiComponent } from '../sh-ctl-popup-multi-dialog/sh-ctl-popup-multi-dialog.component';
import { ShCtlConst } from '../../constShCtl';
var ShCtlPopupMultiComponent = /** @class */ (function (_super) {
    tslib_1.__extends(ShCtlPopupMultiComponent, _super);
    function ShCtlPopupMultiComponent(SmplPopupService, dialog) {
        var _this = _super.call(this) || this;
        _this.SmplPopupService = SmplPopupService;
        _this.dialog = dialog;
        //データタイトル名
        _this.dataTitle = "";
        //API URL
        _this.apiUrl = "/api/";
        //データキャッシュON/OFF機能フラグ
        _this.dataCache = false;
        //キーとなる列番号(起動時のチェックを入れるためのキー判定基準になります。)
        _this.uniqueColumns = [1];
        //ポップアップ上非表示となる列番号
        _this.hiddenColumns = [];
        _this.extendWidth = ShCtlConst.DIALOG_WIDTH;
        //Dialogの結果を受け取る
        _this.dialogRef = null;
        _this.codes = [];
        _this.codesHeader = [];
        _this.ctlName = "SHCtlPopupMulti";
        return _this;
    }
    /**
     * ダイアログを開いて閉じる時に値を親に返す
     */
    /**
     * ダイアログを開いて閉じる時に値を親に返す
     * @return {?}
     */
    ShCtlPopupMultiComponent.prototype.openDialog = /**
     * ダイアログを開いて閉じる時に値を親に返す
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.codes) {
            if (!this.popupWidth && this.codes.length != 0 && Object.values(this.codes[0]).length >= 4) {
                this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
            }
            this.dialogRef = this.dialog.open(SHCtlPopupDialogMultiComponent, {
                height: ShCtlConst.DIALOG_HEIGHT,
                width: this.extendWidth,
                data: {
                    dataTitle: this.dataTitle,
                    value: this.value,
                    uniqueColumns: this.uniqueColumns,
                    hiddenColumns: this.hiddenColumns,
                }
            });
            this.dialogRef.afterClosed().subscribe((/**
             * @param {?} result
             * @return {?}
             */
            function (result) {
                if (result != undefined)
                    _this.valueChange.emit(result);
            }));
        }
    };
    /**
     *プロパティの初期化
     *通常サービスにキャッシュしているが、無ければ再度マスタより取得
     */
    /**
     * プロパティの初期化
     * 通常サービスにキャッシュしているが、無ければ再度マスタより取得
     * @return {?}
     */
    ShCtlPopupMultiComponent.prototype.ngOnInit = /**
     * プロパティの初期化
     * 通常サービスにキャッシュしているが、無ければ再度マスタより取得
     * @return {?}
     */
    function () {
        var _this = this;
        this.onInit();
        if (this.popupWidth) {
            this.extendWidth = this.popupWidth;
        }
        // //ユニークな文字列
        if (this.SmplPopupService.getMasterData(this.apiUrl).length >= 0) {
            this.SmplPopupService.fetchAll(this.apiUrl).then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.codes = response.data;
                if (response.header == null) {
                    return;
                }
                _this.codesHeader = Object.values(response.header);
                _this.dataTitle = response.title;
            }));
        }
    };
    /**
     * マスタ情報よりコードを取得
     */
    /**
     * マスタ情報よりコードを取得
     * @return {?}
     */
    ShCtlPopupMultiComponent.prototype.getCodes = /**
     * マスタ情報よりコードを取得
     * @return {?}
     */
    function () {
        var _this = this;
        this.openDialog();
        if (this.SmplPopupService.getMasterData(this.apiUrl).length == 0) {
            this.SmplPopupService.fetchAll(this.apiUrl).then((/**
             * @param {?} response
             * @return {?}
             */
            function (response) {
                _this.codes = response.data;
                _this.codesHeader = Object.values(response.header);
                _this.dataTitle = response.title;
                if (_this.dataCache)
                    _this.SmplPopupService.setMasterData(_this.apiUrl, response);
            }));
            if (this.dialogRef.componentInstance) {
                this.dialogRef.componentInstance.codesHeader = this.codesHeader;
                this.dialogRef.componentInstance.unchangeableCodes = this.codes;
                this.dialogRef.componentInstance.codes = this.codes;
                if (!this.popupWidth && Object.values(this.codes[0]).length >= 4) {
                    this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
                }
                /** @type {?} */
                var cols_1 = [];
                this.dialogRef.componentInstance.getHashKeys().forEach((/**
                 * @param {?} name
                 * @param {?} idx
                 * @return {?}
                 */
                function (name, idx) {
                    if (!_this.hiddenColumns.find((/**
                     * @param {?} _
                     * @return {?}
                     */
                    function (_) { return _ == (idx + 1); })))
                        cols_1.push(name);
                }));
                this.dialogRef.componentInstance.displayedColumns = cols_1;
            }
        }
        else {
            this.codes = Object(this.SmplPopupService.getMasterData(this.apiUrl)).data;
            this.codesHeader = Object.values(Object(this.SmplPopupService.getMasterData(this.apiUrl)).header);
            if (this.dialogRef.componentInstance) {
                this.dialogRef.componentInstance.codesHeader = this.codesHeader;
                this.dialogRef.componentInstance.unchangeableCodes = this.codes;
                this.dialogRef.componentInstance.codes = this.codes;
                if (!this.popupWidth && Object.values(this.codes[0]).length >= 4) {
                    this.extendWidth = ShCtlConst.DIALOG_MAX_WIDTH;
                }
                /** @type {?} */
                var cols_2 = [];
                this.dialogRef.componentInstance.getHashKeys().forEach((/**
                 * @param {?} name
                 * @param {?} idx
                 * @return {?}
                 */
                function (name, idx) {
                    if (!_this.hiddenColumns.find((/**
                     * @param {?} _
                     * @return {?}
                     */
                    function (_) { return _ == (idx + 1); })))
                        cols_2.push(name);
                }));
                this.dialogRef.componentInstance.displayedColumns = cols_2;
            }
        }
    };
    ShCtlPopupMultiComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sh-ctl-popup-multi',
                    template: "<div *ngIf=\"!disabled\" style=\"margin-top: 17px;\">\r\n  <mat-icon mat-button matSuffix class=\"mat-search-btn\"\r\n  (click)=\"getCodes()\">search</mat-icon>\r\n</div>",
                    styles: [".input-group-text{background-color:#fff;border:none}.btn{border:none}.btn.btn-primary:disabled{background-color:#999}.btn-primary{background-color:#17a2b8}.btn-primary:hover{background-color:#1792b8}.fixed-bottom{top:708px;height:65px;max-width:1024px;margin-right:auto;margin-left:auto}.mat-search-btn{color:#bababa;font-size:1.1rem}.mat-search-btn:hover{cursor:pointer}.mat-icon-container{margin-left:-17px}.mat-icon-container .mat-search-btn{color:#bababa;font-size:1.1rem;margin:17px 0 0 100%}.result-input{text-overflow:ellipsis}.display-ctl-view{display:-webkit-box;display:flex}.display-result{margin-left:30px}.valueOutput-container{display:-webkit-box;display:flex;-webkit-box-flex:1;flex:1}.notitle-value{width:100%;margin-left:30px}", ".sh-flex{width:100%;display:-webkit-inline-box;display:inline-flex}.sh-flex-center{-webkit-box-align:center;align-items:center}.sh-flex-between{-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.display-ctl-view{margin-top:20px}.overlay{position:fixed;display:-webkit-box;display:flex;top:0;left:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%;width:100%;color:gray;background-color:rgba(0,0,0,.5);z-index:9999}.loader-text{display:block;color:#f3f3f3;margin-top:1em}.mat-dialog-content{overflow:hidden;max-height:none}.sh-dialog-content{height:85%}.sh-kbn-dialog-table-container{height:92%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-dialog-table-container{display:-webkit-box;display:flex;height:83%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-text-center{text-align:center}.sh-width-100{width:100%}.sh-label{display:block}.custom-alert-message{top:-20px;position:relative;font-size:.75em;color:rgba(0,0,0,.54)}.result-input,.sh-label{color:rgba(0,0,0,.87)}::ng-deep .mat-form-field-label span{color:rgba(0,0,0,.87)}::ng-deep .result-container .mat-form-field-flex{background-color:#ccdcff}.sh-ctl-state-primary::ng-deep .mat-form-field-label{color:#3f51b5}.sh-ctl-state-primary::ng-deep .mat-form-field-underline{background-color:#3f51b5}.sh-ctl-state-primary-message{color:#3f51b5}.sh-ctl-state-secondary::ng-deep .mat-form-field-label{color:#ff4081}.sh-ctl-state-secondary::ng-deep .mat-form-field-underline{background-color:#ff4081}.sh-ctl-state-secondary-message{color:#ff4081}.sh-ctl-state-success::ng-deep .mat-form-field-label{color:#0dad17}.sh-ctl-state-success::ng-deep .mat-form-field-underline{background-color:#0dad17}.sh-ctl-state-success-message{color:#0dad17}.sh-ctl-state-danger::ng-deep .mat-form-field-label{color:#f44336}.sh-ctl-state-danger::ng-deep .mat-form-field-underline{background-color:#f44336}.sh-ctl-state-danger-message{color:#f44336}.sh-ctl-state-warning::ng-deep .mat-form-field-label{color:#e29f2b}.sh-ctl-state-warning::ng-deep .mat-form-field-underline{background-color:#e29f2b}.sh-ctl-state-warning-message{color:#e29f2b}.sh-container{position:relative;width:100%;height:100%}.only-field{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;width:100%;height:100%;min-height:28px}.only-field input,.only-field textarea{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.only-field-danger{background-color:#f44336}.only-field-warning{background-color:#e29f2b}.only-field-success{background-color:#0dad17}::ng-deep .only-field .material-icons{font-size:13px}::ng-deep .only-field .mat-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon{position:absolute;top:0;left:0}::ng-deep .only-field .mat-datepicker-toggle-default-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;margin-right:auto}::ng-deep .mat-datepicker-toggle span svg{width:16px;height:16px}.only-label{background-color:#ccdcff;position:relative}.only-label mat-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;font-size:16px}.bind-flg__input{opacity:0;height:0;width:0;position:absolute;z-index:-100}"]
                }] }
    ];
    /** @nocollapse */
    ShCtlPopupMultiComponent.ctorParameters = function () { return [
        { type: SmplPopupService },
        { type: MatDialog }
    ]; };
    ShCtlPopupMultiComponent.propDecorators = {
        dataTitle: [{ type: Input }],
        apiUrl: [{ type: Input }],
        dataCache: [{ type: Input }],
        uniqueColumns: [{ type: Input }],
        hiddenColumns: [{ type: Input }],
        popupWidth: [{ type: Input }]
    };
    return ShCtlPopupMultiComponent;
}(SHFormControl));
export { ShCtlPopupMultiComponent };
if (false) {
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.dataTitle;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.apiUrl;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.dataCache;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.uniqueColumns;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.hiddenColumns;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.popupWidth;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.extendWidth;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.dialogRef;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.codes;
    /** @type {?} */
    ShCtlPopupMultiComponent.prototype.codesHeader;
    /**
     * @type {?}
     * @protected
     */
    ShCtlPopupMultiComponent.prototype.SmplPopupService;
    /**
     * @type {?}
     * @protected
     */
    ShCtlPopupMultiComponent.prototype.dialog;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY3RsLXBvcHVwLW11bHRpLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NoLWZvcm0tY29udHJvbC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3NoLWN0bC1wb3B1cC1tdWx0aS9zaC1jdGwtcG9wdXAtbXVsdGkuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDckUsT0FBTyxFQUFFLFNBQVMsRUFBZ0IsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDOUQsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sa0VBQWtFLENBQUM7QUFDbEgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTlDO0lBSzhDLG9EQUFrQjtJQW9CNUQsa0NBQ1ksZ0JBQWtDLEVBQ2xDLE1BQWlCO1FBRjdCLFlBSUUsaUJBQU8sU0FFUjtRQUxXLHNCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsWUFBTSxHQUFOLE1BQU0sQ0FBVzs7UUFwQmIsZUFBUyxHQUFXLEVBQUUsQ0FBQzs7UUFFdkIsWUFBTSxHQUFXLE9BQU8sQ0FBQzs7UUFFekIsZUFBUyxHQUFZLEtBQUssQ0FBQzs7UUFFM0IsbUJBQWEsR0FBWSxDQUFDLENBQUMsQ0FBQyxDQUFDOztRQUU3QixtQkFBYSxHQUFZLEVBQUUsQ0FBQztRQUdwQyxpQkFBVyxHQUFHLFVBQVUsQ0FBQyxZQUFZLENBQUM7O1FBRXZDLGVBQVMsR0FBcUQsSUFBSSxDQUFDO1FBRW5FLFdBQUssR0FBRyxFQUFFLENBQUM7UUFDWCxpQkFBVyxHQUFHLEVBQUUsQ0FBQztRQU90QixLQUFJLENBQUMsT0FBTyxHQUFHLGlCQUFpQixDQUFD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Q0FBYyxFQUFDO3dCQUFFLE1BQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZFLENBQUMsRUFBQyxDQUFDO2dCQUNILElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsZ0JBQWdCLEdBQUcsTUFBSSxDQUFDO2FBQzFEO1NBQ0Y7SUFDSCxDQUFDOztnQkEzSEosU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxvQkFBb0I7b0JBQzlCLHNMQUFrRDs7aUJBRW5EOzs7O2dCQVZRLGdCQUFnQjtnQkFDaEIsU0FBUzs7OzRCQVliLEtBQUs7eUJBRUwsS0FBSzs0QkFFTCxLQUFLO2dDQUVMLEtBQUs7Z0NBRUwsS0FBSzs2QkFFSixLQUFLOztJQTRHWCwrQkFBQztDQUFBLEFBN0hELENBSzhDLGFBQWEsR0F3SDFEO1NBeEhZLHdCQUF3Qjs7O0lBRWpDLDZDQUF1Qzs7SUFFdkMsMENBQXlDOztJQUV6Qyw2Q0FBMkM7O0lBRTNDLGlEQUE2Qzs7SUFFN0MsaURBQTRDOztJQUUzQyw4Q0FBbUM7O0lBQ25DLCtDQUE2Qzs7SUFFOUMsNkNBQTBFOztJQUUxRSx5Q0FBa0I7O0lBQ2xCLCtDQUF3Qjs7Ozs7SUFHdEIsb0RBQTRDOzs7OztJQUM1QywwQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBTbXBsUG9wdXBTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL3NtcGwtcG9wdXAuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBNYXREaWFsb2csIE1hdERpYWxvZ1JlZiB9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbFwiO1xyXG5pbXBvcnQgeyBTSEZvcm1Db250cm9sIH0gZnJvbSAnLi4vLi4vdXRpbGl0aWVzL1NoRm9ybUNvbnRyb2wnO1xyXG5pbXBvcnQgeyBTSEN0bFBvcHVwRGlhbG9nTXVsdGlDb21wb25lbnQgfSBmcm9tICcuLi9zaC1jdGwtcG9wdXAtbXVsdGktZGlhbG9nL3NoLWN0bC1wb3B1cC1tdWx0aS1kaWFsb2cuY29tcG9uZW50JztcclxuaW1wb3J0IHsgU2hDdGxDb25zdCB9IGZyb20gJy4uLy4uL2NvbnN0U2hDdGwnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdzaC1jdGwtcG9wdXAtbXVsdGknLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zaC1jdGwtcG9wdXAtbXVsdGkuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL3NoLWN0bC1wb3B1cC1tdWx0aS5jb21wb25lbnQuY3NzJywgJy4uLy4uLy4uL3N0eWxlLmNvbW1vbi5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2hDdGxQb3B1cE11bHRpQ29tcG9uZW50IGV4dGVuZHMgU0hGb3JtQ29udHJvbDxhbnk+IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgIC8v44OH44O844K/44K/44Kk44OI44Or5ZCNXHJcbiAgICBASW5wdXQoKSBwdWJsaWMgZGF0YVRpdGxlOiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgLy9BUEkgVVJMXHJcbiAgICBASW5wdXQoKSBwdWJsaWMgYXBpVXJsOiBzdHJpbmcgPSBcIi9hcGkvXCI7XHJcbiAgICAvL+ODh+ODvOOCv+OCreODo+ODg+OCt+ODpU9OL09GRuapn+iDveODleODqeOCsFxyXG4gICAgQElucHV0KCkgcHVibGljIGRhdGFDYWNoZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLy/jgq3jg7zjgajjgarjgovliJfnlarlj7co6LW35YuV5pmC44Gu44OB44Kn44OD44Kv44KS5YWl44KM44KL44Gf44KB44Gu44Kt44O85Yik5a6a5Z+65rqW44Gr44Gq44KK44G+44GZ44CCKVxyXG4gICAgQElucHV0KCkgcHVibGljIHVuaXF1ZUNvbHVtbnM6bnVtYmVyW10gPSBbMV07XHJcbiAgICAvL+ODneODg+ODl+OCouODg+ODl+S4iumdnuihqOekuuOBqOOBquOCi+WIl+eVquWPt1xyXG4gICAgQElucHV0KCkgcHVibGljIGhpZGRlbkNvbHVtbnM6bnVtYmVyW10gPSBbXTtcclxuICAgICAvLyDjg4DjgqTjgqLjg63jgrDjga7luYXjgpLmjIflrppcclxuICAgICBASW5wdXQoKSBwdWJsaWMgcG9wdXBXaWR0aDogc3RyaW5nO1xyXG4gICAgIHB1YmxpYyBleHRlbmRXaWR0aCA9IFNoQ3RsQ29uc3QuRElBTE9HX1dJRFRIO1xyXG4gICAgLy9EaWFsb2fjga7ntZDmnpzjgpLlj5fjgZHlj5bjgotcclxuICAgIHB1YmxpYyBkaWFsb2dSZWY6IE1hdERpYWxvZ1JlZjxTSEN0bFBvcHVwRGlhbG9nTXVsdGlDb21wb25lbnQsYW55PiA9IG51bGw7XHJcblxyXG4gICAgcHVibGljIGNvZGVzID0gW107XHJcbiAgICBwdWJsaWMgY29kZXNIZWFkZXIgPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgcHJvdGVjdGVkIFNtcGxQb3B1cFNlcnZpY2U6IFNtcGxQb3B1cFNlcnZpY2UsXHJcbiAgICAgIHByb3RlY3RlZCBkaWFsb2c6IE1hdERpYWxvZyxcclxuICAgICkge1xyXG4gICAgICBzdXBlcigpO1xyXG4gICAgICB0aGlzLmN0bE5hbWUgPSBcIlNIQ3RsUG9wdXBNdWx0aVwiO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog44OA44Kk44Ki44Ot44Kw44KS6ZaL44GE44Gm6ZaJ44GY44KL5pmC44Gr5YCk44KS6Kaq44Gr6L+U44GZXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBvcGVuRGlhbG9nKCkge1xyXG4gICAgICBpZiAodGhpcy5jb2Rlcykge1xyXG4gICAgICAgIGlmICghdGhpcy5wb3B1cFdpZHRoICYmIHRoaXMuY29kZXMubGVuZ3RoICE9IDAgJiYgT2JqZWN0LnZhbHVlcyh0aGlzLmNvZGVzWzBdKS5sZW5ndGggPj0gNCkge1xyXG4gICAgICAgICAgdGhpcy5leHRlbmRXaWR0aCA9IFNoQ3RsQ29uc3QuRElBTE9HX01BWF9XSURUSDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5kaWFsb2dSZWYgPSB0aGlzLmRpYWxvZy5vcGVuKFNIQ3RsUG9wdXBEaWFsb2dNdWx0aUNvbXBvbmVudCwge1xyXG4gICAgICAgICAgaGVpZ2h0OiBTaEN0bENvbnN0LkRJQUxPR19IRUlHSFQsXHJcbiAgICAgICAgICB3aWR0aDogdGhpcy5leHRlbmRXaWR0aCxcclxuICAgICAgICAgIGRhdGE6IHsgXHJcbiAgICAgICAgICAgICAgZGF0YVRpdGxlOiB0aGlzLmRhdGFUaXRsZSxcclxuICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZSxcclxuICAgICAgICAgICAgICB1bmlxdWVDb2x1bW5zOiB0aGlzLnVuaXF1ZUNvbHVtbnMsXHJcbiAgICAgICAgICAgICAgaGlkZGVuQ29sdW1uczogdGhpcy5oaWRkZW5Db2x1bW5zLFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKCkuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICBpZiAocmVzdWx0ICE9IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KHJlc3VsdCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAq44OX44Ot44OR44OG44Kj44Gu5Yid5pyf5YyWXHJcbiAgICAgKumAmuW4uOOCteODvOODk+OCueOBq+OCreODo+ODg+OCt+ODpeOBl+OBpuOBhOOCi+OBjOOAgeeEoeOBkeOCjOOBsOWGjeW6puODnuOCueOCv+OCiOOCiuWPluW+l1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgbmdPbkluaXQoKSB7XHJcbiAgICAgIHRoaXMub25Jbml0KCk7XHJcbiAgICAgIGlmKHRoaXMucG9wdXBXaWR0aCkge1xyXG4gICAgICAgIHRoaXMuZXh0ZW5kV2lkdGggPSB0aGlzLnBvcHVwV2lkdGhcclxuICAgICAgfSAgXHJcbiAgICAgIC8vIC8v44Om44OL44O844Kv44Gq5paH5a2X5YiXXHJcbiAgICAgIGlmICh0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZ2V0TWFzdGVyRGF0YSh0aGlzLmFwaVVybCkubGVuZ3RoID49IDApIHtcclxuICAgICAgICB0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZmV0Y2hBbGwodGhpcy5hcGlVcmwpLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jb2RlcyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVyID09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0aGlzLmNvZGVzSGVhZGVyID0gT2JqZWN0LnZhbHVlcyhyZXNwb25zZS5oZWFkZXIpO1xyXG4gICAgICAgICAgdGhpcy5kYXRhVGl0bGUgPSByZXNwb25zZS50aXRsZTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIFxyXG4gICAgLyoqXHJcbiAgICAgKiDjg57jgrnjgr/mg4XloLHjgojjgorjgrPjg7zjg4njgpLlj5blvpdcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdldENvZGVzKCkge1xyXG4gICAgICB0aGlzLm9wZW5EaWFsb2coKTtcclxuICAgICAgaWYgKHRoaXMuU21wbFBvcHVwU2VydmljZS5nZXRNYXN0ZXJEYXRhKHRoaXMuYXBpVXJsKS5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgIHRoaXMuU21wbFBvcHVwU2VydmljZS5mZXRjaEFsbCh0aGlzLmFwaVVybCkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmNvZGVzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgIHRoaXMuY29kZXNIZWFkZXIgPSBPYmplY3QudmFsdWVzKHJlc3BvbnNlLmhlYWRlcik7XHJcbiAgICAgICAgICB0aGlzLmRhdGFUaXRsZSA9IHJlc3BvbnNlLnRpdGxlO1xyXG4gICAgICAgICAgaWYgKHRoaXMuZGF0YUNhY2hlKVxyXG4gICAgICAgICAgICB0aGlzLlNtcGxQb3B1cFNlcnZpY2Uuc2V0TWFzdGVyRGF0YSh0aGlzLmFwaVVybCwgcmVzcG9uc2UpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICh0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZSkge1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29kZXNIZWFkZXIgPSB0aGlzLmNvZGVzSGVhZGVyO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UudW5jaGFuZ2VhYmxlQ29kZXMgPSB0aGlzLmNvZGVzO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29kZXMgPSB0aGlzLmNvZGVzO1xyXG4gICAgICAgICAgaWYgKCF0aGlzLnBvcHVwV2lkdGggJiYgT2JqZWN0LnZhbHVlcyh0aGlzLmNvZGVzWzBdKS5sZW5ndGggPj0gNCkge1xyXG4gICAgICAgICAgICB0aGlzLmV4dGVuZFdpZHRoID0gU2hDdGxDb25zdC5ESUFMT0dfTUFYX1dJRFRIO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgbGV0IGNvbHMgPSBbXTtcclxuICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmdldEhhc2hLZXlzKCkuZm9yRWFjaCgobmFtZSwgaWR4KSA9PiB7XHJcbiAgICAgICAgICAgICAgaWYgKCF0aGlzLmhpZGRlbkNvbHVtbnMuZmluZChfID0+IF8gPT0gKGlkeCArIDEpKSkgY29scy5wdXNoKG5hbWUpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5kaXNwbGF5ZWRDb2x1bW5zID0gY29sczsgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuY29kZXMgPSBPYmplY3QodGhpcy5TbXBsUG9wdXBTZXJ2aWNlLmdldE1hc3RlckRhdGEodGhpcy5hcGlVcmwpKS5kYXRhO1xyXG4gICAgICAgIHRoaXMuY29kZXNIZWFkZXIgPSBPYmplY3QudmFsdWVzKE9iamVjdCh0aGlzLlNtcGxQb3B1cFNlcnZpY2UuZ2V0TWFzdGVyRGF0YSh0aGlzLmFwaVVybCkpLmhlYWRlcik7XHJcbiAgICAgICAgaWYgKHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlKSB7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5jb2Rlc0hlYWRlciA9IHRoaXMuY29kZXNIZWFkZXI7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS51bmNoYW5nZWFibGVDb2RlcyA9IHRoaXMuY29kZXM7XHJcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5jb2RlcyA9IHRoaXMuY29kZXM7XHJcbiAgICAgICAgICBpZiAoIXRoaXMucG9wdXBXaWR0aCAmJiBPYmplY3QudmFsdWVzKHRoaXMuY29kZXNbMF0pLmxlbmd0aCA+PSA0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXh0ZW5kV2lkdGggPSBTaEN0bENvbnN0LkRJQUxPR19NQVhfV0lEVEg7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBsZXQgY29scyA9IFtdO1xyXG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuZ2V0SGFzaEtleXMoKS5mb3JFYWNoKChuYW1lLCBpZHgpID0+IHtcclxuICAgICAgICAgICAgICBpZiAoIXRoaXMuaGlkZGVuQ29sdW1ucy5maW5kKF8gPT4gXyA9PSAoaWR4ICsgMSkpKSBjb2xzLnB1c2gobmFtZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmRpc3BsYXllZENvbHVtbnMgPSBjb2xzOyAgICBcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICBcclxufVxyXG4iXX0=