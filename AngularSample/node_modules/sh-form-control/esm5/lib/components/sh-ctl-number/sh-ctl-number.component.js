/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input } from '@angular/core';
import { SHCtlCommon } from '../sh-ctl-common';
import { SHFormControl } from '../../utilities/ShFormControl';
var SHCtlNumberComponent = /** @class */ (function (_super) {
    tslib_1.__extends(SHCtlNumberComponent, _super);
    function SHCtlNumberComponent() {
        var _this = _super.call(this) || this;
        _this.min = 0;
        _this.max = 99999999999;
        _this.decimaldigit = 0;
        _this.firstFlag = true;
        _this.ctlName = "SHCtlNumber";
        return _this;
    }
    /**
     * @return {?}
     */
    SHCtlNumberComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.onInit();
    };
    /**
     * @return {?}
     */
    SHCtlNumberComponent.prototype.ngAfterViewChecked = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var matInputElement = document.activeElement.classList.contains('mat-input-element');
        if (this.value && !matInputElement) {
            this.value = this.toText(this.value);
        }
    };
    /**
     * ngOnChangesイベント
     * 値変更時にフォーマットを整形
     * @param event input
     */
    /**
     * ngOnChangesイベント
     * 値変更時にフォーマットを整形
     * @param {?} changes
     * @return {?}
     */
    SHCtlNumberComponent.prototype.ngOnChanges = /**
     * ngOnChangesイベント
     * 値変更時にフォーマットを整形
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.value) {
            if (changes.value.currentValue) {
                if (changes.value.currentValue === '' || changes.value.currentValue === undefined || changes.value.currentValue === String(/[^\x01-\x7E\xA1-\xDF]+$/g)) {
                    this.value = '';
                    return;
                }
                if (parseFloat(changes.value.currentValue) < this.min) {
                    this.value = String(this.min);
                }
                if (parseFloat(changes.value.currentValue) > this.max) {
                    this.value = String(this.max);
                }
                this.stringValue = this.toText(changes.value.currentValue);
                this.value = parseFloat(parseFloat(changes.value.currentValue).toFixed(this.decimaldigit)).toString();
            }
        }
    };
    /**
     * onInput
     * @param event input
     */
    /**
     * onInput
     * @param {?} event input
     * @return {?}
     */
    SHCtlNumberComponent.prototype.onInput = /**
     * onInput
     * @param {?} event input
     * @return {?}
     */
    function (event) {
        SHCtlCommon.replaceHalfWidth(event);
        SHCtlCommon.replaceSpace(event);
        SHCtlCommon.replaceFUllSpace(event);
        SHCtlCommon.replaceSign(event, [",", "\.", "\-"]);
        //2文字目以降の「-」の入力を受け付けない
        if (event.target.value.length > 1)
            event.target.value = event.target.value.slice(0, 1) + event.target.value.slice(1).replace(/[\-]/g, "");
        SHCtlCommon.replaceFullWidth(event);
        this.checkNumbersSigns(event);
        if (event.inputType !== 'insertCompositionText') {
            SHCtlCommon.replaceSpace(event);
            SHCtlCommon.replaceFUllSpace(event);
            SHCtlCommon.replaceSign(event, [",", "\.", "\-"]);
            SHCtlCommon.replaceFullWidth(event);
            this.checkNumbersSigns(event);
        }
    };
    /**
     * マッチした値を記号に置き換える
     * @param event input
     */
    /**
     * マッチした値を記号に置き換える
     * @param {?} event input
     * @return {?}
     */
    SHCtlNumberComponent.prototype.checkNumbersSigns = /**
     * マッチした値を記号に置き換える
     * @param {?} event input
     * @return {?}
     */
    function (event) {
        event.target.value = event.target.value.replace(/^[\.|,]/g, "");
        event.target.value = event.target.value.replace(/[\.]{2,}/g, ".");
        event.target.value = event.target.value.replace(/[\,]{2,}/g, ",");
        event.target.value = event.target.value.replace(/[\-]{1,}/g, "-");
        if ((/\d.*\.\d.*/).test(event.target.value) && event.data === ".") {
            event.target.value = event.target.value.slice(0, event.target.value.length - 1);
        }
    };
    /**
     * 条件に沿うvalueを返す
     * @param event input
     */
    /**
     * 条件に沿うvalueを返す
     * @param {?} event input
     * @return {?}
     */
    SHCtlNumberComponent.prototype.checkMinus = /**
     * 条件に沿うvalueを返す
     * @param {?} event input
     * @return {?}
     */
    function (event) {
        return event.target.value.match(/\d/g) && event.data === "-";
    };
    /**
     * onClick
     * @param event click
     */
    /**
     * onClick
     * @param {?} event click
     * @return {?}
     */
    SHCtlNumberComponent.prototype.onClick = /**
     * onClick
     * @param {?} event click
     * @return {?}
     */
    function (event) {
        this.onBeforeClick(event);
        this.onAfterClick(event);
    };
    /**
     * onChange
     * @param event change
     */
    /**
     * onChange
     * @param {?} event change
     * @return {?}
     */
    SHCtlNumberComponent.prototype.onChange = /**
     * onChange
     * @param {?} event change
     * @return {?}
     */
    function (event) {
        var _this = this;
        this.onBeforeChange(event);
        //emitの直前にも値の精査を行う
        this.onInput(event);
        //onChange発火時に数値でなければクリアする
        if (isNaN(Number(event.target.value)) === true) {
            event.target.value = '';
            return;
        }
        //min maxの値を反映させる
        event.target.value = this.setMinMax(event.target.value);
        this.valueChange.emit(event.target.value);
        setTimeout((/**
         * @return {?}
         */
        function () { _this.onAfterChange(event); }), 0);
    };
    /**
     * onFocus
     * @param event focus
     */
    /**
     * onFocus
     * @param {?} event focus
     * @return {?}
     */
    SHCtlNumberComponent.prototype.onFocus = /**
     * onFocus
     * @param {?} event focus
     * @return {?}
     */
    function (event) {
        var _this = this;
        this.onBeforeFocus(event);
        event.target.value = this.removeComma(event.target.value);
        event.target.select();
        setTimeout((/**
         * @return {?}
         */
        function () { _this.onAfterFocus(event); }), 0);
    };
    /**
     * onBlur
     * @param event blur
     */
    /**
     * onBlur
     * @param {?} event blur
     * @return {?}
     */
    SHCtlNumberComponent.prototype.onBlur = /**
     * onBlur
     * @param {?} event blur
     * @return {?}
     */
    function (event) {
        var _this = this;
        //桁数指定で値を丸める
        this.onBeforeBlur(event);
        //カンマ区切り
        setTimeout((/**
         * @return {?}
         */
        function () {
            event.target.value = _this.toText(event.target.value);
        }), 100);
        setTimeout((/**
         * @return {?}
         */
        function () { _this.onAfterBlur(event); }), 0);
        ;
    };
    /**
     * カンマ付きの値を返す
     * @param inputTargetValue event.target.value
     */
    /**
     * カンマ付きの値を返す
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    SHCtlNumberComponent.prototype.toText = /**
     * カンマ付きの値を返す
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    function (inputTargetValue) {
        inputTargetValue = this.removeComma(inputTargetValue);
        if (!inputTargetValue)
            return null;
        if (isNaN(Number(inputTargetValue)))
            return null;
        //桁数指定で値を丸める
        /** @type {?} */
        var ret = parseFloat(parseFloat(inputTargetValue).toFixed(this.decimaldigit)).toString();
        return parseFloat(ret).toLocaleString(undefined, {
            minimumFractionDigits: this.decimaldigit,
            maximumFractionDigits: this.decimaldigit
        });
    };
    /**
     * min maxを反映した値を返す
     * @param inputTargetValue event.target.value
     */
    /**
     * min maxを反映した値を返す
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    SHCtlNumberComponent.prototype.setMinMax = /**
     * min maxを反映した値を返す
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    function (inputTargetValue) {
        if (!inputTargetValue)
            return "";
        if (isNaN(Number(inputTargetValue)))
            return "";
        if (parseFloat(inputTargetValue) < this.min) {
            inputTargetValue = this.min.toString();
        }
        if (parseFloat(inputTargetValue) > this.max) {
            inputTargetValue = this.max.toString();
        }
        inputTargetValue = parseFloat(parseFloat(inputTargetValue).toFixed(this.decimaldigit)).toString();
        return inputTargetValue;
    };
    /**
     * カンマを外した値を返す
     * @param inputTargetValue event.target.value
     */
    /**
     * カンマを外した値を返す
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    SHCtlNumberComponent.prototype.removeComma = /**
     * カンマを外した値を返す
     * @param {?} inputTargetValue event.target.value
     * @return {?}
     */
    function (inputTargetValue) {
        inputTargetValue = new String(inputTargetValue).replace(/,/g, "");
        return inputTargetValue;
    };
    SHCtlNumberComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sh-ctl-number',
                    template: "<ng-container *ngIf=\"!onlyField; else onlyFieldControl\">\r\n  <div *ngIf=\"!isDisabled\" (focusin)=\"onFocusin($event)\" (focusout)=\"onFocusout($event)\">\r\n    <mat-form-field class=\"mat-validation\" [floatLabel]=\"floatLabel\">\r\n      <input #inputElm matInput [required]=\"required\" [placeholder]=\"title\" (focus)=\"onFocus($event)\"\r\n        [(ngModel)]=\"value\" attr.name=\"{{ctlName}}\" class=\"form-control can-moved-with-the-enter-key {{strClass}}\"\r\n        value=\"\" style=\"text-align: right; \" (input)=\"onInput($event)\" (click)=\"onClick($event)\"\r\n        (change)=\"onChange($event)\" [disabled]=\"disabled\" [ngStyle]=\"styles\" [ngClass]=\"objClass\" />\r\n      <button mat-button *ngIf=\"inputElm.value && !inputElm.readOnly && !inputElm.disabled\" matSuffix mat-icon-button\r\n        aria-label=\"Clear\" (mousedown)=\"clearValue()\" (keydown)=\"clickClearButton($event)\">\r\n        <mat-icon>close</mat-icon>\r\n      </button>\r\n    </mat-form-field>\r\n    <span class=\"custom-alert-message\">{{message.toString().split(',').join(' ')}}</span>\r\n  </div>\r\n</ng-container>\r\n\r\n<ng-template #onlyFieldControl>\r\n  <div class=\"only-field\" (focusin)=\"onFocusin($event)\" (focusout)=\"onFocusout($event)\">\r\n    <input #inputElm matInput [required]=\"required\" (focus)=\"onFocus($event)\"\r\n      [(ngModel)]=\"value\" attr.name=\"{{ctlName}}\" class=\"form-control can-moved-with-the-enter-key {{strClass}}\"\r\n      value=\"\" style=\"text-align: right; \" (input)=\"onInput($event)\" (click)=\"onClick($event)\"\r\n      (change)=\"onChange($event)\" [disabled]=\"disabled\" [ngStyle]=\"styles\" [ngClass]=\"objClass\" />\r\n    <button mat-button *ngIf=\"inputElm.value && !inputElm.readOnly && !inputElm.disabled\" matSuffix mat-icon-button\r\n      aria-label=\"Clear\" (mousedown)=\"clearValue()\" (keydown)=\"clickClearButton($event)\">\r\n      <mat-icon>close</mat-icon>\r\n    </button>\r\n  </div>\r\n</ng-template>\r\n\r\n<div *ngIf=\"isDisabled\" class=\"display-ctl-view\">\r\n  <div>\r\n    <div *ngIf=\"title\" class=\"display-ctl-view\">\r\n      <div class=\"display-result\" [ngStyle]=\"{'width.px': labelWidth}\" fxLayout=\"row wrap\" fxFlex>\r\n        <div fxFlex class=\"item-title\"><strong>{{title}}:</strong></div>\r\n      </div>\r\n      <div fxFlex class=\"valueOutput\">\r\n        {{stringValue}}\r\n      </div>\r\n    </div>\r\n\r\n    <div *ngIf=\"!title\" class=\"display-ctl-view notitle-value\">\r\n      <div fxFlex class=\"valueOutput\">\r\n        {{stringValue}}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
                    styles: [".item-title{margin-left:.5%;margin-right:25%}.display-ctl-view{display:-webkit-box;display:flex}.display-result{display:-webkit-box;display:flex;margin-left:30px}.valueOutput{-webkit-box-flex:1;flex:1;padding-top:4px}.validation-error::ng-deep .mat-form-field-label{color:red}.validation-error::ng-deep .mat-form-field-underline{background-color:red}.notitle-value{width:100%;margin-left:30px}", ".sh-flex{width:100%;display:-webkit-inline-box;display:inline-flex}.sh-flex-center{-webkit-box-align:center;align-items:center}.sh-flex-between{-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:center;align-items:center}.display-ctl-view{margin-top:20px}.overlay{position:fixed;display:-webkit-box;display:flex;top:0;left:0;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;height:100%;width:100%;color:gray;background-color:rgba(0,0,0,.5);z-index:9999}.loader-text{display:block;color:#f3f3f3;margin-top:1em}.mat-dialog-content{overflow:hidden;max-height:none}.sh-dialog-content{height:85%}.sh-kbn-dialog-table-container{height:92%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-dialog-table-container{display:-webkit-box;display:flex;height:83%;overflow-y:scroll;margin-top:18px;margin-bottom:18px}.sh-text-center{text-align:center}.sh-width-100{width:100%}.sh-label{display:block}.custom-alert-message{top:-20px;position:relative;font-size:.75em;color:rgba(0,0,0,.54)}.result-input,.sh-label{color:rgba(0,0,0,.87)}::ng-deep .mat-form-field-label span{color:rgba(0,0,0,.87)}::ng-deep .result-container .mat-form-field-flex{background-color:#ccdcff}.sh-ctl-state-primary::ng-deep .mat-form-field-label{color:#3f51b5}.sh-ctl-state-primary::ng-deep .mat-form-field-underline{background-color:#3f51b5}.sh-ctl-state-primary-message{color:#3f51b5}.sh-ctl-state-secondary::ng-deep .mat-form-field-label{color:#ff4081}.sh-ctl-state-secondary::ng-deep .mat-form-field-underline{background-color:#ff4081}.sh-ctl-state-secondary-message{color:#ff4081}.sh-ctl-state-success::ng-deep .mat-form-field-label{color:#0dad17}.sh-ctl-state-success::ng-deep .mat-form-field-underline{background-color:#0dad17}.sh-ctl-state-success-message{color:#0dad17}.sh-ctl-state-danger::ng-deep .mat-form-field-label{color:#f44336}.sh-ctl-state-danger::ng-deep .mat-form-field-underline{background-color:#f44336}.sh-ctl-state-danger-message{color:#f44336}.sh-ctl-state-warning::ng-deep .mat-form-field-label{color:#e29f2b}.sh-ctl-state-warning::ng-deep .mat-form-field-underline{background-color:#e29f2b}.sh-ctl-state-warning-message{color:#e29f2b}.sh-container{position:relative;width:100%;height:100%}.only-field{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;width:100%;height:100%;min-height:28px}.only-field input,.only-field textarea{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.only-field-danger{background-color:#f44336}.only-field-warning{background-color:#e29f2b}.only-field-success{background-color:#0dad17}::ng-deep .only-field .material-icons{font-size:13px}::ng-deep .only-field .mat-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon-button{position:relative;width:24px;height:24px}::ng-deep .only-field .mat-icon{position:absolute;top:0;left:0}::ng-deep .only-field .mat-datepicker-toggle-default-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;margin-right:auto}::ng-deep .mat-datepicker-toggle span svg{width:16px;height:16px}.only-label{background-color:#ccdcff;position:relative}.only-label mat-icon{position:absolute;top:25%;left:0;right:0;bottom:0;margin-left:auto;font-size:16px}.bind-flg__input{opacity:0;height:0;width:0;position:absolute;z-index:-100}"]
                }] }
    ];
    /** @nocollapse */
    SHCtlNumberComponent.ctorParameters = function () { return []; };
    SHCtlNumberComponent.propDecorators = {
        min: [{ type: Input }],
        max: [{ type: Input }],
        decimaldigit: [{ type: Input }]
    };
    return SHCtlNumberComponent;
}(SHFormControl));
export { SHCtlNumberComponent };
if (false) {
    /** @type {?} */
    SHCtlNumberComponent.prototype.min;
    /** @type {?} */
    SHCtlNumberComponent.prototype.max;
    /** @type {?} */
    SHCtlNumberComponent.prototype.decimaldigit;
    /** @type {?} */
    SHCtlNumberComponent.prototype.stringValue;
    /** @type {?} */
    SHCtlNumberComponent.prototype.firstFlag;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtY3RsLW51bWJlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9zaC1mb3JtLWNvbnRyb2wvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9zaC1jdGwtbnVtYmVyL3NoLWN0bC1udW1iZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBcUIsS0FBSyxFQUFtQyxNQUFNLGVBQWUsQ0FBQztBQUNyRyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLCtCQUErQixDQUFBO0FBRTdEO0lBSzBDLGdEQUFxQjtJQU83RDtRQUFBLFlBQ0UsaUJBQU8sU0FFUjtRQVRlLFNBQUcsR0FBVyxDQUFDLENBQUM7UUFDaEIsU0FBRyxHQUFXLFdBQVcsQ0FBQztRQUMxQixrQkFBWSxHQUFXLENBQUMsQ0FBQztRQUVsQyxlQUFTLEdBQVksSUFBSSxDQUFDO1FBSS9CLEtBQUksQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDOztJQUMvQixDQUFDOzs7O0lBRU0sdUNBQVE7OztJQUFmO1FBQ0UsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2hCLENBQUM7Ozs7SUFFRCxpREFBa0I7OztJQUFsQjs7WUFDTSxlQUFlLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDO1FBQ3BGLElBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3RDO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7Ozs7Ozs7SUFDSSwwQ0FBVzs7Ozs7O0lBQWxCLFVBQW1CLE9BQXNCO1FBQ3ZDLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRTtZQUNqQixJQUFJ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b21wb25lbnQsIE9uSW5pdCwgT25DaGFuZ2VzLCBJbnB1dCwgU2ltcGxlQ2hhbmdlcywgQWZ0ZXJWaWV3Q2hlY2tlZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBTSEN0bENvbW1vbiB9IGZyb20gJy4uL3NoLWN0bC1jb21tb24nO1xyXG5pbXBvcnQgeyBTSEZvcm1Db250cm9sIH0gZnJvbSAnLi4vLi4vdXRpbGl0aWVzL1NoRm9ybUNvbnRyb2wnXHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ3NoLWN0bC1udW1iZXInLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9zaC1jdGwtbnVtYmVyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9zaC1jdGwtbnVtYmVyLmNvbXBvbmVudC5jc3MnLCAnLi4vLi4vLi4vc3R5bGUuY29tbW9uLmNzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTSEN0bE51bWJlckNvbXBvbmVudCBleHRlbmRzIFNIRm9ybUNvbnRyb2w8c3RyaW5nPiBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdDaGVja2VkIHtcclxuICBASW5wdXQoKSBwdWJsaWMgbWluOiBudW1iZXIgPSAwO1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBtYXg6IG51bWJlciA9IDk5OTk5OTk5OTk5O1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBkZWNpbWFsZGlnaXQ6IG51bWJlciA9IDA7XHJcbiAgcHVibGljIHN0cmluZ1ZhbHVlOiBhbnk7XHJcbiAgcHVibGljIGZpcnN0RmxhZzogYm9vbGVhbiA9IHRydWU7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuY3RsTmFtZSA9IFwiU0hDdGxOdW1iZXJcIjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMub25Jbml0KCk7XHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0NoZWNrZWQoKSB7XHJcbiAgICBsZXQgbWF0SW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ21hdC1pbnB1dC1lbGVtZW50Jyk7XHJcbiAgICBpZih0aGlzLnZhbHVlICYmICFtYXRJbnB1dEVsZW1lbnQpIHtcclxuICAgICAgdGhpcy52YWx1ZSA9IHRoaXMudG9UZXh0KHRoaXMudmFsdWUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbmdPbkNoYW5nZXPjgqTjg5njg7Pjg4hcclxuICAgKiDlgKTlpInmm7TmmYLjgavjg5Xjgqnjg7zjg57jg4Pjg4jjgpLmlbTlvaJcclxuICAgKiBAcGFyYW0gZXZlbnQgaW5wdXRcclxuICAgKi9cclxuICBwdWJsaWMgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xyXG4gICAgaWYgKGNoYW5nZXMudmFsdWUpIHtcclxuICAgICAgaWYgKGNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlKSB7XHJcbiAgICAgICAgaWYgKGNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlID09PSAnJyB8fCBjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSA9PT0gdW5kZWZpbmVkIHx8IGNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlID09PSBTdHJpbmcoL1teXFx4MDEtXFx4N0VcXHhBMS1cXHhERl0rJC9nKSkge1xyXG4gICAgICAgICAgdGhpcy52YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocGFyc2VGbG9hdChjaGFuZ2VzLnZhbHVlLmN1cnJlbnRWYWx1ZSkgPCB0aGlzLm1pbikge1xyXG4gICAgICAgICAgdGhpcy52YWx1ZSA9IFN0cmluZyh0aGlzLm1pbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXJzZUZsb2F0KGNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlKSA+IHRoaXMubWF4KSB7XHJcbiAgICAgICAgICB0aGlzLnZhbHVlID0gU3RyaW5nKHRoaXMubWF4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdHJpbmdWYWx1ZSA9IHRoaXMudG9UZXh0KGNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlKTtcclxuICAgICAgICB0aGlzLnZhbHVlID0gcGFyc2VGbG9hdChwYXJzZUZsb2F0KGNoYW5nZXMudmFsdWUuY3VycmVudFZhbHVlKS50b0ZpeGVkKHRoaXMuZGVjaW1hbGRpZ2l0KSkudG9TdHJpbmcoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25JbnB1dFxyXG4gICAqIEBwYXJhbSBldmVudCBpbnB1dFxyXG4gICAqL1xyXG4gIHB1YmxpYyBvbklucHV0KGV2ZW50OiBhbnkpIHtcclxuICAgIFNIQ3RsQ29tbW9uLnJlcGxhY2VIYWxmV2lkdGgoZXZlbnQpO1xyXG4gICAgU0hDdGxDb21tb24ucmVwbGFjZVNwYWNlKGV2ZW50KTtcclxuICAgIFNIQ3RsQ29tbW9uLnJlcGxhY2VGVWxsU3BhY2UoZXZlbnQpO1xyXG4gICAgU0hDdGxDb21tb24ucmVwbGFjZVNpZ24oZXZlbnQsIFtcIixcIiwgXCJcXC5cIiwgXCJcXC1cIl0pO1xyXG4gICAgLy8y5paH5a2X55uu5Lul6ZmN44Gu44CMLeOAjeOBruWFpeWKm+OCkuWPl+OBkeS7mOOBkeOBquOBhFxyXG4gICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZS5sZW5ndGggPiAxKVxyXG4gICAgICBldmVudC50YXJnZXQudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWUuc2xpY2UoMCwgMSkgKyBldmVudC50YXJnZXQudmFsdWUuc2xpY2UoMSkucmVwbGFjZSgvW1xcLV0vZywgXCJcIik7XHJcbiAgICBTSEN0bENvbW1vbi5yZXBsYWNlRnVsbFdpZHRoKGV2ZW50KTtcclxuICAgIHRoaXMuY2hlY2tOdW1iZXJzU2lnbnMoZXZlbnQpO1xyXG4gICAgaWYgKGV2ZW50LmlucHV0VHlwZSAhPT0gJ2luc2VydENvbXBvc2l0aW9uVGV4dCcpIHsgIFxyXG4gICAgICBTSEN0bENvbW1vbi5yZXBsYWNlU3BhY2UoZXZlbnQpO1xyXG4gICAgICBTSEN0bENvbW1vbi5yZXBsYWNlRlVsbFNwYWNlKGV2ZW50KTtcclxuICAgICAgU0hDdGxDb21tb24ucmVwbGFjZVNpZ24oZXZlbnQsIFtcIixcIiwgXCJcXC5cIiwgXCJcXC1cIl0pO1xyXG4gICAgICBTSEN0bENvbW1vbi5yZXBsYWNlRnVsbFdpZHRoKGV2ZW50KTtcclxuICAgICAgdGhpcy5jaGVja051bWJlcnNTaWducyhldmVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDjg57jg4Pjg4HjgZfjgZ/lgKTjgpLoqJjlj7fjgavnva7jgY3mj5vjgYjjgotcclxuICAgKiBAcGFyYW0gZXZlbnQgaW5wdXRcclxuICAgKi9cclxuICBwdWJsaWMgY2hlY2tOdW1iZXJzU2lnbnMoZXZlbnQ6IGFueSkge1xyXG4gICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnJlcGxhY2UoL15bXFwufCxdL2csIFwiXCIpO1xyXG4gICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlLnJlcGxhY2UoL1tcXC5dezIsfS9nLCBcIi5cIik7XHJcbiAgICBldmVudC50YXJnZXQudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWUucmVwbGFjZSgvW1xcLF17Mix9L2csIFwiLFwiKTtcclxuICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZS5yZXBsYWNlKC9bXFwtXXsxLH0vZywgXCItXCIpO1xyXG4gICAgaWYgKCgvXFxkLipcXC5cXGQuKi8pLnRlc3QoZXZlbnQudGFyZ2V0LnZhbHVlKSAmJiBldmVudC5kYXRhID09PSBcIi5cIikge1xyXG4gICAgICBldmVudC50YXJnZXQudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWUuc2xpY2UoMCwgZXZlbnQudGFyZ2V0LnZhbHVlLmxlbmd0aCAtIDEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5p2h5Lu244Gr5rK/44GGdmFsdWXjgpLov5TjgZlcclxuICAgKiBAcGFyYW0gZXZlbnQgaW5wdXRcclxuICAgKi9cclxuICBwdWJsaWMgY2hlY2tNaW51cyhldmVudDogYW55KSB7XHJcbiAgICByZXR1cm4gZXZlbnQudGFyZ2V0LnZhbHVlLm1hdGNoKC9cXGQvZykgJiYgZXZlbnQuZGF0YSA9PT0gXCItXCI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBvbkNsaWNrXHJcbiAgICogQHBhcmFtIGV2ZW50IGNsaWNrXHJcbiAgICovXHJcbiAgcHVibGljIG9uQ2xpY2soZXZlbnQpIHtcclxuICAgIHRoaXMub25CZWZvcmVDbGljayhldmVudCk7XHJcblxyXG4gICAgdGhpcy5vbkFmdGVyQ2xpY2soZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb25DaGFuZ2VcclxuICAgKiBAcGFyYW0gZXZlbnQgY2hhbmdlXHJcbiAgICovXHJcbiAgcHVibGljIG9uQ2hhbmdlKGV2ZW50KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlQ2hhbmdlKGV2ZW50KTtcclxuXHJcbiAgICAvL2VtaXTjga7nm7TliY3jgavjgoLlgKTjga7nsr7mn7vjgpLooYzjgYZcclxuICAgIHRoaXMub25JbnB1dChldmVudCk7XHJcblxyXG4gICAgLy9vbkNoYW5nZeeZuueBq+aZguOBq+aVsOWApOOBp+OBquOBkeOCjOOBsOOCr+ODquOCouOBmeOCi1xyXG4gICAgaWYgKGlzTmFOKE51bWJlcihldmVudC50YXJnZXQudmFsdWUpKSA9PT0gdHJ1ZSkge1xyXG4gICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJztcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vbWluIG1heOOBruWApOOCkuWPjeaYoOOBleOBm+OCi1xyXG4gICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gdGhpcy5zZXRNaW5NYXgoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdChldmVudC50YXJnZXQudmFsdWUpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge3RoaXMub25BZnRlckNoYW5nZShldmVudCl9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uRm9jdXNcclxuICAgKiBAcGFyYW0gZXZlbnQgZm9jdXNcclxuICAgKi9cclxuICBwdWJsaWMgb25Gb2N1cyhldmVudDogYW55KSB7XHJcbiAgICB0aGlzLm9uQmVmb3JlRm9jdXMoZXZlbnQpO1xyXG5cclxuICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IHRoaXMucmVtb3ZlQ29tbWEoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgIGV2ZW50LnRhcmdldC5zZWxlY3QoKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHt0aGlzLm9uQWZ0ZXJGb2N1cyhldmVudCl9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIG9uQmx1clxyXG4gICAqIEBwYXJhbSBldmVudCBibHVyXHJcbiAgICovXHJcbiAgcHVibGljIG9uQmx1cihldmVudDogYW55KSB7XHJcbiAgICAvL+ahgeaVsOaMh+WumuOBp+WApOOCkuS4uOOCgeOCi1xyXG4gICAgdGhpcy5vbkJlZm9yZUJsdXIoZXZlbnQpO1xyXG4gICAgXHJcbiAgICAvL+OCq+ODs+ODnuWMuuWIh+OCilxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9IHRoaXMudG9UZXh0KGV2ZW50LnRhcmdldC52YWx1ZSk7XHJcbiAgICB9LCAxMDApO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge3RoaXMub25BZnRlckJsdXIoZXZlbnQpO30sIDApOztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOOCq+ODs+ODnuS7mOOBjeOBruWApOOCkui/lOOBmVxyXG4gICAqIEBwYXJhbSBpbnB1dFRhcmdldFZhbHVlIGV2ZW50LnRhcmdldC52YWx1ZVxyXG4gICAqL1xyXG4gIHB1YmxpYyB0b1RleHQoaW5wdXRUYXJnZXRWYWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlucHV0VGFyZ2V0VmFsdWUgPSB0aGlzLnJlbW92ZUNvbW1hKGlucHV0VGFyZ2V0VmFsdWUpXHJcbiAgICBpZiAoIWlucHV0VGFyZ2V0VmFsdWUpIHJldHVybiBudWxsO1xyXG4gICAgaWYgKGlzTmFOKE51bWJlcihpbnB1dFRhcmdldFZhbHVlKSkpIHJldHVybiBudWxsO1xyXG4gICAgLy/moYHmlbDmjIflrprjgaflgKTjgpLkuLjjgoHjgotcclxuICAgIGxldCByZXQgPSAgcGFyc2VGbG9hdChwYXJzZUZsb2F0KGlucHV0VGFyZ2V0VmFsdWUpLnRvRml4ZWQodGhpcy5kZWNpbWFsZGlnaXQpKS50b1N0cmluZygpO1xyXG4gICAgcmV0dXJuIHBhcnNlRmxvYXQocmV0KS50b0xvY2FsZVN0cmluZyh1bmRlZmluZWQsIHtcclxuICAgICAgbWluaW11bUZyYWN0aW9uRGlnaXRzOiB0aGlzLmRlY2ltYWxkaWdpdCxcclxuICAgICAgbWF4aW11bUZyYWN0aW9uRGlnaXRzOiB0aGlzLmRlY2ltYWxkaWdpdFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBtaW4gbWF444KS5Y+N5pig44GX44Gf5YCk44KS6L+U44GZXHJcbiAgICogQHBhcmFtIGlucHV0VGFyZ2V0VmFsdWUgZXZlbnQudGFyZ2V0LnZhbHVlXHJcbiAgICovXHJcbiAgcHVibGljIHNldE1pbk1heChpbnB1dFRhcmdldFZhbHVlOiBzdHJpbmcpIHtcclxuICAgIGlmICghaW5wdXRUYXJnZXRWYWx1ZSkgcmV0dXJuIFwiXCI7XHJcbiAgICBpZiAoaXNOYU4oTnVtYmVyKGlucHV0VGFyZ2V0VmFsdWUpKSkgcmV0dXJuIFwiXCI7XHJcbiAgICBpZiAocGFyc2VGbG9hdChpbnB1dFRhcmdldFZhbHVlKSA8IHRoaXMubWluKSB7XHJcbiAgICAgIGlucHV0VGFyZ2V0VmFsdWUgPSB0aGlzLm1pbi50b1N0cmluZygpO1xyXG4gICAgfVxyXG4gICAgaWYgKHBhcnNlRmxvYXQoaW5wdXRUYXJnZXRWYWx1ZSkgPiB0aGlzLm1heCkge1xyXG4gICAgICBpbnB1dFRhcmdldFZhbHVlID0gdGhpcy5tYXgudG9TdHJpbmcoKTtcclxuICAgIH1cclxuICAgIGlucHV0VGFyZ2V0VmFsdWUgPSAgcGFyc2VGbG9hdChwYXJzZUZsb2F0KGlucHV0VGFyZ2V0VmFsdWUpLnRvRml4ZWQodGhpcy5kZWNpbWFsZGlnaXQpKS50b1N0cmluZygpO1xyXG4gICAgcmV0dXJuIGlucHV0VGFyZ2V0VmFsdWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDjgqvjg7Pjg57jgpLlpJbjgZfjgZ/lgKTjgpLov5TjgZlcclxuICAgKiBAcGFyYW0gaW5wdXRUYXJnZXRWYWx1ZSBldmVudC50YXJnZXQudmFsdWVcclxuICAgKi9cclxuICBwdWJsaWMgcmVtb3ZlQ29tbWEoaW5wdXRUYXJnZXRWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICBpbnB1dFRhcmdldFZhbHVlID0gbmV3IFN0cmluZyhpbnB1dFRhcmdldFZhbHVlKS5yZXBsYWNlKC8sL2csIFwiXCIpO1xyXG4gICAgcmV0dXJuIGlucHV0VGFyZ2V0VmFsdWU7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=