/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ShCtlConst } from "../constShCtl";
import { ShHttpClientConst } from 'sh-http-client';
/**
 * キー制御の初期化など
 */
var /**
 * キー制御の初期化など
 */
ShAppComponent = /** @class */ (function () {
    /**
     * コンストラクタ
     */
    function ShAppComponent(redirectService) {
        this.redirectService = redirectService;
        this.init();
    }
    /**
     * コンポーネント初期化
     */
    /**
     * コンポーネント初期化
     * @return {?}
     */
    ShAppComponent.prototype.ngOnInit = /**
     * コンポーネント初期化
     * @return {?}
     */
    function () { };
    /**
     * 初期化
     */
    /**
     * 初期化
     * @private
     * @return {?}
     */
    ShAppComponent.prototype.init = /**
     * 初期化
     * @private
     * @return {?}
     */
    function () {
        this.redirect();
        this.keyValidation();
        this.setToekn();
    };
    /**
     * @private
     * @return {?}
     */
    ShAppComponent.prototype.redirect = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.redirectService.redirectPath) {
            this.redirectService.redirect();
        }
    };
    /**
     * @private
     * @return {?}
     */
    ShAppComponent.prototype.setToekn = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var params = new URLSearchParams(location.search);
        /** @type {?} */
        var token = params.get('access_token');
        if (token) {
            sessionStorage.setItem("" + ShHttpClientConst.AUTHORIZATION_TOKEN, token);
            params.delete("access_token");
            history.pushState(null, null, location.pathname);
        }
    };
    /**
     *@ エンター時にフォーカスを当てたくない場合の条件
     */
    /**
     * \@ エンター時にフォーカスを当てたくない場合の条件
     * @private
     * @param {?} elm
     * @return {?}
     */
    ShAppComponent.prototype.isTargetElement = /**
     * \@ エンター時にフォーカスを当てたくない場合の条件
     * @private
     * @param {?} elm
     * @return {?}
     */
    function (elm) {
        if (elm.type == 'hidden')
            return false;
        if (elm.style.display == 'none')
            return false;
        if (elm.style.opacity == '0')
            return false;
        if (elm.disabled)
            return false;
        /** @type {?} */
        var shctl = this.getShCtlElement(elm);
        if (this.checkShCtlAttr(shctl.attributes, [
            'hidden'
        ]))
            return false;
        return true;
    };
    /**
     * @private
     * @param {?} map
     * @param {?} targets
     * @return {?}
     */
    ShAppComponent.prototype.checkShCtlAttr = /**
     * @private
     * @param {?} map
     * @param {?} targets
     * @return {?}
     */
    function (map, targets) {
        return targets.map((/**
         * @param {?} t
         * @return {?}
         */
        function (t) {
            return map.getNamedItem(t) != null;
        })).includes(true);
    };
    /**
     * @private
     * @param {?} elm
     * @return {?}
     */
    ShAppComponent.prototype.getShCtlElement = /**
     * @private
     * @param {?} elm
     * @return {?}
     */
    function (elm) {
        /** @type {?} */
        var parent = elm.parentElement;
        if (!parent)
            return null;
        if (parent.tagName.includes('SH-CTL')) {
            return parent;
        }
        else {
            return this.getShCtlElement(parent);
        }
    };
    /**
     * キーバリデーション付与
     */
    /**
     * キーバリデーション付与
     * @return {?}
     */
    ShAppComponent.prototype.keyValidation = /**
     * キーバリデーション付与
     * @return {?}
     */
    function () {
        var _this = this;
        window.document.onkeydown = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            if (event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F1 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F2 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F3 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F4 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F5 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F6 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F10 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F11 ||
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_F12) {
                return false;
            }
            if (event.altKey &&
                (event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_LEFT ||
                    event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_RIGHT)) {
                return false;
            }
            if ((event.ctrlKey || event.metaKey) &&
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_N) {
                return false;
            }
            if ((event.ctrlKey || event.metaKey) &&
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_R) {
                return false;
            }
            if ((event.ctrlKey || event.metaKey) &&
                event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_D) {
                return false;
            }
            if (event.keyCode === ShCtlConst.ORDINAL.KEYS.KEY_ENTER) {
                /** @type {?} */
                var input = (/** @type {?} */ (document.activeElement));
                if (input != null) {
                    if (input.type != 'textarea') {
                        //次の操作可能なタグに切り替える
                        /** @type {?} */
                        var nodeList = window.document.querySelectorAll('.can-moved-with-the-enter-key');
                        /** @type {?} */
                        var filteredInput = Array.from(nodeList).filter((/**
                         * @param {?} el
                         * @return {?}
                         */
                        function (el) {
                            return _this.isTargetElement((/** @type {?} */ (el)));
                        }));
                        /** @type {?} */
                        var preInput = null;
                        for (var i = 0; i < filteredInput.length; i++) {
                            /** @type {?} */
                            var cur_input = (/** @type {?} */ (filteredInput[i]));
                            if (input.name === cur_input.name) {
                                if (++i >= filteredInput.length) {
                                    i = 0;
                                }
                                cur_input.blur();
                                if (event.shiftKey) {
                                    preInput.focus();
                                }
                                else {
                                    /** @type {?} */
                                    var nextInput = (/** @type {?} */ (filteredInput[i]));
                                    nextInput.focus();
                                }
                                return false;
                            }
                            preInput = (/** @type {?} */ (filteredInput[i]));
                        }
                    }
                }
            }
        });
    };
    return ShAppComponent;
}());
/**
 * キー制御の初期化など
 */
export { ShAppComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ShAppComponent.prototype.redirectService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2gtYXBwLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NoLWZvcm0tY29udHJvbC8iLCJzb3VyY2VzIjpbImxpYi91dGlsaXRpZXMvc2gtYXBwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsaUJBQWlCLEVBQXFCLE1BQU0sZ0JBQWdCLENBQUM7Ozs7QUFLdEU7Ozs7SUFFRTs7T0FFRztJQUNILHdCQUNVLGVBQWtDO1FBQWxDLG9CQUFlLEdBQWYsZUFBZSxDQUFtQjtRQUUxQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0gsaUNBQVE7Ozs7SUFBUixjQUFZLENBQUM7SUFDYjs7T0FFRzs7Ozs7O0lBQ0ssNkJBQUk7Ozs7O0lBQVo7UUFDRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQixDQUFDOzs7OztJQUNPLGlDQUFROzs7O0lBQWhCO1FBQ0UsSUFBRyxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRTtZQUNwQyxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ2pDO0lBQ0gsQ0FBQzs7Ozs7SUFDTyxpQ0FBUTs7OztJQUFoQjs7WUFDUSxNQUFNLEdBQUcsSUFBSSxlQUFlLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQzs7WUFDN0MsS0FBSyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDO1FBQ3hDLElBQUcsS0FBSyxFQUFDO1lBQ1AsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFHLGlCQUFpQixDQUFDLG1CQUFxQixFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQ3pFLE1BQU0sQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFD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QUMsbUJBQUEsRUFBRSxFQUFvQixDQUFDLENBQUE7d0JBQ3JELENBQUMsRUFBQzs7NEJBQ0UsUUFBUSxHQUFHLElBQUk7d0JBQ25CLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFOztnQ0FDekMsU0FBUyxHQUFHLG1CQUFrQixhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUE7NEJBQ2xELElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsSUFBSSxFQUFFO2dDQUNqQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxNQUFNLEVBQUU7b0NBQy9CLENBQUMsR0FBRyxDQUFDLENBQUM7aUNBQ1A7Z0NBQ0QsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO2dDQUNqQixJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUU7b0NBQ2xCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztpQ0FDbEI7cUNBQ0k7O3dDQUNDLFNBQVMsR0FBRyxtQkFBa0IsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFBO29DQUNsRCxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7aUNBQ25CO2dDQUNELE9BQU8sS0FBSyxDQUFDOzZCQUNkOzRCQUNELFFBQVEsR0FBRyxtQkFBa0IsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFBLENBQUM7eUJBQy9DO3FCQUNGO2lCQUNGO2FBQ0Y7UUFDSCxDQUFDLENBQUEsQ0FBQztJQUNKLENBQUM7SUFDSCxxQkFBQztBQUFELENBQUMsQUFsSkQsSUFrSkM7Ozs7Ozs7Ozs7SUE1SUcseUNBQTBDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT25Jbml0LCBDb21wb25lbnQsIENvbXBvbmVudFJlZn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcclxuaW1wb3J0IHsgU2hDdGxDb25zdCB9IGZyb20gXCIuLi9jb25zdFNoQ3RsXCI7XHJcbmltcG9ydCB7IFNoSHR0cENsaWVudENvbnN0LCBTaFJlZGlyZWN0U2VydmljZSB9IGZyb20gJ3NoLWh0dHAtY2xpZW50JztcclxuXHJcbi8qKlxyXG4gKiDjgq3jg7zliLblvqHjga7liJ3mnJ/ljJbjgarjgalcclxuICovXHJcbmV4cG9ydCBjbGFzcyBTaEFwcENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIC8qKlxyXG4gICAqIOOCs+ODs+OCueODiOODqeOCr+OCv1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSByZWRpcmVjdFNlcnZpY2U6IFNoUmVkaXJlY3RTZXJ2aWNlXHJcbiAgKSB7XHJcbiAgICB0aGlzLmluaXQoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOOCs+ODs+ODneODvOODjeODs+ODiOWIneacn+WMllxyXG4gICAqL1xyXG4gIG5nT25Jbml0KCkge31cclxuICAvKipcclxuICAgKiDliJ3mnJ/ljJZcclxuICAgKi9cclxuICBwcml2YXRlIGluaXQoKSB7XHJcbiAgICB0aGlzLnJlZGlyZWN0KCk7XHJcbiAgICB0aGlzLmtleVZhbGlkYXRpb24oKTtcclxuICAgIHRoaXMuc2V0VG9la24oKTtcclxuICB9XHJcbiAgcHJpdmF0ZSByZWRpcmVjdCgpIHtcclxuICAgIGlmKHRoaXMucmVkaXJlY3RTZXJ2aWNlLnJlZGlyZWN0UGF0aCkge1xyXG4gICAgICB0aGlzLnJlZGlyZWN0U2VydmljZS5yZWRpcmVjdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIHNldFRvZWtuKCl7XHJcbiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uLnNlYXJjaCk7XHJcbiAgICBjb25zdCB0b2tlbiA9IHBhcmFtcy5nZXQoJ2FjY2Vzc190b2tlbicpXHJcbiAgICBpZih0b2tlbil7XHJcbiAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oYCR7U2hIdHRwQ2xpZW50Q29uc3QuQVVUSE9SSVpBVElPTl9UT0tFTn1gLCB0b2tlbilcclxuICAgICAgcGFyYW1zLmRlbGV0ZShcImFjY2Vzc190b2tlblwiKTtcclxuICAgICAgaGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgbG9jYXRpb24ucGF0aG5hbWUpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvKipcclxuICAgKkAg44Ko44Oz44K/44O85pmC44Gr44OV44Kp44O844Kr44K544KS5b2T44Gm44Gf44GP44Gq44GE5aC05ZCI44Gu5p2h5Lu2XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpc1RhcmdldEVsZW1lbnQoZWxtOiBIVE1MSW5wdXRFbGVtZW50KSB7XHJcbiAgICBpZihlbG0udHlwZSA9PSAnaGlkZGVuJykgcmV0dXJuIGZhbHNlO1xyXG4gICAgaWYoZWxtLnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSByZXR1cm4gZmFsc2U7XHJcbiAgICBpZihlbG0uc3R5bGUub3BhY2l0eSA9PSAnMCcpIHJldHVybiBmYWxzZTtcclxuICAgIGlmKGVsbS5kaXNhYmxlZCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgY29uc3Qgc2hjdGwgPSAgdGhpcy5nZXRTaEN0bEVsZW1lbnQoZWxtKTtcclxuICAgIGlmKHRoaXMuY2hlY2tTaEN0bEF0dHIoc2hjdGwuYXR0cmlidXRlcyxbXHJcbiAgICAgICdoaWRkZW4nXHJcbiAgICBdKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoZWNrU2hDdGxBdHRyKG1hcDogTmFtZWROb2RlTWFwLCB0YXJnZXRzOiBzdHJpbmdbXSkge1xyXG4gICAgcmV0dXJuIHRhcmdldHMubWFwKCh0KSA9PiB7XHJcbiAgICAgIHJldHVybiBtYXAuZ2V0TmFtZWRJdGVtKHQpICE9IG51bGxcclxuICAgIH0pLmluY2x1ZGVzKHRydWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRTaEN0bEVsZW1lbnQoZWxtOiBIVE1MRWxlbWVudCk6IEhUTUxFbGVtZW50IHwgbnVsbCB7XHJcbiAgICBsZXQgcGFyZW50ID0gZWxtLnBhcmVudEVsZW1lbnQ7XHJcbiAgICBpZighcGFyZW50KSByZXR1cm4gbnVsbDtcclxuICAgIGlmKHBhcmVudC50YWdOYW1lLmluY2x1ZGVzKCdTSC1DVEwnKSkge1xyXG4gICAgICByZXR1cm4gcGFyZW50O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0U2hDdGxFbGVtZW50KHBhcmVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8qKlxyXG4gICAqIOOCreODvOODkOODquODh+ODvOOCt+ODp+ODs+S7mOS4jlxyXG4gICAqL1xyXG4gIGtleVZhbGlkYXRpb24oKSB7XHJcbiAgICB3aW5kb3cuZG9jdW1lbnQub25rZXlkb3duID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjEgfHxcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjIgfHxcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjMgfHxcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjQgfHxcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjUgfHxcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjYgfHxcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfRjEwIHx8XHJcbiAgICAgICAgZXZlbnQua2V5Q29kZSA9PT0gU2hDdGxDb25zdC5PUkRJTkFMLktFWVMuS0VZX0YxMSB8fFxyXG4gICAgICAgIGV2ZW50LmtleUNvZGUgPT09IFNoQ3RsQ29uc3QuT1JESU5BTC5LRVlTLktFWV9GMTJcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChcclxuICAgICAgICBldmVudC5hbHRLZXkgJiZcclxuICAgICAgICAoZXZlbnQua2V5Q29kZSA9PT0gU2hDdGxDb25zdC5PUkRJTkFMLktFWVMuS0VZX0xFRlQgfHxcclxuICAgICAgICAgIGV2ZW50LmtleUNvZGUgPT09IFNoQ3RsQ29uc3QuT1JESU5BTC5LRVlTLktFWV9SSUdIVClcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChcclxuICAgICAgICAoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSAmJlxyXG4gICAgICAgIGV2ZW50LmtleUNvZGUgPT09IFNoQ3RsQ29uc3QuT1JESU5BTC5LRVlTLktFWV9OXHJcbiAgICAgICkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgJiZcclxuICAgICAgICBldmVudC5rZXlDb2RlID09PSBTaEN0bENvbnN0Lk9SRElOQUwuS0VZUy5LRVlfUlxyXG4gICAgICApIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKFxyXG4gICAgICAgIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpICYmXHJcbiAgICAgICAgZXZlbnQua2V5Q29kZSA9PT0gU2hDdGxDb25zdC5PUkRJTkFMLktFWVMuS0VZX0RcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gU2hDdGxDb25zdC5PUkRJTkFMLktFWVMuS0VZX0VOVEVSKSB7XHJcbiAgICAgICAgbGV0IGlucHV0ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcclxuICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgaWYgKGlucHV0LnR5cGUgIT0gJ3RleHRhcmVhJykge1xyXG4gICAgICAgICAgICAvL+asoeOBruaTjeS9nOWPr+iDveOBquOCv+OCsOOBq+WIh+OCiuabv+OBiOOCi1xyXG4gICAgICAgICAgICBjb25zdCBub2RlTGlzdCA9IHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxyXG4gICAgICAgICAgICAgICcuY2FuLW1vdmVkLXdpdGgtdGhlLWVudGVyLWtleSdcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRJbnB1dCA9IEFycmF5LmZyb20obm9kZUxpc3QpLmZpbHRlcigoZWwpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1RhcmdldEVsZW1lbnQoZWwgYXMgSFRNTElucHV0RWxlbWVudClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgbGV0IHByZUlucHV0ID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJlZElucHV0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgbGV0IGN1cl9pbnB1dCA9IDxIVE1MSW5wdXRFbGVtZW50PmZpbHRlcmVkSW5wdXRbaV07XHJcbiAgICAgICAgICAgICAgaWYgKGlucHV0Lm5hbWUgPT09IGN1cl9pbnB1dC5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKytpID49IGZpbHRlcmVkSW5wdXQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgIGkgPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3VyX2lucHV0LmJsdXIoKTtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICBwcmVJbnB1dC5mb2N1cygpOyAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbGV0IG5leHRJbnB1dCA9IDxIVE1MSW5wdXRFbGVtZW50PmZpbHRlcmVkSW5wdXRbaV07XHJcbiAgICAgICAgICAgICAgICAgIG5leHRJbnB1dC5mb2N1cygpOyAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHByZUlucHV0ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZmlsdGVyZWRJbnB1dFtpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuIl19